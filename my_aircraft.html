<!-- === MY AIRCRAFT MODULE === -->
<!-- Version: Beta v1 | Date: 09 NOV 2025 -->
<!-- === ACS Maintenance System v1.2 (FULL FUNCTIONAL) === -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Aircraft - Aviation Capital Simulator</title>
  <link rel="stylesheet" href="styles.css?v=3.1" />
  <style>
    body {
      margin: 0;
      background-color: #081530;
      color: white;
      font-family: "Segoe UI", sans-serif;
    }

    h2 {
      color: #FFB300;
      text-align: center;
      margin-top: 6rem;
    }

    .sub { color: #ccc; text-align: center; margin-bottom: 2rem; }

    /* === DASHBOARD PANEL === */
    .dashboard {
      display: flex;
      justify-content: center;
      gap: 1.2rem;
      flex-wrap: wrap;
      margin: 1rem auto 2rem;
      width: 90%;
    }

    .dash-box {
      background: #0e1b3c;
      border-radius: 10px;
      padding: 0.8rem 1.2rem;
      min-width: 180px;
      text-align: center;
      box-shadow: 0 0 8px rgba(0,0,0,.4);
    }
    .dash-box h3 { color: #FFB300; margin: 0.2rem 0; font-size: 1rem; }
    .dash-box p { color: #00ff80; font-weight: 600; margin: 0; }

    /* === FLEET TABLE === */
    table {
      width: 90%;
      margin: 0 auto 2rem;
      border-collapse: collapse;
      background: #0e1b3c;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 0 10px rgba(0,0,0,.4);
    }
    th, td {
      border: 1px solid rgba(255,255,255,.1);
      padding: .6rem;
      font-size: .9rem;
      text-align: center;
    }
    th {
      background: #112055;
      color: #FFB300;
    }
    tr:nth-child(even) { background: #102040; }

    .btn {
      background: #00C851;
      border: none;
      border-radius: 6px;
      padding: .3rem .8rem;
      color: white;
      cursor: pointer;
      font-weight: 600;
      transition: transform .2s;
    }
    .btn:hover { transform: scale(1.05); background:#00e060; }

    .danger { background:#cc0000; }
    .warn { color:#ff4d4d; font-weight:600; }

    /* === MAINTENANCE LOG === */
    #log {
      width: 90%;
      margin: 1rem auto 3rem;
      background: #0e1b3c;
      border-radius: 10px;
      padding: 1rem;
      box-shadow: 0 0 10px rgba(0,0,0,.4);
      font-size: .9rem;
      max-height: 260px;
      overflow-y: auto;
    }
    #log h3 { color:#FFB300; margin-top:0; text-align:center; }
    #log-entry { border-top:1px solid rgba(255,255,255,.2); padding-top:.5rem; }

    /* === CLOCK === */
    .acs-clock-header {
      font-family:'Orbitron','Consolas',monospace;
      color:#00ff80;
      background:rgba(0,255,128,.08);
      padding:.3rem .8rem;
      border-radius:6px;
      font-size:.9rem;
      margin-left:1rem;
      font-weight:bold;
    }

    /* === FLEET MODEL MODALS (Beta v2.1) === */
    .model-modal, .maint-modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      justify-content: center; align-items: center;
    }
    .modal-content {
      background: #0e1b3c;
      border-radius: 10px;
      padding: 1rem 1.5rem;
      width: 85%;
      max-height: 85%;
      overflow-y: auto;
      box-shadow: 0 0 15px rgba(0,0,0,.6);
      border: 1px solid #FFB300;
    }
    .close {
      float: right;
      font-size: 1.5rem;
      color: #FFB300;
      cursor: pointer;
      margin-top: -0.5rem;
    }
    .close:hover { color: #fff; }
    .model-header h3 {
      color: #FFB300;
      margin-bottom: .5rem;
    }
    .maint-detail { background:#102040; padding:1rem; border-radius:8px; margin-top:.5rem; }
    .maint-detail p { margin:.2rem 0; font-size:.9rem; }
  </style>
</head>
<body>
  <!-- === HEADER === -->
  <header class="acs-header">
    <div class="acs-logo">
      <img src="acs_logo.png" alt="ACS Logo" />
      <h1>Aviation Capital Simulator</h1>
    </div>

    <nav class="acs-nav">
      <a href="dashboard.html">Main</a>
      <a href="finance.html">Finance</a>
      <a href="aircraft.html" class="active">Aircraft</a>
      <a href="routes.html">Routes</a>
      <a href="hr.html">HR</a>
      <a href="forum.html">Forum</a>
      <a href="support.html">Support</a>
    </nav>

    <div class="acs-auth">
      <a href="#" class="logout-btn" onclick="handleLogout()">Logout</a>
    </div>
    <div class="acs-clock-header" id="acs-clock">00:00 ‚Äî 01 JAN 2025</div>
  </header>

  <main>
    <h2>My Aircraft</h2>
    <p class="sub">Monitor your fleet condition, maintenance, and financial performance.</p>

    <!-- === DASHBOARD === -->
    <section class="dashboard" id="dashboard">
      <div class="dash-box"><h3>Balance</h3><p id="balance">$200.0 M</p></div>
      <div class="dash-box"><h3>Active</h3><p id="activeCount">0</p></div>
      <div class="dash-box"><h3>Maintenance</h3><p id="maintCount">0</p></div>
      <div class="dash-box"><h3>Leased Out</h3><p id="leasedCount">0</p></div>
      <div class="dash-box"><h3>Total Fleet Value</h3><p id="fleetValue">$0 M</p></div>
      <div class="dash-box"><h3>Avg Age / Hours</h3><p id="fleetStats">0 yrs / 0 h</p></div>
    </section>

    <!-- === FLEET TABLE === -->
    <table id="fleetTable">
      <tr>
        <th>Model</th><th>Status</th><th>Age</th><th>Hours</th><th>Condition</th>
        <th>Next Maint.</th><th>Actions</th>
      </tr>
    </table>

    <!-- === LOG === -->
    <section id="log">
      <h3>Maintenance Log</h3>
      <div id="log-entry"></div>
    </section>
  </main>

  <!-- === MODEL MODAL (GROUPED AIRCRAFT) === -->
  <div id="modelModal" class="model-modal">
    <div class="modal-content">
      <span class="close" onclick="closeModelModal()">&times;</span>
      <div class="model-header"><h3 id="modelTitle">Model Fleet</h3></div>
      <table id="modelTable">
        <tr><th>Registration</th><th>Status</th><th>Hours</th><th>Last Check</th><th>Next Check</th><th>Engineer</th><th>Action</th></tr>
      </table>
    </div>
  </div>

  <!-- === MAINTENANCE DETAIL MODAL === -->
  <div id="maintModal" class="maint-modal">
    <div class="modal-content">
      <span class="close" onclick="closeMaintModal()">&times;</span>
      <div class="model-header"><h3>Maintenance Detail</h3></div>
      <div class="maint-detail" id="maintDetail"></div>
      <button class="btn" id="confirmMaintBtn">Confirm Maintenance</button>
    </div>
  </div>

  <!-- === SCRIPT SECTION === -->
  <script>
  const defaultFleet = [
    { model:"Airbus A320-200", registration:"EX-32001", value:98, age:5, hours:14200, condition:92, status:"Active", lastCheck:"B", nextCheck:"C", engineer:"Eng. V. Petrova" },
    { model:"Airbus A320-200", registration:"EX-32002", value:97, age:5, hours:13000, condition:90, status:"Active", lastCheck:"A", nextCheck:"B", engineer:"Tech. A. Rahimov" },
    { model:"Boeing 737-800", registration:"EX-73701", value:106, age:6, hours:15800, condition:88, status:"Leased Out", lastCheck:"C", nextCheck:"D", engineer:"Eng. S. Bekov" },
    { model:"Embraer E190", registration:"EX-E1901", value:51, age:4, hours:9800, condition:93, status:"Active", lastCheck:"B", nextCheck:"C", engineer:"Eng. O. Nazarova" },
    { model:"ATR 72-600", registration:"EX-ATR01", value:28, age:3, hours:6200, condition:96, status:"Active", lastCheck:"A", nextCheck:"B", engineer:"Tech. K. Muradov" }
  ];

  let balance = 200.0;
  let fleet = JSON.parse(localStorage.getItem("acsFleet")) || defaultFleet;
  let logData = JSON.parse(localStorage.getItem("acsLog")) || [];

  const balanceEl = document.getElementById("balance");
  const fleetTable = document.getElementById("fleetTable");
  const logEl = document.getElementById("log-entry");

  function saveData(){
    localStorage.setItem("acsFleet", JSON.stringify(fleet));
    localStorage.setItem("acsBalance", balance);
    localStorage.setItem("acsLog", JSON.stringify(logData));
  }

  function logAction(text){
    const time = new Date().toDateString();
    const entry = `[${time}] ${text}`;
    logData.unshift(entry);
    logEl.innerHTML = logData.map(e=>`<div>${e}</div>`).join("");
    saveData();
  }

  function updateDashboard(){
    const active = fleet.filter(f=>f.status==="Active").length;
    const maint = fleet.filter(f=>f.status.includes("In")).length;
    const leased = fleet.filter(f=>f.status==="Leased Out").length;
    const totalValue = fleet.reduce((a,b)=>a+b.value,0);
    const avgAge = (fleet.reduce((a,b)=>a+b.age,0)/fleet.length).toFixed(1);
    const avgHrs = (fleet.reduce((a,b)=>a+b.hours,0)/fleet.length).toFixed(0);
    document.getElementById("activeCount").textContent = active;
    document.getElementById("maintCount").textContent = maint;
    document.getElementById("leasedCount").textContent = leased;
    document.getElementById("fleetValue").textContent = `$${totalValue.toFixed(0)} M`;
    document.getElementById("fleetStats").textContent = `${avgAge} yrs / ${avgHrs} h`;
    balanceEl.textContent = `$${balance.toFixed(1)} M`;
  }

  function renderFleet(){
    fleetTable.innerHTML = `<tr><th>Model</th><th>Status</th><th>Age</th><th>Hours</th><th>Condition</th><th>Next Maint.</th><th>Actions</th></tr>`;
    fleet.forEach((f,i)=>{
      const row = document.createElement("tr");
      let warn = f.condition<60?'<span class="warn">‚ö†Ô∏è</span>':'OK';
      row.innerHTML = `<td>${f.model}</td><td>${f.status}</td><td>${f.age}</td><td>${f.hours}</td><td>${f.condition}%</td><td>${warn}</td>
      <td><button class="btn" onclick="openModelModal('${f.model}')">View Fleet</button></td>`;
      fleetTable.appendChild(row);
    });
    updateDashboard();
  }

  /* === MODEL MODAL === */
  function openModelModal(modelName){
    const modal=document.getElementById("modelModal");
    modal.style.display="flex";
    document.getElementById("modelTitle").textContent=modelName+" ‚Äî Fleet Detail";
    const tbl=document.getElementById("modelTable");
    const list=fleet.filter(f=>f.model===modelName);
    tbl.innerHTML=`<tr><th>Registration</th><th>Status</th><th>Hours</th><th>Last Check</th><th>Next Check</th><th>Engineer</th><th>Action</th></tr>`;
    list.forEach((f,i)=>{
      const row=document.createElement("tr");
      row.innerHTML=`<td>${f.registration}</td><td>${f.status}</td><td>${f.hours}</td><td>${f.lastCheck}</td><td>${f.nextCheck}</td><td>${f.engineer}</td>
      <td><button class="btn" onclick="openMaintModal('${f.registration}','${f.model}')">üîß Start</button></td>`;
      tbl.appendChild(row);
    });
  }
  function closeModelModal(){ document.getElementById("modelModal").style.display="none"; }

  /* === MAINTENANCE MODAL === */
  let currentReg=null;
  function openMaintModal(reg,model){
    currentReg=reg;
    document.getElementById("maintModal").style.display="flex";
    const f=fleet.find(x=>x.registration===reg);
    const cost=((f.value*0.04)+(f.age*0.5)).toFixed(2);
    document.getElementById("maintDetail").innerHTML=`
      <p><b>Aircraft:</b> ${reg} (${model})</p>
      <p><b>Engineer:</b> ${f.engineer}</p>
      <p><b>Maintenance Type:</b> C-Check</p>
      <p><b>Estimated Duration:</b> 1 month (sim)</p>
      <p><b>Estimated Cost:</b> $${cost}M</p>`;
    const btn=document.getElementById("confirmMaintBtn");
    btn.onclick=function(){ confirmMaintenance(f,cost); };
  }
  function closeMaintModal(){ document.getElementById("maintModal").style.display="none"; }

  function confirmMaintenance(f,cost){
    if(f.status!=="Active"){ alert("Aircraft not available."); return; }
    f.status="In Maintenance";
    balance-=parseFloat(cost);
    logAction(`Started C-Check on ${f.registration} (-$${cost}M)`);
    document.dispatchEvent(new CustomEvent("acsAircraftStatusChange",{detail:{registration:f.registration,model:f.model,newStatus:"maintenance",cost:cost}}));
    saveData(); renderFleet(); closeMaintModal(); closeModelModal();
    setTimeout(()=>{
      f.status="Active"; f.condition=Math.min(100,f.condition+10);
      logAction(`C-Check completed on ${f.registration}`);
      document.dispatchEvent(new CustomEvent("acsAircraftStatusChange",{detail:{registration:f.registration,model:f.model,newStatus:"active"}}));
      saveData(); renderFleet();
    },60000); // sim delay
  }

  renderFleet(); logEl.innerHTML = logData.map(e=>`<div>${e}</div>`).join(""); updateDashboard();

  function handleLogout(){ alert("üëã Session closed. See you soon, Captain!"); window.location.href="login.html"; }

    <!-- ‚úÖ MOTOR GLOBAL DE TIEMPO ACS -->
  <script src="time_engine.js"></script>
  <script>
    // üïê Reloj cockpit Airbus sincronizado con el motor global de tiempo ACS
    document.addEventListener("DOMContentLoaded", () => {
      if (typeof registerTimeListener === "function") {
        registerTimeListener(updateClockDisplay);
        updateClockDisplay();
      }
    });
  </script>
</body>
</html>
