<!-- ============================================================
     === DEPARTMENT CONTROL CENTER ‚Äî Qatar Luxury Edition ========
     === Version: v2 FIXED | Date: 22 JAN 2026 ===================
     ============================================================ -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Department Control Center - Aviation Capital Simulator</title>

  <!-- ======== ACS Styles ======== -->
  <link rel="stylesheet" href="styles.css?v=3.1" />

  <!-- ======== ACS Favicons ======== -->
  <link rel="icon" type="image/png" sizes="16x16" href="acs_logo_16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="acs_logo_32.png">
  <link rel="icon" type="image/png" sizes="64x64" href="acs_logo_64.png">
  <link rel="apple-touch-icon" href="acs_logo_180.png">

  <style>
/* ============================================================
   ‚úÖ CORE DASHBOARD LAYOUT (COPIA REAL)
   ============================================================ */

body {
  margin: 0;
  background-color: #081530;
  color: white;
  font-family: "Poppins", sans-serif;
}

/* ===== HEADER (Dashboard exact behaviour) ===== */
.acs-header {
  position: fixed;
  top: 0;
  width: 100%;
  backdrop-filter: blur(9px);
  background: rgba(12,23,50,0.45);
  padding: 0.8rem 2rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom: 2px solid #ffb300;
  z-index: 5000;
}

.acs-left {
  display: flex;
  align-items: center;
  gap: 1rem;
}
.acs-left img { height: 46px; }
.acs-left h1 {
  font-size: 1.15rem;
  margin: 0;
  color: #ffb300;
  letter-spacing: 0.5px;
}

.acs-nav {
  flex: 1;
  display: flex;
  justify-content: center;
  gap: 2rem;
}

.acs-nav a {
  position: relative;
  font-size: 1rem;
  letter-spacing: 0.4px;
  color: #dbe4ff;
  text-decoration: none;
  transition: 0.25s ease;
  padding-bottom: 6px;
}

.acs-nav a:hover,
.acs-nav a.active {
  color: #ffca3a;
  text-shadow: 0 0 6px rgba(255,179,0,0.45);
}

.acs-nav a.active::after,
.acs-nav a:hover::after {
  content: "";
  position: absolute;
  bottom: -8px;
  left: 0;
  width: 100%;
  height: 2px;
  background: linear-gradient(to right, #ffb300, #ffe7a0);
  border-radius: 2px;
  box-shadow: 0 0 8px rgba(255,200,60,0.45);
}

.acs-right {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.support-btn {
      padding: 0.45rem 1.1rem;
      border-radius: 12px;
      font-size: 0.9rem;
      font-weight: 600;
      text-decoration: none;
      cursor: pointer;
      color: #8AB4FF;
      border: 1px solid rgba(138,180,255,0.45);
      background: rgba(138,180,255,0.08);
      backdrop-filter: blur(6px);
      transition: 0.25s ease;
    }
    .support-btn:hover {
      background: rgba(138,180,255,0.20);
      box-shadow: 0 0 14px rgba(138,180,255,0.55);
      color: #dfe9ff;
    }

.logout-btn {
      padding: 0.45rem 1.1rem;
      border: 1px solid #ffb300;
      border-radius: 12px;
      background: rgba(255,179,0,0.05);
      color: #ffb300;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
    }

 .logout-btn:hover {
      background: #ffb300;
      color: #0c1f3c;
    }
     
.acs-clock-header {
  font-family: "Orbitron", sans-serif;
  color: #7CFFB2;
  text-shadow: 0 0 8px rgba(0,255,160,0.35);
  font-size: 0.95rem;
}

/* ===== MAIN (Fix ‚Äúdescudrado‚Äù) ===== */
.acs-main {
  padding-top: 110px; /* CR√çTICO: separa header fijo */
  width: min(1200px, 92%);
  margin: 0 auto;
}

/* ===== Panels (Dashboard feel) ===== */
.panel {
  background: linear-gradient(180deg, rgba(20,35,70,0.75), rgba(10,18,40,0.85));
  border: 1px solid rgba(255,179,0,0.22);
  border-radius: 18px;
  padding: 1.25rem;
  box-shadow: 0 0 22px rgba(0,0,0,0.35);
  margin-bottom: 1.4rem;
}

.panel h3 {
  margin-top: 0;
  color: #ffca3a;
  text-shadow: 0 0 10px rgba(255,200,60,0.35);
  letter-spacing: 0.4px;
}

.sub {
  color: #cbd6ff;
  text-align: center;
  margin-top: 0.4rem;
  margin-bottom: 1.2rem;
}

/* ===== Footer ===== */
.acs-footer {
  text-align: center;
  padding: 16px 0;
  color: rgba(255,255,255,0.65);
}
       
/* ============================================================
   === TABLE ‚Äî Qatar Luxury Dark Premium (ALIGNED FIX) ========
   ============================================================ */

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 1rem;
  table-layout: fixed;              /* üîß columnas estables */
}

th {
  background: #102040;
  color: #ffb300;
  padding: 0.85rem 0.6rem;           /* üîß mismo padding que td */
  border-bottom: 2px solid #ffb300;
  font-size: 0.95rem;
  text-align: center;               /* üîß t√≠tulos centrados */
  vertical-align: middle;
}

td {
  padding: 0.8rem 0.6rem;
  font-size: 0.95rem;
  color: #dbe4ff;
  border-bottom: 1px solid rgba(255,179,0,0.15);
  text-align: center;               /* üîß n√∫meros alineados */
  vertical-align: middle;
}

/* Primera columna (Department) alineada a la izquierda */
th:first-child,
td:first-child {
  text-align: left;
  padding-left: 1rem;
}

/* Columna Actions ancho fijo */
th:last-child,
td:last-child {
  width: 180px;                     /* üîß fija ancho botones */
  text-align: center;
}

/* Zebra suave */
tr:nth-child(even) {
  background: rgba(255,255,255,0.03);
}

/* ============================================================
   üü¶ HR TABLE COLUMN SYSTEM ‚Äî CENTER SHIFT BALANCED (FINAL)
   ------------------------------------------------------------
   ‚Ä¢ Reduce Department
   ‚Ä¢ Adelanta bloque central
   ‚Ä¢ Mantiene Actions intacto
   ‚Ä¢ Elimina vac√≠o visual
   ============================================================ */

#deptTable th:nth-child(1),
#deptTable td:nth-child(1) { width: 32%; }   /* Department ‚Üì */

#deptTable th:nth-child(2),
#deptTable td:nth-child(2) { width: 8%; }    /* Staff ‚Üë */

#deptTable th:nth-child(3),
#deptTable td:nth-child(3) { width: 8%; }    /* Required ‚Üë */

#deptTable th:nth-child(4),
#deptTable td:nth-child(4) { width: 14%; }   /* Salary ‚Üë */

#deptTable th:nth-child(5),
#deptTable td:nth-child(5) { width: 10%; }   /* Morale ‚Üë */

#deptTable th:nth-child(6),
#deptTable td:nth-child(6) { width: 28%; }   /* Actions = fijo */

       
/* Staff, Salary, Morale colors */
/* Staff, Salary, Morale colors */
.staff { color: #00e28a; font-weight: 600; }
.salary { color: #ff6464; font-weight: 600; }
.morale { color: #8ae2ff; font-weight: 600; }

/* ============================================================
   üü• REQUIRED INDICATOR ‚Äî OPERATIONS CORE (Qatar Luxury)
   ============================================================ */

.required-ok {
  color: #00ff99;
  font-weight: 800;
  text-shadow: 0 0 8px rgba(0,255,160,0.45);
}

.required-missing {
  color: #ff4d4d;
  font-weight: 900;
  text-shadow: 0 0 12px rgba(255,80,80,0.75);
  animation: reqPulse 2.2s infinite ease-in-out;
}

/* üü° Excess staff (not critical, but cost attention) */
.required-excess {
  color: #ffcf4a;
  font-weight: 900;
  text-shadow: 0 0 10px rgba(255,200,60,0.55);
}

@keyframes reqPulse {
  0%   { opacity: 1;   }
  50%  { opacity: 0.6; }
  100% { opacity: 1;   }
}

/* ============================================================
   üü¶ HR ACTION BUTTONS ‚Äî ACS NAV STYLE (PROFESSIONAL)
   ============================================================ */

.btn {
  padding: 0.45rem 0.75rem;
  border-radius: 10px;
  font-size: 0.95rem;
  font-weight: 700;
  cursor: pointer;
  border: 1px solid rgba(255,255,255,0.15);
  background: rgba(255,255,255,0.05);
  color: #dbe4ff;
  backdrop-filter: blur(6px);
  transition: 0.25s ease;
  min-width: 44px;
  height: 34px;
}

/* Hover general */
.btn:hover {
  background: rgba(255,255,255,0.15);
  box-shadow: 0 0 12px rgba(255,255,255,0.25);
  color: white;
}

/* üü¢ HIRE ‚Äî verde sutil */
.btn-hire {
  border: 1px solid rgba(120,255,160,0.45);
  color: #7CFFB2;
}
.btn-hire:hover {
  background: rgba(120,255,160,0.20);
  box-shadow: 0 0 14px rgba(120,255,160,0.45);
}

/* üî¥ FIRE ‚Äî rojo sutil */
.btn-dismiss {
  border: 1px solid rgba(255,120,120,0.45);
  color: #ff9a9a;
}
.btn-dismiss:hover {
  background: rgba(255,120,120,0.20);
  box-shadow: 0 0 14px rgba(255,120,120,0.45);
}

/* üü¶ SALARY ‚Äî azul t√©cnico */
.btn-adjust {
  border: 1px solid rgba(138,180,255,0.45);
  color: #8AB4FF;
}
.btn-adjust:hover {
  background: rgba(138,180,255,0.20);
  box-shadow: 0 0 14px rgba(138,180,255,0.45);
}

/* üü° BONUS ‚Äî dorado suave */
.btn-bonus {
  border: 1px solid rgba(255,200,60,0.55);
  color: #ffca3a;
}
.btn-bonus:hover {
  background: rgba(255,200,60,0.20);
  box-shadow: 0 0 14px rgba(255,200,60,0.55);
}

/* Total Payroll */
#totalPayroll {
  padding-top: 1.2rem;
  font-weight: bold;
  text-align: right;
  font-size: 1.1rem;
  color: #ffca3a;
  text-shadow: 0 0 10px rgba(255,200,60,0.4);
}

/* ============================================================
     === MODALS (sin cambios de funcionalidad) =================
   ============================================================ */

.acs-modal {
  display:none; position:fixed; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.7);
  align-items:center; justify-content:center;
  z-index:2000;
}

.acs-modal-content {
  background:#0b1c3f;
  border:1px solid #ffb300;
  border-radius:12px;
  padding:1.5rem 2rem;
  width:400px;
  text-align:center;
  box-shadow: 0 0 15px rgba(255,179,0,0.4);
}

/* Close button */
.close-modal {
  background:none;
  border:none;
  color:#aaa;
  font-size:1.2rem;
  cursor:pointer;
  position:absolute;
  top:10px;
  right:20px;
}

/* ============================================================
   === ACS GALACTIC LOAD LEVELER (Qatar Luxury) ================
   ============================================================ */

.load-bar-wrapper {
  display: flex;
  align-items: center;
  gap: 10px;
}

.load-bar {
  width: 140px;
  height: 12px;
  background: rgba(255, 255, 255, 0.05);
  border-radius: 10px;
  overflow: hidden;
  border: 1px solid rgba(255, 200, 60, 0.25);
  position: relative;
  box-shadow: 0 0 10px rgba(255,179,0,0.15) inset;
}

.load-fill {
  height: 100%;
  width: 0%;
  border-radius: 10px;
  transition: width 0.5s ease-out;
  background: linear-gradient(90deg,
    rgba(0,255,140,1),
    rgba(0,200,100,1)
  );
  position: relative;
}

/* Galactic pulse line */
.load-fill::after {
  content: "";
  position: absolute;
  top: 0;
  left: -40px;
  width: 40px;
  height: 100%;
  background: rgba(255,255,255,0.25);
  filter: blur(4px);
  animation: loadPulse 3.6s infinite ease-in-out;
}

@keyframes loadPulse {
  0%   { left: -40px; opacity: 0; }
  35%  { opacity: 0.35; }
  50%  { left: 140px; opacity: 0.25; }
  100% { left: 140px; opacity: 0; }
}

/* COLORS by percentage */
.load-critical  { background: linear-gradient(90deg,#ff3b3b,#ff7a7a); }
.load-low       { background: linear-gradient(90deg,#ff8c3b,#ffbd7a); }
.load-medium    { background: linear-gradient(90deg,#ffc93b,#ffe37a); }
.load-high      { background: linear-gradient(90deg,#3bff9d,#6effc4); }

.load-number {
  font-size: 0.85rem;
  color: #dbe4ff;
  font-weight: 600;
}

/* ============================================================
   === HR FULL MODAL FIX ‚Äî Position, Scroll, Centering  =========
   ============================================================ */

.hr-full-modal {
  margin-top: 40px !important;      /* Baja el modal */
  max-height: 80vh !important;      /* Altura m√°xima */
  overflow-y: auto !important;      /* Scroll interno */
  padding-bottom: 40px !important;  /* Espacio abajo */
}

.hr-modal-title {
  margin-top: 0;
  padding-top: 10px;
  font-size: 1.6rem;
  text-align: center;
  color: #ffca3a;
  text-shadow: 0 0 10px rgba(255,185,50,0.5);
}

.hr-modal-sub {
  text-align: center;
  color: #a9b8e8;
  margin-top: -8px;
  margin-bottom: 20px;
}

/* Select fix */
.hr-select {
  width: 100%;
  padding: 10px;
  background: rgba(20,35,70,0.75);
  border-radius: 10px;
  color: white;
  border: 1px solid rgba(255,200,60,0.35);
}

/* Remove arrows that stretch layout */
.hr-select::-webkit-inner-spin-button,
.hr-select::-webkit-outer-spin-button {
  -webkit-appearance: none;
}

/* BLOCK (cada secci√≥n) */
.hr-block {
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,190,60,0.20);
  padding: 1.2rem 1rem;
  border-radius: 16px;
  margin-bottom: 1.6rem;
  text-align: left;
}

.hr-block-title {
  color: #ffb300;
  font-size: 1.2rem;
  margin-bottom: 0.8rem;
}

/* Labels */
.hr-label {
  display: block;
  font-size: 0.95rem;
  margin-bottom: 0.3rem;
  color: #ffca3a;
}

/* Select */
.hr-select {
  width: 100%;
  padding: 0.6rem;
  border-radius: 12px;
  border: 1px solid rgba(255,200,60,0.35);
  background: rgba(255,255,255,0.07);
  color: white;
  margin-bottom: 1rem;
  font-size: 1rem;
}

/* COST */
.hr-cost {
  color: #cdd9ff;
  font-size: 1rem;
  margin-bottom: 1rem;
}

/* Buttons */
.hr-btn-confirm {
  width: 100%;
  padding: 0.8rem;
  background: #00a86b;
  color: white;
  border: none;
  border-radius: 12px;
  font-weight: 700;
  cursor: pointer;
  font-size: 1rem;
}

.hr-btn-danger {
  width: 100%;
  padding: 0.8rem;
  background: #ff4747;
  color: white;
  border: none;
  border-radius: 12px;
  font-weight: 700;
  cursor: pointer;
  font-size: 1rem;
}

.hr-btn-gold {
  width: 100%;
  padding: 0.8rem;
  background: #ffb300;
  color: #0c1f3c;
  border: none;
  border-radius: 12px;
  font-weight: 700;
  cursor: pointer;
  font-size: 1rem;
}

.hr-btn-close {
  width: 100%;
  padding: 0.9rem;
  background: #b13f3f;
  color: white;
  border: none;
  border-radius: 12px;
  font-weight: 700;
  cursor: pointer;
  font-size: 1rem;
  margin-top: 0.8rem;
}

.hr-btn-disabled {
  width: 100%;
  padding: 0.8rem;
  border-radius: 12px;
  background: rgba(255,255,255,0.15);
  color: #777;
  border: none;
  font-size: 1rem;
}

.hr-disabled {
  opacity: 0.45;
  pointer-events: none;
}

/* Warning */
.hr-warning {
  color: #ff6b6b;
  margin-bottom: 1rem;
  font-weight: bold;
}
     
.btn-control {
  background: #ffb300;
  color: #0c1f3c;
  font-weight: 700;
  padding: 6px 12px;
  border-radius: 10px;
  border: 1px solid rgba(255,200,60,0.35);
  cursor: pointer;
  transition: 0.25s;
}

.btn-control:hover {
  background: #ffd35c;
  box-shadow: 0 0 12px rgba(255,190,60,0.5);
}
     
#deptSelector {
  background: rgba(20,35,70,0.75);
  border: 1px solid rgba(255,200,60,0.35);
  color: #ffca3a;
  font-weight: 600;
}
     
/* ===== HR DEPARTMENT SELECTOR (Qatar Luxury) ===== */

.hr-box {
    background: #0d1c3c;
    border: 1px solid rgba(255,179,0,0.35);
    padding: 1rem;
    border-radius: 10px;
    margin-bottom: 1.2rem;
}

.hr-label {
    color: #FFB300;
    font-weight: 600;
    display: block;
    margin-bottom: 6px;
    font-size: 1rem;
}

.hr-select {
    width: 100%;
    padding: 0.45rem;
    font-size: 1rem;
    color: #FFB300;
    background: rgba(255,255,255,0.05);
    border: 1px solid rgba(255,179,0,0.35);
    border-radius: 6px;
    outline: none;
    cursor: pointer;
}
.hr-select option {
    background: #0c1a38;
    color: white;
    padding: 6px;
}
     
/* ============================================================
   üü© A2 ‚Äî KPI CARDS (Qatar Luxury Premium)
   ============================================================ */

.kpi-wrapper {
  display: flex;
  justify-content: space-between;
  gap: 1.2rem;
  margin-bottom: 2rem;
}

.kpi-card {
  flex: 1;
  background: rgba(15,25,55,0.70);
  border: 1px solid rgba(255,179,0,0.35);
  border-radius: 16px;
  padding: 1.2rem 1rem;
  text-align: center;
  box-shadow: 0 0 12px rgba(0,0,0,0.35);
}

.kpi-card h3 {
  margin: 0;
  font-size: 1rem;
  color: #ffca3a;
  letter-spacing: 0.5px;
}

.kpi-card p {
  margin-top: 0.5rem;
  font-size: 1.5rem;
  font-weight: 700;
  color: white;
}

/* ============================================================
   üü¶ B3 ‚Äî COLUMNA EXTRA / TAGS
   ============================================================ */

.role-tag {
  background: rgba(255,179,0,0.15);
  color: #ffca3a;
  padding: 6px 12px;      /* antes 4px 10px */
  border-radius: 14px;    /* un poco m√°s redondo */
  font-size: 0.8rem;
  font-weight: 600;
  white-space: nowrap;    /* üî• evita que se divida */
}

.payroll {
  color: #dbe4ff;
  font-weight: 600;
}

.bonus-disabled {
  color: #777;
  font-style: italic;
}

/* ============================================================
   üü¶ SAL-CSS-1 ‚Äî QATAR LUXURY PREMIUM SALARY MODAL
   ============================================================ */

#salaryModal {
  position: fixed;
  inset: 0;
  background: rgba(3, 10, 30, 0.75);
  backdrop-filter: blur(6px);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 9000;
}

/* Panel principal */
#salaryModal .modal-box {
  width: 440px;
  max-width: 92%;
  background: linear-gradient(180deg, #0b1c3a 0%, #07142c 100%);
  border-radius: 18px;
  padding: 28px 30px 26px 30px;
  box-shadow:
    0 0 0 1px rgba(255, 200, 90, 0.35),
    0 0 25px rgba(255, 200, 90, 0.25),
    0 40px 80px rgba(0, 0, 0, 0.7);
  border: 1px solid rgba(255, 215, 120, 0.6);
  color: #e8f0ff;
  font-family: "Poppins", sans-serif;
}

/* T√≠tulo */
#salaryModal .modal-title {
  text-align: center;
  font-size: 22px;
  font-weight: 700;
  letter-spacing: 0.5px;
  color: #ffd77a;
  margin-bottom: 18px;
}

/* L√≠neas de datos */
#salaryModal .sal-row {
  display: flex;
  justify-content: space-between;
  margin: 6px 0;
  font-size: 14px;
}

#salaryModal .sal-row b {
  color: #b9c7ff;
  font-weight: 600;
}

#salaryModal .sal-row span {
  color: #ffffff;
  font-weight: 600;
}

/* Separador dorado */
#salaryModal .sal-sep {
  height: 1px;
  background: linear-gradient(to right, transparent, #ffd77a, transparent);
  margin: 16px 0 18px 0;
}

/* Adjustment label */
#salaryModal .sal-adjust-label {
  text-align: center;
  font-size: 15px;
  font-weight: 600;
  color: #ffd77a;
  margin-bottom: 8px;
}

/* Slider lujo */
#salaryModal input[type="range"] {
  -webkit-appearance: none;
  width: 100%;
  height: 6px;
  border-radius: 6px;
  background: linear-gradient(to right, #7c5c1b, #ffd77a, #7c5c1b);
  outline: none;
  margin-bottom: 14px;
}

#salaryModal input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background: radial-gradient(circle at 30% 30%, #fff2c0, #d4a63a);
  border: 2px solid #ffd77a;
  box-shadow: 0 0 10px rgba(255, 215, 120, 0.9);
  cursor: pointer;
}

/* Preview resultados */
#salaryModal .sal-preview {
  text-align: center;
  margin-top: 10px;
  font-size: 14px;
  line-height: 1.5;
}

#salaryModal .sal-preview b {
  color: #ffd77a;
}

/* Ratio colores */
#salaryModal #sal_ratio.ok      { color: #00ff9c; }
#salaryModal #sal_ratio.warning { color: #ffcf66; }
#salaryModal #sal_ratio.danger  { color: #ff6b6b; }

/* Morale */
#salaryModal #sal_morale_effect.good    { color: #00ff9c; }
#salaryModal #sal_morale_effect.neutral { color: #ffd77a; }
#salaryModal #sal_morale_effect.bad     { color: #ff6b6b; }

/* Botones */
#salaryModal .sal-actions {
  display: flex;
  justify-content: space-between;
  margin-top: 22px;
}

#salaryModal .btn-cancel {
  background: transparent;
  border: 1px solid rgba(255,255,255,0.25);
  color: #cbd6ff;
  padding: 7px 16px;
  border-radius: 8px;
  cursor: pointer;
}

#salaryModal .btn-apply {
  background: linear-gradient(135deg, #ffd77a, #caa13b);
  color: #081530;
  font-weight: 700;
  border: none;
  padding: 7px 20px;
  border-radius: 8px;
  cursor: pointer;
  box-shadow: 0 0 12px rgba(255,215,120,0.6);
}

#salaryModal .btn-apply:hover {
  filter: brightness(1.1);
}

</style>
</head>

<body>

<!-- ============================================================
     === HEADER ==================================================
     ============================================================ -->
<header class="acs-header">
  <div class="acs-left">
    <img src="acs_logo.png" alt="ACS Logo">
    <h1>Aviation Capital Simulator</h1>
  </div>

  <nav class="acs-nav">
    <a href="dashboard.html">Main</a>
    <a href="finance.html">Finance</a>
    <a href="aircraft.html">Aircraft</a>
    <a href="routes.html">Routes</a>
    <a href="hr.html" class="active">HR</a>
    <a href="forum.html">Forum</a>
  </nav>

  <div class="acs-right">
    <a href="support.html" class="support-btn">Support</a>
    <a class="logout-btn" onclick="handleLogout()">Logout</a>
    <div id="acs-clock" class="acs-clock-header">00:00 ‚Äî 01 JAN 1940</div>
  </div>
</header>

<!-- ============================================================
     === MAIN ====================================================
     ============================================================ -->
<main class="acs-main">

  <h2 class="acs-title">üè¢ Department Control Center</h2>
  <p class="acs-sub">Manage all departments, staff, salaries and morale.</p>

  <section class="control-panel">

 <!-- ============================================================
     üü¶ A1 ‚Äî KPI SUPERIOR (Qatar Luxury)
     Ubicaci√≥n: Dentro de .control-panel, ANTES de la tabla
     ============================================================ -->

<div class="kpi-wrapper">

  <div class="kpi-card">
    <h3>Total Staff</h3>
    <p id="kpiTotalStaff">0</p>
  </div>

  <div class="kpi-card">
    <h3>Monthly Payroll</h3>
    <p id="kpiMonthlyPayroll">$0</p>
  </div>

  <div class="kpi-card">
    <h3>Average Morale</h3>
    <p id="kpiAverageMorale">0%</p>
  </div>

</div>

<!-- ============================================================
   üüß B1 ‚Äî NUEVO THEAD (Qatar Luxury v4)
   ============================================================ -->

<table id="deptTable">
<thead>
  <tr>
    <th>Department</th>
    <th>Staff</th>
    <th>Required</th>
    <th>Salary</th>
    <th>Morale</th>
    <th>Actions</th>
  </tr>
</thead>

<tbody id="departmentRows"></tbody>
</table>

<!-- ============================================================
   üü• FIRE MINI MODAL ‚Äî Qatar Luxury Premium
   Purpose:
   - Confirm multiple dismissals
   - One single warning
   - Mobile friendly
   - No spam alerts
   ============================================================ -->

<div class="acs-modal" id="hrFireMiniModal">
  <div class="acs-modal-content" style="
       max-width:420px;
       background:#0b1c3f;
       border:1px solid #ff4d4d;
       border-radius:14px;
       padding:1.8rem 2rem;
       box-shadow:0 0 20px rgba(255,80,80,0.45);
       text-align:center;
  ">

    <!-- Close -->
    <button class="close-modal" onclick="closeFireMiniModal()">‚úñ</button>

    <!-- Title -->
    <h2 style="
        margin-top:0;
        color:#ff6b6b;
        text-shadow:0 0 8px rgba(255,80,80,0.6);
    ">
      ‚ö†Ô∏è Staff Dismissal Confirmation
    </h2>

    <!-- Department -->
    <p style="margin-top:1rem;color:#cbd6ff;">
      You are about to dismiss employees from:
    </p>

    <h3 id="fireMiniDeptName" style="
        margin:0.6rem 0 1.4rem;
        color:#ffca3a;
        font-size:1.2rem;
    ">
      Department
    </h3>

    <!-- Quantity -->
    <label class="hr-label">Select Quantity</label>

    <select id="fireMiniQty" class="hr-select"></select>

    <!-- Warning text -->
    <p style="
       margin-top:1.4rem;
       color:#ffb3b3;
       font-weight:600;
    ">
      This action cannot be undone.
    </p>

    <!-- Buttons -->
    <div style="display:flex;gap:1rem;margin-top:1.8rem;">

      <button class="hr-btn-close" onclick="closeFireMiniModal()"
        style="flex:1;">
        Cancel
      </button>

      <button class="hr-btn-danger" onclick="confirmFireMiniModal()"
        style="flex:1;">
        Confirm Dismissal
      </button>

    </div>

  </div>
</div>

<div id="salaryModal">
  <div class="modal-box">

    <div class="modal-title">üí∞ Salary Policy</div>

    <div class="sal-row"><b>Department</b><span id="sal_depName"></span></div>
    <div class="sal-row"><b>Staff</b><span id="sal_staff"></span></div>
    <div class="sal-row"><b>Current Salary</b><span>$<span id="sal_current"></span></span></div>
    <div class="sal-row"><b>Market Reference</b><span>$<span id="sal_market"></span></span></div>
    <div class="sal-row"><b>Ratio vs Market</b><span id="sal_ratio"></span></div>

    <div class="sal-sep"></div>

    <div class="sal-adjust-label">
      Adjustment: <span id="sal_percent_label">0</span>%
    </div>

   <input type="range"
       id="sal_slider"
       min="-100"
       max="100"
       step="1"
       value="0">


    <div class="sal-preview">
      <div><b>New Salary:</b> $<span id="sal_new"></span></div>
      <div><b>Monthly Payroll Change:</b> <span id="sal_payroll_delta"></span></div>
      <div><b>Expected Morale Impact:</b> <span id="sal_morale_effect"></span></div>
    </div>

    <div id="sal_auto_warning" style="display:none;color:#ffcf66;text-align:center;margin-top:10px;">
      ‚ö† Manual override ‚Äî Auto Salary disabled
    </div>

    <div class="sal-actions">
      <button class="btn-cancel" onclick="closeSalaryModal()">Cancel</button>
      <button class="btn-apply" onclick="applySalaryPolicy()">Apply</button>
    </div>

  </div>
</div>
       
<footer class="acs-footer">
  ¬© 2026 Aviation Capital Simulator. All rights reserved.
</footer>

<!-- ============================================================
     === SCRIPTS ‚Äî ORDEN OFICIAL HR + SALARY ===================
     ============================================================ -->

<script src="engine/acs_alerts.js"></script>   <!-- 1Ô∏è‚É£ ALERTS PRIMERO -->

<!-- ‚è≥ TIME ENGINE -->
<script src="acs_time_recovery.js"></script>
<script src="time_engine.js"></script>

<!-- üí∞ FINANCE -->
<script src="engine/acs_finance.js"></script>

<!-- üë• HR CORE -->
<script src="engine/acs_hr_engine.js"></script>

<!-- üß† DEPARTMENT OPS + SALARY ENGINE (CR√çTICO) -->
<script src="engine/acs_department_ops_engine.js"></script>

<script>
let activeDept = null;

/* ============================================================
   === GALACTIC LOAD BAR BUILDER ==============================
   ============================================================ */
     
function ACS_HR_renderLoadBar(dep) {
  const staff = dep.staff;
  const required = dep.required || dep.min || 0;

  let pct = required > 0 ? (staff / required) * 100 : 100;
  if (pct > 100) pct = 100;

  let cls = "load-high";
  if (pct < 40) cls = "load-critical";
  else if (pct < 60) cls = "load-low";
  else if (pct < 80) cls = "load-medium";

  return `
    <div class="load-bar-wrapper">
      <div class="load-bar">
        <div class="load-fill ${cls}" style="width:${pct}%"></div>
      </div>
      <span class="load-number">${staff} / ${required}</span>
    </div>
  `;
}
     
/* ============================================================
   === HR_prepareTableData ‚Äî RECONSTRUIDA PREMIUM v2 ============
   ============================================================ */
function HR_prepareTableData(d) {
    const staff    = d.staff || 0;
    const required = (typeof d.required === "number") ? d.required : staff;

    const diff = staff - required;

    let efficiency = 1;
    if (required > 0) {
        efficiency = staff / required;
        if (efficiency > 1) efficiency = 1;
        if (efficiency < 0) efficiency = 0;
    }

    return {
        id: d.id,
        name: d.name,
        base: d.base,
        staff: staff,
        required: required,
        diff: diff,
        efficiency: efficiency,
        salary: d.salary || 0,
        payroll: d.payroll || 0,
        morale: d.morale || 0
    };
}
     
/* ============================================================
   === LOAD DEPARTMENTS ‚Äî FINAL OPERATIONAL CORE (ACS) =========
   ============================================================ */

function loadDepartments() {
  const rows = document.getElementById("departmentRows");
  if (!rows) return;

  rows.innerHTML = "";

  const depts = ACS_HR_getDepartmentsView();
  if (!depts || !Array.isArray(depts)) {
    console.warn("‚ö†Ô∏è HR view vac√≠o o inv√°lido");
    return;
  }
     
  // üîß Salary status refresh (only if needed)
  if (typeof ACS_HR_updateSalaryStatus === "function") {
  ACS_HR_updateSalaryStatus();
  }
     
  depts.forEach(d => {

    // üõë Protecci√≥n total
    if (!d || typeof d !== "object") return;

    const dep = HR_prepareTableData(d);

    const staff = Number(dep.staff || 0);

    // üîß Required absoluto real (desde HR engine)
    const requiredAbsolute =
      (typeof d.required === "number") ? d.required : staff;

    // ============================================================
    // ‚úÖ REQUIRED (MODO CAN√ìNICO QUE PEDISTE)
    //   ‚Ä¢ 0  ‚Üí üü¢ verde (NO falta personal)
    //   ‚Ä¢ -X ‚Üí üî¥ rojo (FALTA personal) + ALERT
    //   ‚Ä¢ NUNCA muestra +X (exceso NO se muestra aqu√≠)
    // ============================================================

    const missing = Math.max(0, requiredAbsolute - staff);

    let requiredClass = "required-ok";
    let requiredText  = "0";

    if (missing > 0) {

      requiredClass = "required-missing";
      requiredText  = `-${missing}`; // üî¥ ej: -10

      // üîî ALERTA SOLO SI FALTA PERSONAL (sin spam)
      if (window.ACS_Alerts && typeof window.ACS_Alerts.push === "function") {

        const alertKey = `HR_MISSING_${dep.id}`;
        if (!window.__ACS_HR_ALERTS) window.__ACS_HR_ALERTS = {};

        if (!window.__ACS_HR_ALERTS[alertKey]) {
          window.__ACS_HR_ALERTS[alertKey] = true;

          window.ACS_Alerts.push({
            title: "Department Understaffed",
            message: `${dep.name} is missing ${missing} staff.`,
            level: "warning",
            source: "Department Control"
          });
        }
      }
    }

    rows.innerHTML += `
  <tr>
    <td>${dep.name}</td>
    <td class="staff">${staff}</td>
    <td class="${requiredClass}">${requiredText}</td>
    <td class="salary ${dep.salaryStatus === "lagging" ? "salary-lagging" : (dep.salaryStatus === "review" ? "salary-review" : "salary-ok")}">
     $${dep.salary.toLocaleString()}</td>
    <td class="morale">${dep.morale}%</td>

   <td>

  <div style="
    display:flex;
    justify-content:center;
    align-items:center;
    gap:12px;
    width:100%;
  ">

    ${dep.id === "ceo" ? `

      <!-- CEO: SOLO SALARY -->
      <button class="btn btn-adjust" title="Adjust Salary"
        onclick="openSalaryInline('${dep.id}')">
        üí∞
      </button>

    ` : `

      <!-- Hire +1 -->
      <button class="btn btn-hire" title="Hire Staff"
        onclick="HR_hireOne('${dep.id}')">
        üë§‚ûï
      </button>

      <!-- Fire -->
      <button class="btn btn-dismiss" title="Fire Staff"
        onclick="openFireMiniModal('${dep.id}')">
        üë§‚ûñ
      </button>

      <!-- Salary -->
      <button class="btn btn-adjust" title="Adjust Salary"
        onclick="openSalaryInline('${dep.id}')">
        üí∞
      </button>

      <!-- Bonus -->
      <button class="btn btn-bonus" title="Give Bonus"
        onclick="openBonusModal('${dep.id}')">
        üéÅ
      </button>

    `}

  </div>

</td>

</tr>
`;

  });

    /* ============================================================
     üüß A7.2 ‚Äî AUTO HIRE EXECUTION (POST REQUIRED CALC)
     ------------------------------------------------------------
     ‚Ä¢ Corre solo si autoHire ON
     ‚Ä¢ Se ejecuta despu√©s de dibujar required
     ‚Ä¢ Antes de rec√°lculo payroll / KPI
     ============================================================ */

  if (localStorage.getItem("autoHire") === "true") {

    if (typeof ACS_HR_applyAutoHire_Instant === "function") {

      console.log(
        "%cüßë‚Äç‚úàÔ∏è AUTO HIRE TRIGGERED FROM HR VIEW",
        "color:#00ff80;font-weight:800"
      );

      ACS_HR_applyAutoHire_Instant();

    } else {

      console.warn("‚ùå AUTO HIRE ENGINE NOT FOUND");
    }
  }
     
  // ============================================================
// üü¶ HR PAYROLL & KPI REFRESH (OPS-SAFE)
// ------------------------------------------------------------
// ‚ùó CR√çTICO:
// - HR NO recalcula `required`
// - OPS es la √∫nica fuente de demand
// - HR solo refresca payroll, morale y KPI
// ============================================================

try {

  // Recalcular payroll SOLO en base a staff actual
  if (typeof ACS_HR_recalculatePayroll === "function") {
    const payroll = ACS_HR_recalculatePayroll();
    console.log("üíæ HR payroll actualizado (OPS-safe):", payroll);
  }

} catch (e) {
  console.warn("‚ö†Ô∏è HR payroll refresh failed:", e);
}

  // üîÑ KPI refresh seguro
  if (typeof HR_updateKPI === "function") {
    HR_updateKPI();
  }
}

/* ============================================================
   === HR KPI UPDATE ‚Äî SAFE CORE (ANTI-NULL / ANTI-NaN) ========
   ============================================================ */

function HR_updateKPI() {

  const hr = ACS_HR_load();
  if (!hr || typeof hr !== "object") return;

  let totalStaff   = 0;
  let totalPayroll = 0;
  let moraleSum    = 0;
  let moraleItems  = 0;

  Object.keys(hr).forEach(id => {

    const d = hr[id];

    // üõë FIX CR√çTICO: ignora cualquier entrada corrupta o meta
    if (!d || typeof d !== "object") return;
    if (typeof d.staff !== "number") return;
    if (typeof d.salary !== "number") return;
    if (typeof d.morale !== "number") return;

    totalStaff   += d.staff;
    totalPayroll += d.staff * d.salary;

    moraleSum   += d.morale;
    moraleItems++;
  });

  const avgMorale = moraleItems > 0
    ? Math.round(moraleSum / moraleItems)
    : 100;

  // === UI UPDATE SEGURO ===
  const staffBox   = document.getElementById("kpiTotalStaff");
  const payrollBox = document.getElementById("kpiMonthlyPayroll");
  const moraleBox  = document.getElementById("kpiAverageMorale");

  if (staffBox)   staffBox.textContent   = totalStaff;
  if (payrollBox) payrollBox.textContent = `$${Math.round(totalPayroll)}`;
  if (moraleBox)  moraleBox.textContent  = `${avgMorale}%`;

  console.log(
    "%cüìä HR KPI OK",
    "color:#00ffcc;font-weight:600",
    "Staff:", totalStaff,
    "Payroll:", totalPayroll,
    "Morale:", avgMorale
  );
}

setTimeout(HR_updateKPI, 350);

function openHire(id) {
  activeDept = id;
  const hr = ACS_HR_load()[id];
  document.getElementById("hireDeptName").textContent = hr.name;
  document.getElementById("hireCount").value = 1;
  document.getElementById("hireCost").textContent = hr.salary.toLocaleString();
  document.getElementById("hireModal").style.display = "flex";
}

function openSalary(id) {
  activeDept = id;
  const hr = ACS_HR_load()[id];
  document.getElementById("salaryDeptName").textContent = hr.name;
  document.getElementById("salaryRange").value = 100;
  document.getElementById("salaryValue").textContent = "100%";
  document.getElementById("salaryModal").style.display = "flex";
}

function openDismiss(id) {
  activeDept = id;
  const hr = ACS_HR_load()[id];
  document.getElementById("dismissDeptName").textContent = hr.name;
  document.getElementById("dismissCount").value = 1;
  document.getElementById("dismissModal").style.display = "flex";
}

function closeModal(id) {
  document.getElementById(id).style.display = "none";
}

function confirmHire() {
  const count = parseInt(document.getElementById("hireCount").value);
  ACS_HR_hire(activeDept, count);
  closeModal('hireModal');
  loadDepartments();
}

function confirmDismiss() {
  const count = parseInt(document.getElementById("dismissCount").value);
  ACS_HR_fire(activeDept, count);
  closeModal('dismissModal');
  loadDepartments();
}

function confirmSalary() {
  const percent = parseInt(document.getElementById("salaryRange").value);
  ACS_HR_adjustSalary(activeDept, percent);
  closeModal('salaryModal');
  loadDepartments();
}

/* ============================================================
   üü¶ A1 ‚Äî HIRE PREMIUM CORE (INLINE SIMPLE)
   ------------------------------------------------------------
   ‚Ä¢ Suma +1 staff infinito
   ‚Ä¢ NO afecta morale
   ‚Ä¢ NO gasto inmediato
   ‚Ä¢ Impacto solo v√≠a salario mensual
   ‚Ä¢ Recalcula HR + KPI + tabla
   ============================================================ */

function HR_hireOne(depId) {

  try {

    const HR = ACS_HR_load();
    if (!HR || !HR[depId]) {
      console.warn("‚ùå HIRE FAILED ‚Äî Department not found:", depId);
      return;
    }

    const dep = HR[depId];

    // üõë PROTECCI√ìN CEO (no contratar CEO extra)
    if (dep.id === "ceo" || dep.name?.toLowerCase() === "ceo") {
      alert("‚ö†Ô∏è Only one CEO is allowed.");
      return;
    }

    // üîß CONTRATAR +1
    dep.staff = (dep.staff || 0) + 1;

    // Payroll autom√°tico (no gasto inmediato)
    dep.payroll = dep.staff * dep.salary;

    ACS_HR_save(HR);

    console.log(
      "%cüü¢ HR HIRE OK",
      "color:#7CFFB2;font-weight:700",
      dep.name,
      "New staff:", dep.staff,
      "Salary:", dep.salary,
      "Monthly payroll:", dep.payroll
    );

    // üîÑ Recalcular todo HR
    if (typeof ACS_HR_recalculateAll === "function") {
      ACS_HR_recalculateAll();
    }

    // üîÑ Refrescar tabla
    if (typeof loadDepartments === "function") {
      loadDepartments();
    }

    // üîÑ KPI
    if (typeof HR_updateKPI === "function") {
      HR_updateKPI();
    }

  } catch (err) {
    console.warn("‚ùå HR_hireOne failed:", err);
  }
}
     
function handleLogout() {
  alert("üëã Session closed. See you soon, Captain!");
  window.location.href = "login.html";
}
     
/* ============================================================
   üü¶ A3.1.8 ‚Äî DOM READY HR BOOTSTRAP ORDER (CRITICAL)
   ------------------------------------------------------------
   ‚Ä¢ Salary engine primero
   ‚Ä¢ Luego HR recalculation
   ‚Ä¢ Luego tabla
   ‚Ä¢ Luego KPI
   ‚Ä¢ Luego reloj
   ============================================================ */

window.addEventListener("DOMContentLoaded", () => {

  // 1Ô∏è‚É£ Inicializar Salary Engine (Auto Salary ON por defecto)
  if (typeof ACS_HR_salaryEngineBootstrap === "function") {
    ACS_HR_salaryEngineBootstrap();
  }

  // 2Ô∏è‚É£ Recalcular HR completo con salarios ya normalizados
  if (typeof ACS_HR_recalculateAll === "function") {
    ACS_HR_recalculateAll();
  }

  // 3Ô∏è‚É£ Cargar tabla YA con salarios correctos
  if (typeof loadDepartments === "function") {
    loadDepartments();
  }

  // 4Ô∏è‚É£ KPI SIEMPRE DESPU√âS del recalculo real
  setTimeout(() => {
    if (typeof HR_updateKPI === "function") {
      HR_updateKPI();
    }
  }, 200);

  // 5Ô∏è‚É£ Clock engine
  if (typeof registerTimeListener === "function") {
    registerTimeListener(updateClockDisplay);
    updateClockDisplay();
  }

});

/* ============================================================
   üü¶ E1 ‚Äî Department Selector Fill (HR Modal)
   ============================================================ */
     
function HR_fillDepartmentSelector() {
    const sel = document.getElementById("hrDeptSelector");
    if (!sel) return;

    sel.innerHTML = "";

    // Agregar todos los departamentos visibles
    ACS_HR_DEPARTMENTS.forEach(dep => {
        const opt = document.createElement("option");
        opt.value = dep.id;
        opt.textContent = dep.name;
        sel.appendChild(opt);
    });
}
     
</script>
       
<script>
     
/* ============================================================
   üü• A5 ‚Äî FIRE MINI MODAL ENGINE (FINAL OFFICIAL ‚Äî SELF CONTAINED)
   ------------------------------------------------------------
   ‚Ä¢ No depende de otros archivos
   ‚Ä¢ Warning expl√≠cito de AutoHire OFF
   ‚Ä¢ Reduce staff REAL
   ‚Ä¢ Recalcula payroll inmediato
   ‚Ä¢ Baja moral realista
   ‚Ä¢ Desactiva AutoHire autom√°ticamente
   ‚Ä¢ Refresca tabla + KPI
   ‚Ä¢ Arquitectura ACS estable
   ============================================================ */

let __ACS_ACTIVE_FIRE_DEPT = null;

/* ============================================================
   üü• A5.1 ‚Äî OPEN FIRE MODAL
   ============================================================ */

function openFireMiniModal(depId) {

  __ACS_ACTIVE_FIRE_DEPT = depId;

  console.log(
    "%cüî• FIRE MODAL OPEN REQUEST",
    "color:#ff4444;font-weight:800",
    "Department:", depId
  );

  const modal = document.getElementById("hrFireMiniModal");

  if (!modal) {
    console.warn("‚ùå FIRE MODAL FAILED ‚Äî #hrFireMiniModal not found");
    alert("Fire modal not found. Check modal ID: hrFireMiniModal");
    return;
  }

  const HR = ACS_HR_load();
  if (!HR || !HR[depId]) {
    console.warn("‚ùå FIRE OPEN FAILED ‚Äî Department not found:", depId);
    return;
  }

  const dep = HR[depId];

  // Nombre visible
  const nameEl = document.getElementById("fireMiniDeptName");
  if (nameEl) nameEl.textContent = dep.name;

  // Rellenar selector cantidades reales
  const select = document.getElementById("fireMiniQty");
  if (select) {
    select.innerHTML = "";
    const max = Math.max(1, dep.staff || 1);
    for (let i = 1; i <= max; i++) {
      const opt = document.createElement("option");
      opt.value = i;
      opt.textContent = `${i} employee${i > 1 ? "s" : ""}`;
      select.appendChild(opt);
    }
  }

  modal.style.display = "flex";
}


/* ============================================================
   üü• A5.2 ‚Äî CLOSE FIRE MODAL
   ============================================================ */

function closeFireMiniModal() {

  const modal = document.getElementById("hrFireMiniModal");
  if (!modal) return;

  modal.style.display = "none";

  console.log("%cüî• FIRE MODAL CLOSED", "color:#ffaa00;font-weight:700");
}


/* ============================================================
   üü• A5.3 ‚Äî CONFIRM FIRE (ENGINE REAL)
   ============================================================ */

function confirmFireMiniModal() {

  const depId = __ACS_ACTIVE_FIRE_DEPT;

  if (!depId) {
    console.warn("‚ùå FIRE CONFIRM FAILED ‚Äî No active department");
    alert("Internal error: no department selected.");
    return;
  }

  const select = document.getElementById("fireMiniQty");
  const fireQty = Number(select?.value || 1);

  // ============================================================
  // ‚ö†Ô∏è WARNING CR√çTICO ‚Äî AUTOHIRE SER√Å DESACTIVADO
  // ============================================================

  const proceed = confirm(
    "‚ö† Fire Staff Action\n\n" +
    "This action will DISABLE Auto Hire automation for the company.\n" +
    "Future hiring must be done manually or Auto Hire must be re-enabled in Settings.\n\n" +
    "Are you sure you want to proceed?"
  );

  if (!proceed) {
    console.log("%cüü° FIRE CANCELLED BY USER", "color:#ffaa00;font-weight:700");
    return;
  }

  const HR = ACS_HR_load();
  if (!HR || !HR[depId]) {
    console.warn("‚ùå FIRE FAILED ‚Äî Department not found:", depId);
    return;
  }

  const dep = HR[depId];

  const currentStaff = Number(dep.staff || 0);
  const qty = Math.min(fireQty, currentStaff);

  if (qty <= 0) {
    console.warn("‚ùå FIRE FAILED ‚Äî No staff to remove");
    return;
  }

  // ============================================================
  // üîí DESACTIVAR AUTO HIRE GLOBAL
  // ============================================================

  localStorage.setItem("autoHire", "false");

  console.log(
    "%cüîí AUTO HIRE DISABLED ‚Äî MANUAL FIRE OVERRIDE",
    "color:#ff5555;font-weight:800",
    dep.name
  );

  // ============================================================
  // üë• APLICAR DESPIDO REAL
  // ============================================================

  const oldStaff = currentStaff;
  dep.staff = Math.max(0, currentStaff - qty);

  // ============================================================
  // üí∞ RECALCULAR PAYROLL
  // ============================================================

  const salary = Number(dep.salary || 0);
  dep.payroll = Math.round(dep.staff * salary);

  // ============================================================
  // üòü IMPACTO DE MORAL REALISTA
  // ============================================================

  let moraleDrop = 5;
  if (qty >= 3) moraleDrop = 10;
  if (qty >= 6) moraleDrop = 20;

  const oldMorale = Number(dep.morale || 100);
  dep.morale = Math.max(40, oldMorale - moraleDrop);

  // Registro hist√≥rico
  dep.lastFireDate = Date.now();

  ACS_HR_save(HR);

  // ============================================================
  // üîÑ REFRESH TOTAL
  // ============================================================

  if (typeof loadDepartments === "function") loadDepartments();
  if (typeof HR_updateKPI === "function") HR_updateKPI();

  console.log(
    "%cüî• HR FIRE CONFIRMED",
    "color:#ff4444;font-weight:800",
    dep.name,
    "| Fired:", qty,
    "| Old staff:", oldStaff,
    "| New staff:", dep.staff,
    "| Morale drop:", "-" + moraleDrop + "%",
    "| New morale:", dep.morale
  );

  closeFireMiniModal();
}

/* ============================================================
   üü¶ A-FIRE-BOOT-RESET ‚Äî FINAL CANONICAL FIX
   ============================================================ */

(function ACS_forceCloseAllModalsOnBoot() {

  function closeAll() {

    // üî• Cerrar TODOS los modales reales
    document.querySelectorAll(".acs-modal").forEach(m => {
      m.style.display = "none";
    });

    // Reset estado fire
    try {
      HR_fireTargetDept = null;
    } catch(e){}

    console.log("%cüî• ALL MODALS CLOSED ON BOOT", "color:#00ffcc;font-weight:700");
  }

  // Ejecutar inmediato
  closeAll();

  // Y repetir cuando DOM est√© listo
  document.addEventListener("DOMContentLoaded", closeAll);

})();

/* ============================================================
   üü¢ HR LIVE SYNC ‚Äî VISIBILITY / FOCUS RECALC (CANONICAL)
   ------------------------------------------------------------
   Purpose:
   ‚Ä¢ Force HR to re-read OPS demand when user returns to HR
   ‚Ä¢ Simulates "live" behavior without breaking Routes/Delete
   ‚Ä¢ ZERO coupling with Schedule Table
   ------------------------------------------------------------
   Triggers:
   ‚Ä¢ Tab focus
   ‚Ä¢ Page visibility change
   ============================================================ */

function ACS_HR_liveSync() {

  if (typeof ACS_OPS_recalculateAllRequired === "function") {
    console.log(
      "%cüü¢ HR LIVE SYNC ‚Äî OPS RECALC ON FOCUS",
      "color:#00ffcc;font-weight:700"
    );
    ACS_OPS_recalculateAllRequired();
  }

  if (typeof loadDepartments === "function") {
    loadDepartments();
  }

  if (typeof HR_updateKPI === "function") {
    HR_updateKPI();
  }
}

// Cuando vuelves a la pesta√±a
document.addEventListener("visibilitychange", () => {
  if (!document.hidden) ACS_HR_liveSync();
});

// Cuando vuelves a la ventana
window.addEventListener("focus", ACS_HR_liveSync);
     
</script>
       
</body>
</html>
