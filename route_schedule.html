<!-- ============================================================
     === ROUTE SCHEDULE MODULE ‚Äî Qatar Luxury Edition ===========
     ------------------------------------------------------------
     Version:  v2.0 | Date: 01 DEC 2025
     ============================================================ -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Route Schedule - Aviation Capital Simulator</title>

  <!-- ======== ACS Styles ======== -->
  <link rel="stylesheet" href="styles.css?v=3.1" />

  <!-- ======== ACS Favicons (A Confirmado) ======== -->
  <link rel="icon" type="image/png" sizes="16x16" href="acs_logo_16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="acs_logo_32.png">
  <link rel="icon" type="image/png" sizes="64x64" href="acs_logo_64.png">
  <link rel="apple-touch-icon" href="acs_logo_180.png">

<style>
/* ============================================================
     === ROUTE SCHEDULE ‚Äî Qatar Luxury Edition CLEAN v1.1 ======
   ============================================================ */

body {
  margin: 0;
  background-color: #081530;
  color: white;
  font-family: "Poppins", sans-serif;
}

/* ============================================================
     === GLOBAL HEADER ‚Äî EXACT DASHBOARD COPY =================
   ============================================================ */

.acs-header {
  position: fixed;
  top: 0;
  width: 100%;
  backdrop-filter: blur(9px);
  background: rgba(12,23,50,0.45);
  padding: 0.8rem 2rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom: 2px solid #ffb300;
  z-index: 5000;
}

.acs-left {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.acs-left img {
  height: 46px;
}

.acs-left h1 {
  font-size: 1.15rem;
  margin: 0;
  color: #ffb300;
  letter-spacing: 0.5px;
}

.acs-nav {
  flex: 1;
  display: flex;
  justify-content: center;
  gap: 2rem;
}

.acs-nav a {
  position: relative;
  font-size: 1rem;
  letter-spacing: 0.4px;
  color: #dbe4ff;
  text-decoration: none;
  transition: 0.25s ease;
  padding-bottom: 6px;
}

.acs-nav a:hover,
.acs-nav a.active {
  color: #ffb300;
  text-shadow: 0 0 6px rgba(255,179,0,0.6);
}

.acs-nav a.active::after,
.acs-nav a:hover::after {
  content: "";
  position: absolute;
  bottom: -8px;
  left: 0;
  width: 100%;
  height: 2px;
  background: linear-gradient(to right, #ffb300, #ffe7a0);
  border-radius: 2px;
  box-shadow: 0 0 8px rgba(255,200,60,0.45);
}

.acs-right {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.support-btn {
  padding: 0.45rem 1.1rem;
  border-radius: 12px;
  font-size: 0.9rem;
  font-weight: 600;
  text-decoration: none;
  cursor: pointer;
  color: #8AB4FF;
  border: 1px solid rgba(138,180,255,0.45);
  background: rgba(138,180,255,0.08);
  backdrop-filter: blur(6px);
  transition: 0.25s ease;
}

.support-btn:hover {
  background: rgba(138,180,255,0.20);
  box-shadow: 0 0 14px rgba(138,180,255,0.55);
  color: #dfe9ff;
}

.logout-btn {
  padding: 0.45rem 1.1rem;
  border: 1px solid #ffb300;
  border-radius: 12px;
  background: rgba(255,179,0,0.05);
  color: #ffb300;
  font-weight: 600;
  cursor: pointer;
  text-decoration: none;
}

.logout-btn:hover {
  background: #ffb300;
  color: #0c1f3c;
}

.acs-clock-header {
  font-family: "Orbitron", monospace;
  padding: 0.4rem 0.8rem;
  background: rgba(0,255,128,0.08);
  border-radius: 8px;
  font-size: 0.95rem;
  color: #00ff80;
}

/* ============================================================
     === MAIN CONTENT ==========================================
   ============================================================ */

.acs-main {
  padding: 105px 2rem 70px;
  max-width: 900px;
  margin: 0 auto;
  text-align: center;
}

h2 {
  color: #ffb300;
  text-shadow: 0 0 6px rgba(255,179,0,0.4);
}

.sub {
  color: #cbd6ff;
  margin-bottom: 2.2rem;
}

/* ============================================================
     === CENTRAL CARD ‚Äî Qatar Luxury ===========================
   ============================================================ */

.schedule-container {
  background: linear-gradient(180deg, rgba(20,35,70,0.75), rgba(10,18,40,0.85));
  border-radius: 22px;
  padding: 1.8rem 2rem;
  box-shadow: 0 8px 32px rgba(0,0,0,0.42);
  border: 1px solid rgba(255,179,0,0.18);
  margin-bottom: 3rem;
  text-align: left;
}

/* ============================================================
     === FORM ELEMENTS ‚Äî CLEANED ===============================
   ============================================================ */

label {
  display: block;
  margin-top: 1rem;
  font-weight: 600;
  color: #ffb300;
}

input, select {
  width: 100%;
  padding: 0.7rem;
  margin-top: 0.3rem;
  border-radius: 12px;
  border: 1px solid rgba(255,179,0,0.18);
  background: #0c1a34;
  color: #fff;
  font-size: 1rem;
  transition: 0.2s;
  outline: none;
}

input:focus, select:focus {
  border-color: #ffca50;
  box-shadow: 0 0 8px rgba(255,200,60,0.45);
}

/* Origen/Destino ‚Äî readonly */
input[readonly] {
  background: #0a1530;
  opacity: 0.85;
  cursor: not-allowed;
}

/* Clean Aircraft select */
select#aircraft option:not(:first-child) {
  display: none;
}

/* Checkboxes cockpit ACS */
input[type="checkbox"] {
  appearance: none;
  width: 18px;
  height: 18px;
  border-radius: 6px;
  border: 2px solid #3a4a7a;
  background-color: #1e2b55;
  cursor: pointer;
  position: relative;
  transition: all 0.2s ease;
}

input[type="checkbox"]:checked {
  background-color: #00a86b;
  border-color: #00a86b;
}

input[type="checkbox"]:checked::after {
  content: "‚úî";
  color: white;
  position: absolute;
  top: -3px;
  left: 3px;
  font-size: 0.85rem;
}

.days-row {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 14px;
  margin-top: 0.8rem;
}

.divider {
  border: none;
  height: 1px;
  background: linear-gradient(to right, rgba(255,200,60,0.7), rgba(255,200,60,0.3));
  margin: 1.4rem 0;
}

/* ============================================================
     === TECH PANEL ============================================
   ============================================================ */

.tech-list {
  margin-top: 1.5rem;
  background: rgba(10,18,40,0.8);
  border-radius: 16px;
  padding: 1rem 1.2rem;
  border: 1px solid rgba(255,179,0,0.22);
  box-shadow: 0 4px 22px rgba(0,0,0,0.35);
}

.tech-item {
  display: flex;
  justify-content: space-between;
  padding: 0.45rem 0;
  border-bottom: 1px solid rgba(255,255,255,0.07);
  color: #d7e2ff;
}

.tech-item span {
  color: #ffb300;
  font-weight: 600;
}

/* ============================================================
     === BUTTONS ===============================================
   ============================================================ */

.acs-btn {
  display: block;
  background: #00a86b;
  color: #fff;
  padding: 0.8rem 1.5rem;
  border-radius: 12px;
  cursor: pointer;
  font-weight: 600;
  margin: 1.5rem auto 0.8rem;
  transition: 0.2s ease;
  border: none;
}

.acs-btn:hover {
  background: #00794f;
}

.back-btn {
  display: block;
  margin: 0 auto 0.5rem;
  color: #00a86b;
  background: none;
  border: 1px solid #00a86b;
  border-radius: 10px;
  padding: 0.45rem 1.2rem;
  cursor: pointer;
  transition: 0.2s;
}

.back-btn:hover {
  background: #00a86b;
  color: #081530;
}

.result {
  margin-top: 1rem;
  background: #0b1838;
  padding: 1rem;
  border-radius: 14px;
  color: #cbd6ff;
}

.status-line {
  margin-top: 0.8rem;
  font-weight: 600;
  text-align: center;
}

.status-ok { color: #00ff80; }
.status-warning { color: #ffd54f; }

footer {
  text-align: center;
  padding: 20px;
  color: #7c8bb8;
  font-size: 0.9rem;
  margin-top: 40px;
}
</style>
</head>

<body>

<header class="acs-header">
  <div class="acs-left">
    <img src="acs_logo.png" alt="ACS Logo">
    <h1>Aviation Capital Simulator</h1>
  </div>

  <nav class="acs-nav">
    <a href="dashboard.html">Main</a>
    <a href="finance.html">Finance</a>
    <a href="aircraft.html">Aircraft</a>
    <a href="routes.html" class="active">Routes</a>
    <a href="hr.html">HR</a>
    <a href="forum.html">Forum</a>
  </nav>

  <div class="acs-right">
    <a href="support.html" class="support-btn">Support</a>
    <a class="logout-btn" onclick="handleLogout()">Logout</a>
    <div class="acs-clock-header" id="acs-clock">00:00 ‚Äî 01 JAN 2025</div>
  </div>
</header>

<main class="acs-main">

  <h2>üß≠ Route Schedule Setup</h2>
  <p class="sub">Plan and evaluate your route performance based on technical parameters and operational constraints.</p>

  <div class="schedule-container">

    <!-- ORIGEN Y DESTINO ‚Äî Limpios y bloqueados -->
    <label>Origin (ICAO)</label>
    <input type="text" id="origin" readonly />

    <label>Destination (ICAO)</label>
    <input type="text" id="destination" readonly />

    <!-- N√∫mero de vuelo ‚Äî VAC√çO, motor intacto pero no se ejecuta -->
    <label>Flight Number (Auto)</label>
    <input type="text" id="flightNumber" readonly />

    <!-- Aircraft limpia -->
    <label>Aircraft Type</label>
    <!-- A2: se a√±ade autoGenerateFlightNumber al onchange -->
    <select id="aircraft" onchange="autoCalculate(); autoGenerateFlightNumber();">
      <option value="">-- Select Aircraft --</option>
    </select>

    <label>Departure Time (Local)</label>
    <!-- A2: se a√±ade autoGenerateFlightNumber al onchange -->
    <select id="departureTime" onchange="autoCalculate(); autoGenerateFlightNumber();"></select>

    <label style="text-align:center;margin-top:1.2rem;">Days of Operation</label>
    <div class="days-row">
      <label><input type="checkbox" id="everyDay" onchange="toggleEveryDay()"> Every Day</label>
      <label><input type="checkbox" id="mon"> Mo</label>
      <label><input type="checkbox" id="tue"> Tu</label>
      <label><input type="checkbox" id="wed"> We</label>
      <label><input type="checkbox" id="thu"> Th</label>
      <label><input type="checkbox" id="fri"> Fr</label>
      <label><input type="checkbox" id="sat"> Sa</label>
      <label><input type="checkbox" id="sun"> Su</label>
    </div>

    <hr class="divider" />

    <div class="options-center" style="text-align:center;">
      <label><input type="checkbox" id="separateDays"> Create each day as a separate route</label>
    </div>

    <hr class="divider" />

    <div class="options-center" style="text-align:center;">
      <label><input type="checkbox" id="optimizeRotation" onchange="toggleOptimization()"> Optimize Rotation (avoid delay & maintenance conflict)</label>
    </div>

    <div id="techData" class="tech-list" style="display:none;">
      <div class="tech-item">Distance (NM): <span id="distance">--</span></div>
      <div class="tech-item">Block Time: <span id="blockTime">--</span></div>
      <div class="tech-item">Turnaround Time: <span id="turnaround">--</span></div>
      <div class="tech-item">Total Rotation: <span id="totalRotation">--</span></div>
      <div class="tech-item">Time to A-Check (h remaining): <span id="serviceA">--</span></div>
      <div class="tech-item">Time to B-Check (h remaining): <span id="serviceB">--</span></div>
      <div class="tech-item">Delay Risk (%): <span id="delayRisk">--</span></div>
      <div class="tech-item">Efficiency Index (%): <span id="effIndex">--</span></div>
    </div>

    <div class="result" id="result"></div>
    <div id="optStatus" class="status-line"></div>

    <button class="acs-btn" onclick="confirmRoute()">CONFIRM ROUTE</button>
    <button class="back-btn" onclick="window.location.href='routes.html'">‚¨Ö Back to Routes</button>
  </div>
</main>

<footer>¬© 2025 Aviation Capital Simulator. All rights reserved.</footer>

<!-- ============================================================
     === JAVASCRIPT ORIGINAL ‚Äî MOTOR INTACTO ===================
   ============================================================ -->


<script>

/* ============================================================
   === BASE: GENERAR HORARIOS DE SALIDA ========================
   ============================================================ */
const timeSelect = document.getElementById("departureTime");
for (let h = 6; h < 24; h++) {
  for (let m = 0; m < 60; m += 5) {
    const hh = String(h).padStart(2,"0");
    const mm = String(m).padStart(2,"0");
    const opt = document.createElement("option");
    opt.value = `${hh}:${mm}`;
    opt.textContent = `${hh}:${mm}`;
    timeSelect.appendChild(opt);
  }
}
timeSelect.value = "06:00";

function toggleEveryDay() {
  const all = document.getElementById("everyDay").checked;
  ["mon","tue","wed","thu","fri","sat","sun"].forEach(id => {
    document.getElementById(id).checked = all;
  });
}

function toggleOptimization() {
  window.rotationOptimized = document.getElementById("optimizeRotation").checked;
}

function handleLogout() {
  alert("üëã Session closed. See you soon, Captain!");
  window.location.href = "login.html";
}


/* ============================================================
   === PHASE 2.4 ‚Äî AUTO GENERATE FLIGHT NUMBER =================
   ============================================================ */
function autoGenerateFlightNumber() {
  const origin = document.getElementById("origin").value.trim();
  const dest   = document.getElementById("destination").value.trim();
  const ac     = document.getElementById("aircraft").value;

  if (!origin || !dest || !ac) return;

  const pair = generateFlightPair();
  const input = document.getElementById("flightNumber");
  if (input) input.value = `${pair.out} ‚ûú ${pair.inn}`;
}

/* === Flight Number Engine ‚Äî INTACTO ========================= */
const flightNumberInput = document.getElementById("flightNumber");
const userIATA = localStorage.getItem("userIATA") || "AT";
let lastFlightNumber = parseInt(localStorage.getItem("lastFlightNumber") || "100", 10);
let usedFlights = JSON.parse(localStorage.getItem("flightNumbers") || "[]");

function generateFlightPair() {
  let out = `${userIATA}${lastFlightNumber}`;
  let inn = `${userIATA}${lastFlightNumber + 1}`;

  while (usedFlights.includes(out) || usedFlights.includes(inn)) {
    lastFlightNumber += 2;
    out = `${userIATA}${lastFlightNumber}`;
    inn = `${userIATA}${lastFlightNumber + 1}`;
  }

  if (flightNumberInput) flightNumberInput.value = `${out} ‚ûú ${inn}`;
  return { out, inn };
}

function bumpFlightCounter() {
  lastFlightNumber += 2;
  localStorage.setItem("lastFlightNumber", String(lastFlightNumber));
}

function markNumbersUsed(out, inn) {
  usedFlights.push(out, inn);
  localStorage.setItem("flightNumbers", JSON.stringify(usedFlights));
}

function freeNumbers(out, inn) {
  if (!out || !inn) return;
  usedFlights = usedFlights.filter(n => n !== out && n !== inn);
  localStorage.setItem("flightNumbers", JSON.stringify(usedFlights));
}


/* ============================================================
   === PHASE 2.1 ‚Äî CREATION vs EDIT ============================
   ============================================================ */
document.addEventListener("DOMContentLoaded", () => {
  const originInput = document.getElementById("origin");
  const destInput   = document.getElementById("destination");

  const editID = localStorage.getItem("editFlightID");
  const isEditing = !!editID;

  /* ----------------- MODO CREACI√ìN ----------------- */
  if (!isEditing) {

    const selOrigin = (localStorage.getItem("ACS_selectedOrigin") || "").toUpperCase();
    const selDest   = (localStorage.getItem("ACS_selectedDestination") || "").toUpperCase();

    originInput.value = selOrigin || originInput.value;
    destInput.value   = selDest   || destInput.value;

    originInput.readOnly = true;
    destInput.readOnly   = true;

    localStorage.removeItem("ACS_selectedOrigin");
    localStorage.removeItem("ACS_selectedDestination");

    autoGenerateFlightNumber();
    return;
  }

  /* ------------------ MODO EDICI√ìN ------------------ */
  const items = JSON.parse(localStorage.getItem("scheduleItems") || "[]");
  const flight = items.find(f => f.id === editID || f.blockId === editID);
  if (!flight) return;

  const $ = id => document.getElementById(id);

  $("origin").value       = flight.origin || "";
  $("destination").value  = flight.destination || "";
  $("aircraft").value     = flight.acType || "";
  $("departureTime").value = flight.departure || "06:00";

  (flight.days || []).forEach(d => {
    if (document.getElementById(d)) document.getElementById(d).checked = true;
  });

  $("origin").readOnly      = true;
  $("destination").readOnly = true;

  const notice = document.createElement("div");
  notice.style.color = "#FFB300";
  notice.style.marginBottom = "1rem";
  notice.style.fontWeight = "600";
  notice.innerHTML = `‚úèÔ∏è Editing flight: <strong>${flight.origin} ‚ûú ${flight.destination}</strong>`;
  document.querySelector(".schedule-container").prepend(notice);

  if (flight.flightNumberOut && flight.flightNumberIn) {
    freeNumbers(flight.flightNumberOut, flight.flightNumberIn);
  }

  generateFlightPair();

  const btn = document.querySelector(".acs-btn");
  btn.textContent = "UPDATE FLIGHT";

  btn.onclick = () => {
    const origin = $("origin").value.trim();
    const destination = $("destination").value.trim();
    const aircraft = $("aircraft").value;
    const departure = $("departureTime").value;
    const optimized = document.getElementById("optimizeRotation")?.checked || false;
    const DAY_IDS = ["mon","tue","wed","thu","fri","sat","sun"];
    const selectedDays = DAY_IDS.filter(id => document.getElementById(id)?.checked);

    if (!origin || !destination || !aircraft || !departure || selectedDays.length === 0) {
      alert("‚ö†Ô∏è Please complete all fields before updating.");
      return;
    }

    const updatedList = items.filter(f => f.id !== editID && f.blockId !== editID);
    localStorage.setItem("scheduleItems", JSON.stringify(updatedList));

    const rawFN = (flightNumberInput.value || "");
    const match = rawFN.match(/^([A-Z]{2}\d+).*?([A-Z]{2}\d+)$/) || [];
    const flightOut = match[1] || null;
    const flightIn  = match[2] || null;

    const updatedRoute = {
      origin, destination, aircraft, departure,
      optimized, days: selectedDays,
      flightNumberOut: flightOut,
      flightNumberIn: flightIn
    };

    localStorage.setItem("confirmedRoute", JSON.stringify(updatedRoute));
    markNumbersUsed(flightOut, flightIn);
    bumpFlightCounter();

    localStorage.removeItem("editFlightID");
    alert("‚úÖ Flight updated.");
    window.location.href = "schedule_table.html";
  };
});


/* ============================================================
   üü¶ FASE 1 ‚Äî LOAD AVAILABLE AIRCRAFT ==========================
   ============================================================ */
function loadAvailableAircraft() {
  const origin = (document.getElementById("origin").value || "").trim();
  const select = document.getElementById("aircraft");

  select.innerHTML = `<option value="">-- Select Aircraft --</option>`;

  const fleet = JSON.parse(localStorage.getItem("ACS_MyAircraft") || "[]");

  fleet
    .filter(ac => ac.status === "Active")
    .filter(ac => ac.base === origin)
    .forEach(ac => {
      const opt = document.createElement("option");
      opt.value = ac.registration;
      opt.textContent = `${ac.model} ‚Äî ${ac.registration}`;

      opt.dataset.model    = ac.model || "";
      opt.dataset.category = ac.category || "";
      opt.dataset.speed    = ac.speed || 440;
      opt.dataset.range    = ac.range || 1500;
      opt.dataset.fuelBurn = ac.fuelBurn || 0;

      select.appendChild(opt);
    });
}


/* ============================================================
   üü¶ FASE 2 ‚Äî TECH ENGINE (Distance / Time / Cost / Crew)
   ============================================================ */

// 1) Distancia (NM)
function rs_getDistanceNM(origin, dest) {
  if (!origin || !dest) return 0;
  let O = null, D = null;

  for (const cont in WorldAirportsACS) {
    const list = WorldAirportsACS[cont];
    if (!Array.isArray(list)) continue;
    O = O || list.find(a => a.icao === origin);
    D = D || list.find(a => a.icao === dest);
  }

  if (!O || !D) return 0;
  return distanceNM(O.latitude, O.longitude, D.latitude, D.longitude);
}

// 2) Block Time
function rs_getBlockTime(distance, speed) {
  if (!distance || !speed) return 0;
  const cruise = distance / speed;
  const climbDesc = 0.25;
  return Math.round((cruise + climbDesc) * 60);
}

// 3) Turnaround
function rs_getTurnaround(category) {
  if (!category) return 40;
  const c = category.toUpperCase();
  if (c.includes("ATR") || c.includes("TURBO")) return 25;
  if (c.includes("REGIONAL")) return 30;
  return 40;
}

// 4) Fuel
function rs_getFuelBurn(category) {
  if (!category) return 2400;
  const c = category.toUpperCase();
  if (c.includes("ATR")) return 900;
  if (c.includes("REGIONAL")) return 1800;
  return 2500;
}

// 5) Crew
function rs_getCrewNeeded(category) {
  const c = (category || "").toUpperCase();
  if (c.includes("ATR")) return { pilots: 2, cabin: 2 };
  if (c.includes("REGIONAL")) return { pilots: 2, cabin: 2 };
  return { pilots: 2, cabin: 3 };
}

// 6) Costos
function rs_getTripCost(distance, blockMin, category) {
  const fuelKG = rs_getFuelBurn(category) * (blockMin / 60);
  const fuelCost = fuelKG * 0.85;
  return {
    fuelCost: Math.round(fuelCost),
    handling: 350,
    maintenance: 180,
    total: Math.round(fuelCost + 350 + 180)
  };
}


/* ============================================================
   === autoCalculate (FASE 2 REAL) =============================
   ============================================================ */
function autoCalculate() {

  const origin  = document.getElementById("origin").value.trim();
  const dest    = document.getElementById("destination").value.trim();
  const acReg   = document.getElementById("aircraft").value;

  if (!origin || !dest || !acReg) {
    document.getElementById("techData").style.display = "none";
    return;
  }

  const fleet = JSON.parse(localStorage.getItem("ACS_MyAircraft") || "[]");
  const ac = fleet.find(x => x.registration === acReg);
  if (!ac) return;

  const opt = document.querySelector(`#aircraft option[value="${acReg}"]`);
  const speed    = Number(opt.dataset.speed || 440);
  const category = opt.dataset.category || "";

  const distNM = rs_getDistanceNM(origin, dest);
  const block  = rs_getBlockTime(distNM, speed);
  const turn   = rs_getTurnaround(category);
  const total  = block + turn + block;

  const crew = rs_getCrewNeeded(category);
  const cost = rs_getTripCost(distNM, block, category);

  document.getElementById("techData").style.display = "block";

  document.getElementById("distance").textContent      = distNM;
  document.getElementById("blockTime").textContent     = `${Math.floor(block/60)}h ${block%60}m`;
  document.getElementById("turnaround").textContent    = `${turn} min`;
  document.getElementById("totalRotation").textContent = `${Math.floor(total/60)}h ${total%60}m`;

  document.getElementById("serviceA").textContent = "OK";
  document.getElementById("serviceB").textContent = "OK";
  document.getElementById("delayRisk").textContent = "3%";
  document.getElementById("effIndex").textContent  = "90%";

  window.ACS_RouteTechData = {
    distNM,
    blockMin: block,
    turnMin: turn,
    totalMin: total,
    crew,
    cost
  };
}


/* ============================================================
   === PHASE 2.2 ‚Äî CONFIRM ROUTE ===============================
   ============================================================ */
function confirmRoute() {
  const origin       = document.getElementById("origin").value.trim();
  const destination  = document.getElementById("destination").value.trim();
  const aircraft     = document.getElementById("aircraft").value;
  const departure    = document.getElementById("departureTime").value;

  const DAY_IDS = ["mon","tue","wed","thu","fri","sat","sun"];
  const days = DAY_IDS.filter(id => document.getElementById(id)?.checked);

  if (!origin || !destination || !aircraft || !departure || days.length === 0) {
    alert("‚ö†Ô∏è Please complete all fields.");
    return;
  }

  const rawFN = document.getElementById("flightNumber").value || "";
  const m = rawFN.match(/^([A-Z]{2}\d+).*?([A-Z]{2}\d+)$/) || [];
  const fnOut = m[1] || null;
  const fnIn  = m[2] || null;

  const tech = window.ACS_RouteTechData || {};

  const newRoute = {
    id: `RT_${Date.now()}`,
    origin,
    destination,
    aircraft,
    departure,
    days,
    flightNumberOut: fnOut,
    flightNumberIn: fnIn,
    distanceNM: tech.distNM,
    blockTime: tech.blockMin,
    turnaround: tech.turnMin,
    totalRotation: tech.totalMin,
    crew: tech.crew,
    cost: tech.cost,
    createdAt: new Date().toISOString()
  };

  const list = JSON.parse(localStorage.getItem("scheduleItems") || "[]");
  list.push(newRoute);
  localStorage.setItem("scheduleItems", JSON.stringify(list));

  markNumbersUsed(fnOut, fnIn);
  bumpFlightCounter();

  alert("‚úÖ Route created successfully.");
  window.location.href = "schedule_table.html";
}

</script>

<script src="./time_engine.js"></script>
<script src="./engine/acs_crew_engine.js"></script>
     
<script>
     
document.addEventListener("DOMContentLoaded", () => {
  if (typeof registerTimeListener === "function") {
    registerTimeListener(updateClockDisplay);
    updateClockDisplay();
  }
});
     
</script>

</body>
</html>
