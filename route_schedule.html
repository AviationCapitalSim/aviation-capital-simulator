<!-- ============================================================
     === ROUTE SCHEDULE MODULE ‚Äî Qatar Luxury Edition ===========
     ------------------------------------------------------------
     Version:  v1.0 | Date: 30 NOV 2025
     ============================================================ -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Route Schedule - Aviation Capital Simulator</title>

  <!-- ======== ACS Styles ======== -->
  <link rel="stylesheet" href="styles.css?v=3.1" />

  <!-- ======== ACS Favicons (A Confirmado) ======== -->
  <link rel="icon" type="image/png" sizes="16x16" href="acs_logo_16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="acs_logo_32.png">
  <link rel="icon" type="image/png" sizes="64x64" href="acs_logo_64.png">
  <link rel="apple-touch-icon" href="acs_logo_180.png">

<style>
/* ============================================================
     === ROUTE SCHEDULE ‚Äî Qatar Luxury Edition CLEAN v1.1 ======
   ============================================================ */

body {
  margin: 0;
  background-color: #081530;
  color: white;
  font-family: "Poppins", sans-serif;
}

/* ============================================================
     === GLOBAL HEADER ‚Äî EXACT DASHBOARD COPY =================
   ============================================================ */

.acs-header {
  position: fixed;
  top: 0;
  width: 100%;
  backdrop-filter: blur(9px);
  background: rgba(12,23,50,0.45);
  padding: 0.8rem 2rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom: 2px solid #ffb300;
  z-index: 5000;
}

.acs-left {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.acs-left img {
  height: 46px;
}

.acs-left h1 {
  font-size: 1.15rem;
  margin: 0;
  color: #ffb300;
  letter-spacing: 0.5px;
}

.acs-nav {
  flex: 1;
  display: flex;
  justify-content: center;
  gap: 2rem;
}

.acs-nav a {
  position: relative;
  font-size: 1rem;
  letter-spacing: 0.4px;
  color: #dbe4ff;
  text-decoration: none;
  transition: 0.25s ease;
  padding-bottom: 6px;
}

.acs-nav a:hover,
.acs-nav a.active {
  color: #ffb300;
  text-shadow: 0 0 6px rgba(255,179,0,0.6);
}

.acs-nav a.active::after,
.acs-nav a:hover::after {
  content: "";
  position: absolute;
  bottom: -8px;
  left: 0;
  width: 100%;
  height: 2px;
  background: linear-gradient(to right, #ffb300, #ffe7a0);
  border-radius: 2px;
  box-shadow: 0 0 8px rgba(255,200,60,0.45);
}

.acs-right {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.support-btn {
  padding: 0.45rem 1.1rem;
  border-radius: 12px;
  font-size: 0.9rem;
  font-weight: 600;
  text-decoration: none;
  cursor: pointer;
  color: #8AB4FF;
  border: 1px solid rgba(138,180,255,0.45);
  background: rgba(138,180,255,0.08);
  backdrop-filter: blur(6px);
  transition: 0.25s ease;
}

.support-btn:hover {
  background: rgba(138,180,255,0.20);
  box-shadow: 0 0 14px rgba(138,180,255,0.55);
  color: #dfe9ff;
}

.logout-btn {
  padding: 0.45rem 1.1rem;
  border: 1px solid #ffb300;
  border-radius: 12px;
  background: rgba(255,179,0,0.05);
  color: #ffb300;
  font-weight: 600;
  cursor: pointer;
  text-decoration: none;
}

.logout-btn:hover {
  background: #ffb300;
  color: #0c1f3c;
}

.acs-clock-header {
  font-family: "Orbitron", monospace;
  padding: 0.4rem 0.8rem;
  background: rgba(0,255,128,0.08);
  border-radius: 8px;
  font-size: 0.95rem;
  color: #00ff80;
}

/* ============================================================
     === MAIN CONTENT ==========================================
   ============================================================ */

.acs-main {
  padding: 105px 2rem 70px;
  max-width: 900px;
  margin: 0 auto;
  text-align: center;
}

h2 {
  color: #ffb300;
  text-shadow: 0 0 6px rgba(255,179,0,0.4);
}

.sub {
  color: #cbd6ff;
  margin-bottom: 2.2rem;
}

/* ============================================================
     === CENTRAL CARD ‚Äî Qatar Luxury ===========================
   ============================================================ */

.schedule-container {
  background: linear-gradient(180deg, rgba(20,35,70,0.75), rgba(10,18,40,0.85));
  border-radius: 22px;
  padding: 1.8rem 2rem;
  box-shadow: 0 8px 32px rgba(0,0,0,0.42);
  border: 1px solid rgba(255,179,0,0.18);
  margin-bottom: 3rem;
  text-align: left;
}

/* ============================================================
     === FORM ELEMENTS ‚Äî CLEANED ===============================
   ============================================================ */

label {
  display: block;
  margin-top: 1rem;
  font-weight: 600;
  color: #ffb300;
}

input, select {
  width: 100%;
  padding: 0.7rem;
  margin-top: 0.3rem;
  border-radius: 12px;
  border: 1px solid rgba(255,179,0,0.18);
  background: #0c1a34;
  color: #fff;
  font-size: 1rem;
  transition: 0.2s;
  outline: none;
}

input:focus, select:focus {
  border-color: #ffca50;
  box-shadow: 0 0 8px rgba(255,200,60,0.45);
}

/* Origen/Destino ‚Äî readonly */
input[readonly] {
  background: #0a1530;
  opacity: 0.85;
  cursor: not-allowed;
}

/* Clean Aircraft select */
select#aircraft option:not(:first-child) {
  display: none;
}

/* Checkboxes cockpit ACS */
input[type="checkbox"] {
  appearance: none;
  width: 18px;
  height: 18px;
  border-radius: 6px;
  border: 2px solid #3a4a7a;
  background-color: #1e2b55;
  cursor: pointer;
  position: relative;
  transition: all 0.2s ease;
}

input[type="checkbox"]:checked {
  background-color: #00a86b;
  border-color: #00a86b;
}

input[type="checkbox"]:checked::after {
  content: "‚úî";
  color: white;
  position: absolute;
  top: -3px;
  left: 3px;
  font-size: 0.85rem;
}

.days-row {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 14px;
  margin-top: 0.8rem;
}

.divider {
  border: none;
  height: 1px;
  background: linear-gradient(to right, rgba(255,200,60,0.7), rgba(255,200,60,0.3));
  margin: 1.4rem 0;
}

/* ============================================================
     === TECH PANEL ============================================
   ============================================================ */

.tech-list {
  margin-top: 1.5rem;
  background: rgba(10,18,40,0.8);
  border-radius: 16px;
  padding: 1rem 1.2rem;
  border: 1px solid rgba(255,179,0,0.22);
  box-shadow: 0 4px 22px rgba(0,0,0,0.35);
}

.tech-item {
  display: flex;
  justify-content: space-between;
  padding: 0.45rem 0;
  border-bottom: 1px solid rgba(255,255,255,0.07);
  color: #d7e2ff;
}

.tech-item span {
  color: #ffb300;
  font-weight: 600;
}

/* ============================================================
     === BUTTONS ===============================================
   ============================================================ */

.acs-btn {
  display: block;
  background: #00a86b;
  color: #fff;
  padding: 0.8rem 1.5rem;
  border-radius: 12px;
  cursor: pointer;
  font-weight: 600;
  margin: 1.5rem auto 0.8rem;
  transition: 0.2s ease;
  border: none;
}

.acs-btn:hover {
  background: #00794f;
}

.back-btn {
  display: block;
  margin: 0 auto 0.5rem;
  color: #00a86b;
  background: none;
  border: 1px solid #00a86b;
  border-radius: 10px;
  padding: 0.45rem 1.2rem;
  cursor: pointer;
  transition: 0.2s;
}

.back-btn:hover {
  background: #00a86b;
  color: #081530;
}

.result {
  margin-top: 1rem;
  background: #0b1838;
  padding: 1rem;
  border-radius: 14px;
  color: #cbd6ff;
}

.status-line {
  margin-top: 0.8rem;
  font-weight: 600;
  text-align: center;
}

.status-ok { color: #00ff80; }
.status-warning { color: #ffd54f; }

footer {
  text-align: center;
  padding: 20px;
  color: #7c8bb8;
  font-size: 0.9rem;
  margin-top: 40px;
}
</style>
</head>

<body>

<header class="acs-header">
  <div class="acs-left">
    <img src="acs_logo.png" alt="ACS Logo">
    <h1>Aviation Capital Simulator</h1>
  </div>

  <nav class="acs-nav">
    <a href="dashboard.html">Main</a>
    <a href="finance.html">Finance</a>
    <a href="aircraft.html">Aircraft</a>
    <a href="routes.html" class="active">Routes</a>
    <a href="hr.html">HR</a>
    <a href="forum.html">Forum</a>
  </nav>

  <div class="acs-right">
    <a href="support.html" class="support-btn">Support</a>
    <a class="logout-btn" onclick="handleLogout()">Logout</a>
    <div class="acs-clock-header" id="acs-clock">00:00 ‚Äî 01 JAN 2025</div>
  </div>
</header>

<main class="acs-main">

  <h2>üß≠ Route Schedule Setup</h2>
  <p class="sub">Plan and evaluate your route performance based on technical parameters and operational constraints.</p>

  <div class="schedule-container">

    <!-- ORIGEN Y DESTINO ‚Äî Limpios y bloqueados -->
    <label>Origin (ICAO)</label>
    <input type="text" id="origin" readonly />

    <label>Destination (ICAO)</label>
    <input type="text" id="destination" readonly />

    <!-- N√∫mero de vuelo ‚Äî VAC√çO, motor intacto pero no se ejecuta -->
    <label>Flight Number (Auto)</label>
    <input type="text" id="flightNumber" readonly />

    <!-- Aircraft limpia -->
    <label>Aircraft Type</label>
    <select id="aircraft" onchange="autoCalculate()">
      <option value="">-- Select Aircraft --</option>
    </select>

    <label>Departure Time (Local)</label>
    <select id="departureTime" onchange="autoCalculate()"></select>

    <label style="text-align:center;margin-top:1.2rem;">Days of Operation</label>
    <div class="days-row">
      <label><input type="checkbox" id="everyDay" onchange="toggleEveryDay()"> Every Day</label>
      <label><input type="checkbox" id="mon"> Mo</label>
      <label><input type="checkbox" id="tue"> Tu</label>
      <label><input type="checkbox" id="wed"> We</label>
      <label><input type="checkbox" id="thu"> Th</label>
      <label><input type="checkbox" id="fri"> Fr</label>
      <label><input type="checkbox" id="sat"> Sa</label>
      <label><input type="checkbox" id="sun"> Su</label>
    </div>

    <hr class="divider" />

    <div class="options-center" style="text-align:center;">
      <label><input type="checkbox" id="separateDays"> Create each day as a separate route</label>
    </div>

    <hr class="divider" />

    <div class="options-center" style="text-align:center;">
      <label><input type="checkbox" id="optimizeRotation" onchange="toggleOptimization()"> Optimize Rotation (avoid delay & maintenance conflict)</label>
    </div>

    <div id="techData" class="tech-list" style="display:none;">
      <div class="tech-item">Distance (NM): <span id="distance">--</span></div>
      <div class="tech-item">Block Time: <span id="blockTime">--</span></div>
      <div class="tech-item">Turnaround Time: <span id="turnaround">--</span></div>
      <div class="tech-item">Total Rotation: <span id="totalRotation">--</span></div>
      <div class="tech-item">Time to A-Check (h remaining): <span id="serviceA">--</span></div>
      <div class="tech-item">Time to B-Check (h remaining): <span id="serviceB">--</span></div>
      <div class="tech-item">Delay Risk (%): <span id="delayRisk">--</span></div>
      <div class="tech-item">Efficiency Index (%): <span id="effIndex">--</span></div>
    </div>

    <div class="result" id="result"></div>
    <div id="optStatus" class="status-line"></div>

    <button class="acs-btn" onclick="confirmRoute()">CONFIRM ROUTE</button>
    <button class="back-btn" onclick="window.location.href='routes.html'">‚¨Ö Back to Routes</button>
  </div>
</main>

<footer>¬© 2025 Aviation Capital Simulator. All rights reserved.</footer>

<!-- ============================================================
     === JAVASCRIPT ORIGINAL ‚Äî MOTOR INTACTO ===================
   ============================================================ -->

<script>
     
/* === BASE === */
const timeSelect = document.getElementById("departureTime");
for (let h = 6; h < 24; h++) {
  for (let m = 0; m < 60; m += 5) {
    const hh = String(h).padStart(2,"0");
    const mm = String(m).padStart(2,"0");
    const opt = document.createElement("option");
    opt.value = `${hh}:${mm}`; opt.textContent = `${hh}:${mm}`;
    timeSelect.appendChild(opt);
  }
}
timeSelect.value = "06:00";

// Removido: Rellenado autom√°tico de destino y flightNumber.
// Este m√≥dulo recibir√° data desde los continentes en Fase 2.

function toggleEveryDay() {
  const all = document.getElementById("everyDay").checked;
  ["mon","tue","wed","thu","fri","sat","sun"].forEach(id => {
    document.getElementById(id).checked = all;
  });
}

const aircraftData = {}; // Limpio por ahora ‚Äî se llenar√° en Fase 2.

function calcDistanceNM(from,to){
  if(!from || !to) return 0;
  return 0; // Se reemplazar√° en Fase 2
}

function autoCalculate(){
  // Desactivado hasta que se reciba aircraft, coords y data real.
  document.getElementById("techData").style.display="none";
}

function toggleOptimization(){
  rotationOptimized = document.getElementById("optimizeRotation").checked;
}

function handleLogout(){alert("üëã Session closed. See you soon, Captain!");window.location.href="login.html";}

/* === Flight Number Engine ‚Äî INTACTO pero NO ejecutado ahora === */
     
const flightNumberInput = document.getElementById("flightNumber");
const userIATA = localStorage.getItem("userIATA") || "AT";
let lastFlightNumber = parseInt(localStorage.getItem("lastFlightNumber") || "100", 10);
let usedFlights = JSON.parse(localStorage.getItem("flightNumbers") || "[]");

function generateFlightPair() {
  let out = `${userIATA}${lastFlightNumber}`;
  let inn = `${userIATA}${lastFlightNumber + 1}`;
  while (usedFlights.includes(out) || usedFlights.includes(inn)) {
    lastFlightNumber += 2;
    out = `${userIATA}${lastFlightNumber}`;
    inn = `${userIATA}${lastFlightNumber + 1}`;
  }
  if (flightNumberInput) flightNumberInput.value = `${out} ‚ûú ${inn}`;
  return { out, inn };
}

function bumpFlightCounter(){ lastFlightNumber += 2; localStorage.setItem("lastFlightNumber", String(lastFlightNumber)); }
function markNumbersUsed(out, inn){ usedFlights.push(out, inn); localStorage.setItem("flightNumbers", JSON.stringify(usedFlights)); }
function freeNumbers(out, inn){
  if(!out || !inn) return;
  usedFlights = usedFlights.filter(n => n !== out && n !== inn);
  localStorage.setItem("flightNumbers", JSON.stringify(usedFlights));
}

/* ============================================================
   === PHASE 2.1 ‚Äî CREATION vs EDIT + ORIGIN/DEST FROM MAPS ===
   ------------------------------------------------------------
   - Si hay editFlightID  ‚Üí modo edici√≥n (mantiene tu l√≥gica)
   - Si NO hay editID     ‚Üí usa ACS_selectedOrigin/Destination
   ============================================================ */
document.addEventListener("DOMContentLoaded", () => {
  const originInput = document.getElementById("origin");
  const destInput   = document.getElementById("destination");

  const editID   = localStorage.getItem("editFlightID");
  const isEditing = !!editID;

  /* ========== MODO CREACI√ìN (NUEVA RUTA) ========== */
  if (!isEditing) {

    // 1) Leer lo que viene de los continentes
    const selOrigin = (localStorage.getItem("ACS_selectedOrigin") || "").toUpperCase();
    const selDest   = (localStorage.getItem("ACS_selectedDestination") || "").toUpperCase();

    if (selOrigin && selDest) {
      originInput.value = selOrigin;
      destInput.value   = selDest;
    } else {
      // Fallback: si por alguna raz√≥n no lleg√≥ nada
      originInput.value = originInput.value || "";
      destInput.value   = destInput.value   || "";
      console.warn("ACS Phase 2.1 ‚Äî No selection found for origin/destination.");
    }

    // 2) Bloquear siempre estos campos al jugador
    originInput.readOnly = true;
    destInput.readOnly   = true;

    // 3) Limpiar los valores de transferencia para el siguiente uso
    localStorage.removeItem("ACS_selectedOrigin");
    localStorage.removeItem("ACS_selectedDestination");

    // 4) NO generar a√∫n flight numbers ni autoCalculate
    //    (seg√∫n acordado en Fase 1: se activar√° m√°s adelante)
    return;
  }

  /* ========== MODO EDICI√ìN (RUTA EXISTENTE) ========== */

  const items = JSON.parse(localStorage.getItem("scheduleItems") || "[]");
  const flight = items.find(f => f.id === editID || f.blockId === editID);
  if (!flight) return;

  const $ = id => document.getElementById(id);

  // Rellenar formulario con datos antiguos
  $("origin").value       = flight.origin || "";
  $("destination").value  = flight.destination || "";
  $("aircraft").value     = flight.acType || "";
  $("departureTime").value = flight.departure || "06:00";
  (flight.days || []).forEach(d => {
    const box = document.getElementById(d);
    if (box) box.checked = true;
  });

  // Bloquear tambi√©n origen/destino en modo edici√≥n para el jugador
  $("origin").readOnly      = true;
  $("destination").readOnly = true;

  // Aviso visual
  const notice = document.createElement("div");
  notice.style.color = "#FFB300";
  notice.style.marginBottom = "1rem";
  notice.style.fontWeight = "600";
  notice.innerHTML = `‚úèÔ∏è Editing flight: <strong>${flight.origin} ‚ûú ${flight.destination}</strong>`;
  document.querySelector(".schedule-container").prepend(notice);

  // Liberar n√∫meros del vuelo anterior
  if (flight.flightNumberOut && flight.flightNumberIn) {
    freeNumbers(flight.flightNumberOut, flight.flightNumberIn);
  }

  // Generar nuevos pares (motor intacto)
  const newPair = generateFlightPair();

  // Actualizar panel t√©cnico si quieres (puedes dejarlo desactivado por ahora)
  // autoCalculate();

  // Cambiar bot√≥n a UPDATE + l√≥gica de guardado (TU BLOQUE ORIGINAL AQU√ç)
  const btn = document.querySelector(".acs-btn");
  if (btn) btn.textContent = "UPDATE FLIGHT";

  btn.onclick = () => {
    const origin = $("origin").value.trim();
    const destination = $("destination").value.trim();
    const aircraft = $("aircraft").value;
    const departure = $("departureTime").value;
    const optimized = document.getElementById("optimizeRotation")?.checked || false;
    const DAY_IDS = ["mon","tue","wed","thu","fri","sat","sun"];
    const selectedDays = DAY_IDS.filter(id => document.getElementById(id)?.checked);

    if (!origin || !destination || !aircraft || !departure || selectedDays.length === 0) {
      alert("‚ö†Ô∏è Please complete all fields before updating.");
      return;
    }

    const updatedList = items.filter(f => f.id !== editID && f.blockId !== editID);
    localStorage.setItem("scheduleItems", JSON.stringify(updatedList));

    const rawFN = (flightNumberInput.value || "");
    const match = rawFN.match(/^([A-Z]{2}\d+)\s*[\u2192\u279C\u27A1\-\>]*\s*([A-Z]{2}\d+)$/) || [];
    const flightNumberOut = match[1] || newPair.out;
    const flightNumberIn  = match[2] || newPair.inn;

    const updatedRoute = {
      origin, destination, aircraft, departure, optimized,
      days: selectedDays,
      flightNumberOut, flightNumberIn
    };
    localStorage.setItem("confirmedRoute", JSON.stringify(updatedRoute));

    markNumbersUsed(flightNumberOut, flightNumberIn);
    bumpFlightCounter();

    localStorage.removeItem("editFlightID");
    alert("‚úÖ Flight updated. You can assign it from the table.");
    window.location.href = "schedule_table.html";
  };
});
     
/* ============================================================
   === PHASE 2.3 ‚Äî LOAD AIRCRAFT FOR THIS ROUTE ================
   ------------------------------------------------------------
   ‚Ä¢ Muestra solo aviones del usuario
   ‚Ä¢ Activos
   ‚Ä¢ En la base correcta (origin)
   ============================================================ */

function loadAvailableAircraft() {
  const origin = (document.getElementById("origin").value || "").trim();
  const select = document.getElementById("aircraft");

  // Limpiar selector
  select.innerHTML = `<option value="">-- Select Aircraft --</option>`;

  // Leer flota completa
  const fleet = JSON.parse(localStorage.getItem("ACS_MyAircraft") || "[]");

  fleet
    .filter(ac => ac.status === "Active")        // solo operativos
    .filter(ac => ac.base && ac.base === origin) // solo en la base
    .forEach(ac => {
      const opt = document.createElement("option");
      opt.value = ac.registration; // lo que se enviar√°
      opt.textContent = `${ac.model} ‚Äî ${ac.registration}`;
      select.appendChild(opt);
    });
}
     
/* ============================================================
   === PHASE 2.5 ‚Äî TECHNICAL ENGINE (Distance / BlockTime) =====
   ============================================================ */

// 1. Distancia real
function getDistanceNM(origin, dest) {
  if (!origin || !dest) return 0;

  let o = null, d = null;

  // Buscar en todos los continentes
  for (const cont in WorldAirportsACS) {
    const list = WorldAirportsACS[cont];
    if (!Array.isArray(list)) continue;

    if (!o) o = list.find(a => a.icao === origin);
    if (!d) d = list.find(a => a.icao === dest);
  }

  if (!o || !d) return 0;

  return distanceNM(o.latitude, o.longitude, d.latitude, d.longitude);
}

// 2. Block Time = distancia / cruise + taxi + climb/descend
function getBlockTimeMinutes(distanceNM, model) {
  if (!distanceNM || distanceNM <= 0) return 0;

  let cruise = 440; // default jets
  if (model.includes("ATR") || model.includes("Q400")) cruise = 270;

  const timeH = distanceNM / cruise;
  return Math.round((timeH * 60) + 20);   // +20 min taxi/ATC
}

// 3. Turnaround time
function getTurnaroundMinutes(model) {
  if (model.includes("ATR") || model.includes("Q400")) return 25;
  return 40;
}

// 4. Actualizar panel t√©cnico
function autoCalculate() {
  const origin  = document.getElementById("origin").value.trim();
  const dest    = document.getElementById("destination").value.trim();
  const acReg   = document.getElementById("aircraft").value;

  if (!origin || !dest || !acReg) {
    document.getElementById("techData").style.display = "none";
    return;
  }

  // Cargar flota
  const fleet = JSON.parse(localStorage.getItem("ACS_MyAircraft") || "[]");
  const ac = fleet.find(x => x.registration === acReg);
  if (!ac) return;

  // Distancia
  const dist = getDistanceNM(origin, dest);

  // Block time
  const blockMin = getBlockTimeMinutes(dist, ac.model);

  // Turnaround
  const turnMin = getTurnaroundMinutes(ac.model);

  // Total rotation
  const totalMin = blockMin * 2 + turnMin;

  // Mostrar
  document.getElementById("techData").style.display = "block";

  document.getElementById("distance").textContent      = `${dist} NM`;
  document.getElementById("blockTime").textContent     = `${Math.floor(blockMin/60)}h ${blockMin%60}m`;
  document.getElementById("turnaround").textContent    = `${turnMin} min`;
  document.getElementById("totalRotation").textContent = `${Math.floor(totalMin/60)}h ${totalMin%60}m`;

  // checks dummy for now
  document.getElementById("serviceA").textContent = "OK";
  document.getElementById("serviceB").textContent = "OK";
  document.getElementById("delayRisk").textContent = "2%";
  document.getElementById("effIndex").textContent = "92%";
}

/* ============================================================
   === PHASE 2.2 ‚Äî REAL CONFIRM ROUTE + FINANCE HOOK ==========
   ------------------------------------------------------------
   - Crea la ruta real en scheduleItems (localStorage)
   - Deja un gancho para FINANCE (slot, landing, etc.)
   - Redirige a schedule_table.html para gesti√≥n en tabla
   ============================================================ */
     
function confirmRoute() {
  const origin       = (document.getElementById("origin").value || "").trim();
  const destination  = (document.getElementById("destination").value || "").trim();
  const aircraft     = document.getElementById("aircraft").value;
  const departure    = document.getElementById("departureTime").value;
  const optimized    = document.getElementById("optimizeRotation").checked;

  // D√≠as seleccionados
  const DAY_IDS = ["mon","tue","wed","thu","fri","sat","sun"];
  const days = DAY_IDS.filter(id => {
    const box = document.getElementById(id);
    return box && box.checked;
  });

  // Validaciones b√°sicas
  if (!origin || !destination) {
    alert("‚ö†Ô∏è Origin and destination are required.");
    return;
  }

  if (!aircraft) {
    alert("‚ö†Ô∏è Please select an aircraft.");
    return;
  }

  if (!departure) {
    alert("‚ö†Ô∏è Please select a departure time.");
    return;
  }

  if (days.length === 0) {
    alert("‚ö†Ô∏è Please select at least one day of operation.");
    return;
  }

  // N√∫meros de vuelo (si ya est√°n generados en el campo)
  const rawFN = (document.getElementById("flightNumber").value || "");
  const match = rawFN.match(/^([A-Z]{2}\d+)\s*[\u2192\u279C\u27A1\-\>]*\s*([A-Z]{2}\d+)$/) || [];
  const flightNumberOut = match[1] || null;
  const flightNumberIn  = match[2] || null;

  // Datos t√©cnicos (si est√°n visibles)
  const distance   = document.getElementById("distance")?.textContent || null;
  const blockTime  = document.getElementById("blockTime")?.textContent || null;
  const turnaround = document.getElementById("turnaround")?.textContent || null;
  const totalRot   = document.getElementById("totalRotation")?.textContent || null;

  // ==========================================================
  // 1) Construir la ruta para el SCHEDULE
  // ==========================================================
  const routeId = `RT_${Date.now()}`;

  const newRoute = {
    id: routeId,
    origin,
    destination,
    aircraft,         // por ahora solo modelo; luego se ligar√° a un aircraftId real
    departure,
    days,
    optimized,
    flightNumberOut,
    flightNumberIn,
    distanceNM: distance,
    blockTime,
    turnaround,
    totalRotation: totalRot,
    createdAt: new Date().toISOString()
  };

  // Guardar en scheduleItems (lista de rutas programadas)
  const current = JSON.parse(localStorage.getItem("scheduleItems") || "[]");
  current.push(newRoute);
  localStorage.setItem("scheduleItems", JSON.stringify(current));

  // Mantener el √∫ltimo "confirmedRoute" tambi√©n si lo usas en otros m√≥dulos
  localStorage.setItem("confirmedRoute", JSON.stringify(newRoute));

  // Marcar n√∫meros de vuelo como usados (si el motor ya est√° activo)
  if (flightNumberOut && flightNumberIn &&
      typeof markNumbersUsed === "function" &&
      typeof bumpFlightCounter === "function") {
    markNumbersUsed(flightNumberOut, flightNumberIn);
    bumpFlightCounter();
  }

  // ==========================================================
  // 2) FINANCE HOOK (cobro de slot / landing / etc.)
  //    Aqu√≠ solo dejamos el gancho. La l√≥gica profunda se
  //    programar√° con el engine de Finance en el siguiente paso.
  // ==========================================================
  try {
    if (typeof ACS_registerRouteExpense === "function") {
      // Si ya existe un engine de finance con este nombre:
      ACS_registerRouteExpense(newRoute);
    } else if (typeof ACS_registerExpense === "function") {
      // Alternativa gen√©rica
      ACS_registerExpense({
        type: "ROUTE_CREATION",
        routeId,
        origin,
        destination,
        aircraft,
        flightNumberOut,
        flightNumberIn
      });
    } else {
      console.log("üí∞ [Finance Hook] Route created (pending detailed cost engine):", newRoute);
    }
  } catch (err) {
    console.warn("‚ö†Ô∏è Finance hook failed in confirmRoute:", err);
  }

/* ==========================================================
   === 3) Redirigir a la tabla de horarios
   ========================================================== */
     
alert("‚úÖ Route created successfully. You can manage it in the schedule table.");
window.location.href = "schedule_table.html";
}

</script>    <!-- ‚Üê ESTE CIERRE FALTABA -->

<script src="./time_engine.js"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  if (typeof registerTimeListener === "function") {
    registerTimeListener(updateClockDisplay);
    updateClockDisplay();
  }
});
     
</script>

</body>
</html>
