<!-- === LOGIN MODULE === -->
<!-- Version: Beta v1 | Date: 17 NOV 2025 -->
<!-- Qatar Luxury Edition + Dynamic Captain Engine -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login - Aviation Capital Simulator</title>

  <!-- ======== ACS Styles ======== -->
  <link rel="stylesheet" href="styles.css?v=3.1" />

  <!-- ======== ACS Favicons (16 / 32 / 64) ======== -->
  <link rel="icon" type="image/png" sizes="16x16" href="acs_logo_16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="acs_logo_32.png">
  <link rel="icon" type="image/png" sizes="64x64" href="acs_logo_64.png">

  <!-- ======== Apple iPhone/iPad Home Screen Icon ======== -->
  <link rel="apple-touch-icon" href="acs_logo_180.png">

  <!-- ======== PWA Manifest (Android / Chrome) ======== -->
  <link rel="manifest" href="manifest.json">

  <style>
    
    /* ============================================================
       === GLOBAL BASE ===
       ============================================================ */
    body {
      margin: 0;
      background: linear-gradient(to bottom, #050a19, #081530 60%);
      color: white;
      font-family: "Segoe UI", sans-serif;
      padding-top: 90px; /* space for header */
      animation: fadeIn 1s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to   { opacity: 1; }
    }

    /* ============================================================
       === QATAR LUXURY HEADER (same as index but with Home/Support)
       ============================================================ */

    .acs-header {
      position: fixed;
      top: 0;
      width: 100%;
      padding: 0.8rem 2rem;

      background: rgba(12, 23, 50, 0.45);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);

      border-bottom: 1px solid rgba(255, 179, 0, 0.35);

      display: flex;
      align-items: center;
      justify-content: space-between;

      z-index: 1000;
      animation: acsHeaderFade 0.8s ease forwards;
    }

    @keyframes acsHeaderFade {
      from { opacity: 0; transform: translateY(-10px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .acs-logo img {
      height: 46px;
      filter: drop-shadow(0 0 6px rgba(255,179,0,0.35));
    }

    .acs-logo h1 {
      color: #FFB300;
      font-size: 1.15rem;
      margin: 0;
      letter-spacing: 0.6px;
      text-shadow: 0 0 8px rgba(255,179,0,0.4);
    }

    .acs-nav-buttons {
      display: flex;
      gap: 1rem;
      align-items: center;
    }

    .nav-btn {
      padding: 0.45rem 1.2rem;
      border-radius: 10px;
      font-size: 0.9rem;
      font-weight: 600;
      text-decoration: none;
      cursor: pointer;
      transition: 0.25s;
      min-width: 100px;

      background: rgba(255,255,255,0.06);
      backdrop-filter: blur(6px);

      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.1),
                  0 0 10px rgba(0,0,0,0.25);

      border: 1px solid rgba(255,255,255,0.08);
    }

    .nav-btn-yellow {
      color: #FFB300;
      border-color: rgba(255,179,0,0.45);
    }
    .nav-btn-yellow:hover {
      background: rgba(255,179,0,0.20);
      box-shadow: 0 0 12px rgba(255,179,0,0.55);
    }

    .nav-btn-blue {
      color: #8AB4FF;
      border-color: rgba(138,180,255,0.45);
    }
    .nav-btn-blue:hover {
      background: rgba(138,180,255,0.20);
      box-shadow: 0 0 12px rgba(138,180,255,0.55);
    }

    /* ============================================================
       === LOGIN CONTAINER
       ============================================================ */

    .login-wrapper {
      max-width: 420px;
      margin: 3rem auto 4rem;
      text-align: center;
      padding: 2.5rem 2rem;
      background: rgba(10, 20, 50, 0.55);
      border-radius: 14px;
      border: 1px solid rgba(255,179,0,0.35);
      box-shadow: 0 0 22px rgba(0,0,0,0.45);
      backdrop-filter: blur(10px);
      animation: fadeSlide 0.9s ease;
    }

    @keyframes fadeSlide {
      from { opacity: 0; transform: translateY(15px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .login-title {
      font-size: 1.8rem;
      font-weight: 700;
      color: #FFB300;
      margin-bottom: 0.4rem;
    }

    .login-subtitle {
      font-size: 1.05rem;
      color: #c8d6ff;
      margin-bottom: 2rem;
      font-weight: 500;
      letter-spacing: 0.4px;
    }

    input {
      width: 100%;
      padding: 0.8rem;
      margin-bottom: 1.4rem;
      border-radius: 10px;
      border: none;
      background: rgba(255,255,255,0.1);
      color: white;
      font-size: 1rem;
      backdrop-filter: blur(6px);
    }

    button {
      width: 100%;
      padding: 0.9rem;
      border-radius: 12px;
      border: none;
      background-color: #00c853;
      color: white;
      font-size: 1.1rem;
      font-weight: 700;
      cursor: pointer;
      transition: 0.25s;
      box-shadow: 0 0 18px rgba(0,255,140,0.45);
    }

    button:hover {
      background-color: #00e76b;
      transform: translateY(-2px);
    }

    .login-link {
      margin-top: 1.3rem;
      color: #a7b6ff;
      font-size: 0.9rem;
    }

    .login-link a {
      color: #ffb300;
      text-decoration: none;
      font-weight: 600;
    }

    footer {
      margin-top: 3rem;
      text-align: center;
      color: #FFFFFF;
      font-size: 0.85rem;
    }

/* ============================================================
   === RESET MODAL (Qatar Luxury Style) ========================
   ============================================================ */

.acs-modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(5, 10, 25, 0.78);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 2000;
  animation: fadeInModal 0.3s ease;
}

@keyframes fadeInModal {
  from { opacity: 0; }
  to   { opacity: 1; }
}

.acs-modal {
  background: rgba(12, 23, 50, 0.40);
  border: 1px solid rgba(255,179,0,0.48);
  border-radius: 16px;
  padding: 2rem;
  width: 92%;
  max-width: 360px;
  text-align: center;

  box-shadow: 0 0 35px rgba(255,179,0,0.28), 
              0 0 22px rgba(0,0,0,0.32);

  backdrop-filter: blur(14px);
  -webkit-backdrop-filter: blur(14px);

  animation: slideDown 0.35s ease;
}

@keyframes slideDown {
  from { transform: translateY(-20px); opacity: 0; }
  to   { transform: translateY(0); opacity: 1; }
}

.acs-modal-title {
  color: #FFB300;
  font-size: 1.6rem;
  margin-bottom: 0.4rem;
  text-shadow: 0 0 10px rgba(255,179,0,0.4);
}

.acs-modal-desc {
  color: #cbd6ff;
  margin-bottom: 1.4rem;
  font-size: 0.95rem;
}

.acs-modal-input {
  width: 100%;
  padding: 0.8rem;
  border-radius: 10px;
  border: none;
  margin-bottom: 1.2rem;
  background: rgba(255,255,255,0.1);
  color: white;
  font-size: 0.95rem;
}

.acs-modal-btn {
  width: 100%;
  padding: 0.85rem;
  border-radius: 10px;
  background-color: #00c853;
  border: none;
  color: white;
  font-size: 1rem;
  font-weight: 700;
  cursor: pointer;
  margin-bottom: 0.8rem;
}

.acs-modal-btn:hover {
  background-color: #00e76b;
}

.acs-modal-btn-cancel {
  width: 100%;
  padding: 0.8rem;
  border-radius: 10px;
  background: rgba(255,255,255,0.08);
  border: 1px solid rgba(255,255,255,0.2);
  color: #d1d6ff;
  cursor: pointer;
  font-size: 0.95rem;
}
    
  </style>
</head>

<body>

<!-- ===== HEADER — QATAR LUXURY ===== -->
<header class="acs-header">
  <div class="acs-logo">
    <img src="acs_logo.png">
    <h1>Aviation Capital Simulator</h1>
  </div>

  <div class="acs-nav-buttons">
    <a href="index.html" class="nav-btn nav-btn-yellow">Home</a>
    <a href="register.html" class="nav-btn nav-btn-yellow">Register</a>
    <a href="support.html" class="nav-btn nav-btn-blue">Support</a>
  </div>
</header>

<!-- ===== LOGIN PANEL ===== -->
<div class="login-wrapper">
  <h2 class="login-title" id="loginTitle">Welcome back</h2>
  <p class="login-subtitle">The skies await your command.</p>

  <form onsubmit="return handleLogin(event)">
    <input type="email" id="email" placeholder="Email Address" required>
    <input type="password" id="password" placeholder="Password" required>
    <button type="submit">Login</button>
  </form>

  <p class="login-link">Don’t have an account? <a href="register.html">Create one here</a>.</p>
</div>
  <p class="login-link" style="margin-top: 0.4rem;">
  <a href="#" onclick="openResetModal()">Forgot your password?</a>
  </p>

  <footer>© 2025 Aviation Capital Simulator. All rights reserved.</footer>

  <!-- ============================================================
     === RESET PASSWORD MODAL — Qatar Luxury Edition ===========
     ============================================================ -->
<div id="resetPasswordModal" class="acs-modal-overlay" style="display:none;">
  <div class="acs-modal">
    
    <h2 class="acs-modal-title">Reset Password</h2>
    <p class="acs-modal-desc">
      Enter your registered email and we will send you a temporary password.
    </p>

    <input type="email" id="resetEmail" class="acs-modal-input" placeholder="Your email address">

    <button class="acs-modal-btn" onclick="sendPasswordReset()">Send Temporary Password</button>

    <button class="acs-modal-btn-cancel" onclick="closeResetModal()">Cancel</button>
  </div>
</div>
  
<script>
/* ============================================================
   === ACS LOGIN — GOOGLE SHEETS BACKEND =======================
   === Version: Stable | 18 NOV 2025 ===========================
   ============================================================ */

// Limpiar sesiones viejas
localStorage.removeItem("ACS_activeUser");

const ACS_API_URL = "https://script.google.com/macros/s/AKfycbzWp2ko6OTmPFFv2-Pu9g39dsTxN8YF35Vc97cME2uO1SHoXQtufhIcUM6LTiuRAD7E4w/exec";

/* === Utility: Hash password (same as register) =============== */
async function hashPassword(password) {
  const enc = new TextEncoder().encode(password);
  const buffer = await crypto.subtle.digest("SHA-256", enc);
  return Array.from(new Uint8Array(buffer))
    .map(b => b.toString(16).padStart(2, "0"))
    .join("");
}
/* ============================================================
   === RESET PASSWORD MODAL CONTROL ============================
   ============================================================ */

function openResetModal() {
  document.getElementById("resetPasswordModal").style.display = "flex";
}

function closeResetModal() {
  document.getElementById("resetPasswordModal").style.display = "none";
}

/* ============================================================
   === SEND TEMPORARY PASSWORD ================================
   ============================================================ */

async function sendPasswordReset() {
  const email = document.getElementById("resetEmail").value.trim().toLowerCase();

  if (!email) {
    alert("⚠️ Please enter your email.");
    return;
  }

  try {
    const response = await fetch(ACS_API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        action: "forgotPassword",
        email
      })
    });

    const result = await response.json();

    if (result.status === "success") {
      alert("✔ A temporary password was sent to your email.");
      closeResetModal();
    } else {
      alert("❌ " + result.msg);
    }

  } catch (err) {
    alert("❌ Error: " + err.message);
  }
}
  
/* ============================================================
   === HANDLE LOGIN ============================================
   ============================================================ */
async function handleLogin(event) {
  event.preventDefault();

  const email = document.getElementById("email").value.trim().toLowerCase();
  const password = document.getElementById("password").value;

  if (!email || !password) {
    alert("⚠️ Please enter both email and password.");
    return false;
  }

  const passwordHash = await hashPassword(password);

    try {
    const response = await fetch(ACS_API_URL, {
      method: "POST",
      // ⛔ SIN headers
      body: JSON.stringify({
        action: "login",
        email,
        passwordHash
      })
    });

    const text = await response.text();
    console.log("LOGIN RAW RESPONSE:", text);

    let result;
    try {
      result = JSON.parse(text);
    } catch (e) {
      alert("❌ Server returned invalid response:\n" + text);
      return false;
    }

    // === 1) Email no registrado ===
    if (result.status === "NO_USER") {
      alert("❌ This email is not registered.\nPlease create your account.");
      window.location.href = "register.html";
      return false;
    }

    // === 2) Contraseña incorrecta ===
    if (result.status === "WRONG_PASSWORD") {
      alert("❌ Incorrect password. Please try again.");
      return false;
    }

    // === 3) Usuario SIN aerolínea ===
    if (result.status === "NO_AIRLINE") {
      localStorage.setItem("ACS_activeUser", JSON.stringify(result.user));
      window.location.href = "create_airline.html";
      return false;
    }

    // === 4) Usuario con aerolínea ===
    if (result.status === "HAS_AIRLINE") {
      localStorage.setItem("ACS_activeUser", JSON.stringify(result.user));
      window.location.href = "dashboard.html";
      return false;
    }

  } catch (err) {
    alert("❌ Login failed: " + err.message);
    return false;
  }
}

</script>
</body>
</html>
