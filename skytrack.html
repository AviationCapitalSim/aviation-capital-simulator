<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ACS SkyTrack - Aviation Capital Simulator</title>
  <link rel="stylesheet" href="styles.css?v=3.2" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    /* === SKYTRACK LOCAL STYLES === */
    #map {
      height: 85vh;
      width: 100%;
      border-radius: 12px;
      border: 1px solid rgba(255,179,0,0.3);
      box-shadow: 0 4px 16px rgba(0,0,0,0.4);
      margin-top: 1.5rem;
    }

    .flight-info {
      color: #ddd;
      margin-top: 0.5rem;
      text-align: center;
      font-size: 0.95rem;
    }

    .acs-main h2 {
      margin-bottom: 0.4rem;
      color: #FFB300;
    }

    .leaflet-control-attribution {
      color: #888 !important;
    }

    /* === Radar Marker Styles === */
    .acs-diamond {
      background: #0096FF;
      width: 10px;
      height: 10px;
      transform: rotate(45deg);
      border: 1px solid white;
      border-radius: 2px;
    }
    .acs-label {
      position: absolute;
      top: -8px;
      left: 14px;
      font-size: 11px;
      font-family: monospace;
      color: #ffffff;
      text-shadow: 0 0 2px black;
      white-space: nowrap;
    }
  </style>
</head>

<body>
  <!-- ===== HEADER ===== -->
  <header class="acs-header">
    <div class="acs-logo">
      <img src="acs_logo.png" alt="ACS Logo" />
      <h1>Aviation Capital Simulator</h1>
    </div>

    <nav class="acs-nav">
      <a href="dashboard.html">Main</a>
      <a href="aircraft.html">Aircraft</a>
      <a href="routes.html">Routes</a>
      <a href="market.html">Market</a>
      <a href="skytrack.html" class="active">SkyTrack</a>
      <a href="hr.html">HR</a>
      <a href="forum.html">Forum</a>
      <a href="profile.html">Profile</a>
      <a href="support.html">Support</a>
      <a href="#" class="logout-btn" onclick="handleLogout()">Logout</a>
    </nav>
  </header>

  <!-- ===== MAIN ===== -->
  <main class="acs-main">
    <h2>ACS SkyTrack ‚Äî Live Fleet View</h2>
    <p class="sub">Active flight tracking for your airline.</p>

    <div id="map"></div>
    <p class="flight-info" id="flightStatus">üõ´ Simulating flight: UCFM (Bishkek) ‚Üí OMDB (Dubai)</p>
  </main>

  <!-- ===== FOOTER ===== -->
  <footer class="acs-footer">
    <p>¬© 2025 Aviation Capital Simulator. All rights reserved.</p>
  </footer>

  <!-- ===== SCRIPT ===== -->
  <script>
    // === Initialize map ===
    const map = L.map('map').setView([33.0, 68.0], 5); // Central Asia

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 10,
      attribution: '&copy; OpenStreetMap ‚Äî ACS SkyTrack'
    }).addTo(map);

    // === Define airports ===
    const origin = { name: "Bishkek (UCFM)", lat: 42.866, lon: 74.529 };
    const destination = { name: "Dubai (OMDB)", lat: 25.253, lon: 55.365 };

    // === Add airport markers ===
    const startMarker = L.marker([origin.lat, origin.lon]).addTo(map)
      .bindPopup(`<b>${origin.name}</b><br>Departure Airport`);
    const endMarker = L.marker([destination.lat, destination.lon]).addTo(map)
      .bindPopup(`<b>${destination.name}</b><br>Arrival Airport`);

    // === Route line ===
    const routeLine = L.polyline([[origin.lat, origin.lon], [destination.lat, destination.lon]], {
      color: '#FFB300',
      weight: 2.5,
      opacity: 0.8,
      dashArray: '5, 6'
    }).addTo(map);

    // === ‚ú≥Ô∏è ACS Radar Diamond Marker ===
    const planeIcon = L.divIcon({
      html: `
        <div class="acs-diamond"></div>
        <div class="acs-label">A320 | N388PP</div>
      `,
      className: "acs-plane",
      iconSize: [20, 20],
      iconAnchor: [10, 10]
    });

    const planeMarker = L.marker([origin.lat, origin.lon], { icon: planeIcon }).addTo(map);

    // === Ruta din√°mica (traza del vuelo) ===
    const flightTrace = L.polyline([], {
      color: "#FFB300",
      weight: 2,
      opacity: 0.8
    }).addTo(map);

    // === Movimiento y rotaci√≥n ===
    let progress = 0;
    const steps = 400;
    const updateInterval = 50;

    function interpolatePosition(start, end, t) {
      return [
        start.lat + (end.lat - start.lat) * t,
        start.lon + (end.lon - start.lon) * t
      ];
    }

    function getBearing(lat1, lon1, lat2, lon2) {
      const toRad = Math.PI / 180;
      const y = Math.sin((lon2 - lon1) * toRad) * Math.cos(lat2 * toRad);
      const x =
        Math.cos(lat1 * toRad) * Math.sin(lat2 * toRad) -
        Math.sin(lat1 * toRad) * Math.cos(lat2 * toRad) * Math.cos((lon2 - lon1) * toRad);
      const brng = Math.atan2(y, x);
      return ((brng * 180) / Math.PI + 360) % 360;
    }

    function updatePlane() {
      progress += 1 / steps;
      if (progress > 1) {
        progress = 1;
        document.getElementById("flightStatus").innerHTML =
          "‚úÖ Flight completed: Arrived in Dubai (OMDB)";
      }

      const [lat, lon] = interpolatePosition(origin, destination, progress);
      planeMarker.setLatLng([lat, lon]);
      flightTrace.addLatLng([lat, lon]);

      // Rotaci√≥n del diamante seg√∫n rumbo
      const bearing = getBearing(origin.lat, origin.lon, lat, lon);
      const diamond = planeMarker.getElement()?.querySelector(".acs-diamond");
      if (diamond) diamond.style.transform = `rotate(${bearing + 45}deg)`;

      if (progress < 1) setTimeout(updatePlane, updateInterval);
    }

    updatePlane(); // Start animation

    // === Logout coherente ===
    function handleLogout() {
      alert("üëã Session closed. See you soon, Captain!");
      window.location.href = "login.html";
    }
  </script>
</body>
</html>
