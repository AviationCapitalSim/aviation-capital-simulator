<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>ACS SkyTrack</title>

<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
  body { margin:0; background:#0b1220; color:#fff; font-family:Arial }
  #map { height:100vh; width:100vw }
  .popup { font-size:13px; }
  .popup b { font-size:14px; }
</style>
</head>

<body>
<body>

<!-- ============================================================
     === GLOBAL HEADER â€” QATAR LUXURY (EXACT HR COPY) ===========
     ============================================================ -->

<header class="acs-header">
  <div class="acs-left">
    <img src="acs_logo.png" alt="ACS Logo">
    <h1>Aviation Capital Simulator</h1>
  </div>

  <nav class="acs-nav">
    <a href="dashboard.html">Main</a>
    <a href="finance.html">Bank</a>
    <a href="aircraft.html">Aircraft</a>
    <a href="routes.html">Routes</a>
    <a href="skytrack.html" class="active">SkyTrack</a>
    <a href="forum.html">Forum</a>
  </nav>

  <div class="acs-right">
    <a href="support.html" class="support-btn">Support</a>
    <a class="logout-btn" onclick="handleLogout()">Logout</a>
    <div class="acs-clock-header" id="acs-clock">00:00 â€” 01 JAN 1940</div>
  </div>
</header>

<!-- ============================================================
     === SKYTRACK MAP AREA =====================================
     ============================================================ -->

<main class="acs-main" style="padding:105px 0 0;">
  <div id="map" style="height:calc(100vh - 105px); width:100%;"></div>
</main>

</body>

<script>
/* ============================================================
   ðŸŸ¦ SKYTRACK v1 â€” CLEAN SCHEDULE (TEST DATA)
   ============================================================ */

const SKYTRACK_SCHEDULE = [
  {
    flightNumber: "WM101",
    model: "DC-3",
    registration: "EC-FDF",
    origin: "LEMD",
    destination: "LEBL",
    depMin: 600,   // 10:00
    arrMin: 780    // 13:00
  },
  {
    flightNumber: "WM102",
    model: "DC-5",
    registration: "EC-ZPF",
    origin: "LEBL",
    destination: "LEMD",
    depMin: 840,   // 14:00
    arrMin: 1020   // 17:00
  }
];

/* ============================================================
   ðŸŒ AIRPORT DATABASE (MINIMAL)
   ============================================================ */

const AIRPORTS = {
  LEMD: { lat: 40.4722, lng: -3.5608, name: "Madrid" },
  LEBL: { lat: 41.2974, lng: 2.0833,  name: "Barcelona" }
};

/* ============================================================
   â± TIME (REAL CLOCK â€” SIMPLE)
   ============================================================ */

function getNowMin() {
  const d = new Date();
  return d.getHours() * 60 + d.getMinutes();
}

/* ============================================================
   âœˆï¸ RUNTIME v1 â€” MINIMAL
   ============================================================ */

function buildLiveFlights() {

  const nowMin = getNowMin();
  const flights = [];

  SKYTRACK_SCHEDULE.forEach(f => {

    const o = AIRPORTS[f.origin];
    const d = AIRPORTS[f.destination];
    if (!o || !d) return;

    let status = "GROUND";
    let lat = o.lat;
    let lng = o.lng;

    // ventana normal
    if (f.depMin <= f.arrMin && nowMin >= f.depMin && nowMin <= f.arrMin) {
      status = "AIRBORNE";
    }

    // cruce medianoche (por si acaso)
    if (f.depMin > f.arrMin && (nowMin >= f.depMin || nowMin <= f.arrMin)) {
      status = "AIRBORNE";
    }

    if (status === "AIRBORNE") {
      const total = f.arrMin - f.depMin;
      const elapsed = Math.min(Math.max(nowMin - f.depMin, 0), total);
      const p = elapsed / total;

      lat = o.lat + (d.lat - o.lat) * p;
      lng = o.lng + (d.lng - o.lng) * p;
    }

    if (nowMin > f.arrMin) {
      lat = d.lat;
      lng = d.lng;
    }

    flights.push({
      flightNumber: f.flightNumber,
      model: f.model,
      registration: f.registration,
      origin: f.origin,
      destination: f.destination,
      lat,
      lng,
      status
    });
  });

  return flights;
}

/* ============================================================
   ðŸ—º MAP
   ============================================================ */

const map = L.map("map").setView([41, 2], 6);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  attribution: "&copy; OpenStreetMap"
}).addTo(map);

const markers = {};

/* ============================================================
   ðŸ”„ RENDER LOOP
   ============================================================ */

function render() {

  const flights = buildLiveFlights();

  flights.forEach(f => {

    if (!markers[f.flightNumber]) {
      markers[f.flightNumber] = L.marker([f.lat, f.lng]).addTo(map);
    }

    markers[f.flightNumber].setLatLng([f.lat, f.lng]);

    markers[f.flightNumber].bindPopup(`
      <div class="popup">
        <b>${f.flightNumber}</b><br>
        ${f.model} Â· ${f.registration}<br>
        ${f.origin} â†’ ${f.destination}<br>
        Status: ${f.status}
      </div>
    `);
  });
}

render();
setInterval(render, 60000);
</script>
</body>
</html>
