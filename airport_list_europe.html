<!-- ===========================================================
     === AIRPORT LIST (EUROPE) ‚Äî HISTORICAL ENGINE v1 ==========
     Qatar Luxury Edition | Date: 28 NOV 2025
     ===========================================================
     ‚úàÔ∏è ACTUALIZACI√ìN v1 ‚Äî Cambios realizados:
     ‚Ä¢ üß† Integrada inicializaci√≥n hist√≥rica EXACTA a choose_base
     ‚Ä¢ üï∞ Aeropuertos primarios ‚Üí SIEMPRE visibles
     ‚Ä¢ üåç Aeropuertos secundarios ‚Üí Seg√∫n a√±o real de apertura
     ‚Ä¢ üìâ Demandas hist√≥ricas (Y/C/F) usando ACS_World
     ‚Ä¢ üìä Orden seg√∫n √©poca (solo Y ‚Üí Y+C ‚Üí Y+C+F)
     ‚Ä¢ üß© Tooltip y tabla usan valores hist√≥ricos reales
     ‚Ä¢ üîê Qatar Luxury intacto, sin cambios visuales no solicitados
     =========================================================== -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Europe Airports - Aviation Capital Simulator</title>

  <!-- ======== ACS Styles ======== -->
  <link rel="stylesheet" href="styles.css?v=3.1" />

  <!-- ======== ACS Favicons ======== -->
  <link rel="icon" type="image/png" sizes="16x16" href="acs_logo_16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="acs_logo_32.png">
  <link rel="icon" type="image/png" sizes="64x64" href="acs_logo_64.png">
  <link rel="apple-touch-icon" href="acs_logo_180.png">
  <link rel="manifest" href="manifest.json">

  <style>
/* ============================================================
   === GLOBAL ACS QATAR LUXURY STYLE ===========================
   ============================================================ */

body {
  margin: 0;
  color: #fff;
  font-family: "Poppins", sans-serif;
  background-color: #081530;
}

/* ================= Qatar Luxury Header ================= */
.acs-header {
  position: fixed;
  top: 0;
  width: 100%;
  backdrop-filter: blur(9px);
  background: rgba(12,23,50,0.45);
  padding: 0.8rem 2rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom: 2px solid #ffb300;
  z-index: 5000;
}

.acs-logo {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.acs-logo img {
  height: 46px;
}

.acs-logo h1 {
  font-size: 1.15rem;
  margin: 0;
  color: #ffb300;
  letter-spacing: 0.5px;
}

.acs-nav {
  flex: 1;
  display: flex;
  justify-content: center;
  gap: 2rem;
}

.acs-nav a {
  position: relative;
  font-size: 1rem;
  letter-letter-spacing: 0.4px;
  color: #dbe4ff; 
  text-decoration: none;
  transition: 0.25s ease;
  padding-bottom: 6px;
}

.acs-nav a:hover,
.acs-nav a.active {
  color: #ffb300;
  text-shadow: 0 0 6px rgba(255,179,0,0.6);
}

.acs-nav a.active::after,
.acs-nav a:hover::after {
  content: "";
  position: absolute;
  bottom: -8px;
  left: 0;
  width: 100%;
  height: 2px;
  background: linear-gradient(to right, #ffb300, #ffe7a0);
  border-radius: 2px;
  box-shadow: 0 0 8px rgba(255,200,60,0.45);
}

.logout-btn {
  padding: 0.45rem 1.1rem;
  border: 1px solid #ffb300;
  border-radius: 12px;
  background: rgba(255,179,0,0.05);
  color: #ffb300;
  font-weight: 600;
  cursor: pointer;
  text-decoration: none;
}

.logout-btn:hover {
  background: #ffb300;
  color: #0c1f3c;
}

.acs-clock-header {
  font-family: "Orbitron", monospace;
  padding: 0.4rem 0.8rem;
  background: rgba(0,255,128,0.08);
  border-radius: 8px;
  font-size: 0.95rem;
  color: #00ff80;
}

/* ================= MAIN CONTENT ================= */
.acs-main {
  padding: 110px 2rem 70px;
  text-align: center;
}

.acs-main h2 {
  font-size: 2rem;
  font-weight: 600;
  color: #ffca3a;
  margin-top: -10px;
  margin-bottom: 0.4rem;
  text-shadow: 
    0 0 6px rgba(255,190,60,0.55),
    0 0 12px rgba(255,190,60,0.35);
}

.sub {
  text-align: center;
  color: #cbd6ff;
  opacity: 0.9;
  font-size: 1.05rem;
}

/* === Country selector === */
.country-filter {
  margin: 1.2rem auto 1.8rem auto;
  display: flex;
  justify-content: center;
}

.country-select {
  background: rgba(20,35,70,0.75);
  color: #ffca3a;
  border: 1px solid #ffb300;
  padding: 0.6rem 1rem;
  border-radius: 12px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  text-align: center;
  box-shadow: 0 0 12px rgba(255,179,0,0.15);
}

.country-select:hover {
  background: rgba(30,45,85,0.9);
}

/* ============================================================
   === TABLE ‚Äî Qatar Luxury ===================================
   ============================================================ */

table {
  width: 95%;
  margin: 2rem auto 0 auto;
  border-collapse: collapse;
  background: rgba(14,27,70,0.65);
  border-radius: 18px;
  overflow: hidden;
  box-shadow: 0 0 25px rgba(0,0,0,0.45);
  backdrop-filter: blur(6px);
}

thead {
  background: rgba(20,40,85,0.85);
}

th, td {
  padding: 14px 10px;
  text-align: center;
  border-bottom: 1px solid rgba(255,255,255,0.06);
}

th {
  color: #ffb300;
  cursor: pointer;
  font-weight: 600;
  text-transform: uppercase;
  font-size: 0.83rem;
}

tr:nth-child(even) {
  background: rgba(255,255,255,0.035);
}

tr:hover {
  background: rgba(255,179,0,0.12);
  transition: 0.15s ease;
  box-shadow: 0 0 14px rgba(255,179,0,0.35) inset;
}

/* ===== Buttons ===== */
.acs-btn {
  background-color: #00a86b;
  color: #fff;
  border: none;
  padding: 7px 16px;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 600;
  font-size: 0.9rem;
  transition: .25s;
}

.acs-btn:hover {
  background-color: #00794f;
  transform: scale(1.05);
}

.acs-btn-info {
  background: rgba(20,40,85,0.85);
  color: #ffb300;
  border: 1px solid #ffb300;
  padding: 7px 14px;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 600;
  transition: .25s;
}

.acs-btn-info:hover {
  background: #ffb300;
  color: #081530;
  transform: scale(1.05);
}

/* ================================
   Qatar Luxury Modal
   ================================ */

.acs-modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.55);
  backdrop-filter: blur(4px);
  justify-content: center;
  align-items: center;
  z-index: 9000;
}

.acs-modal-box {
  background: rgba(12,23,50,0.92);
  border: 2px solid #ffb300;
  border-radius: 18px;
  padding: 20px 26px;
  width: 420px;
  max-height: 80vh;
  overflow-y: auto;
  color: #fff;
  box-shadow: 0 0 25px rgba(255,179,0,0.35);
}

.acs-modal-box h3 {
  color: #ffca3a;
  text-align: center;
  margin-top: 0;
}

.acs-modal-close {
  margin-top: 18px;
  width: 100%;
  background: none;
  border: 1px solid #ffb300;
  border-radius: 10px;
  color: #ffb300;
  padding: 10px;
  cursor: pointer;
  font-weight: 600;
}

.acs-modal-close:hover {
  background: #ffb300;
  color: #081530;
}

  </style>
</head>

<body>
  <!-- ===== HEADER ===== -->
  <header class="acs-header">
    <div class="acs-logo">
      <img src="acs_logo.png" alt="ACS Logo" />
      <h1>Aviation Capital Simulator</h1>
    </div>

    <nav class="acs-nav">
      <a href="dashboard.html">Main</a>
      <a href="finance.html">Finance</a>
      <a href="aircraft.html">Aircraft</a>
      <a href="routes.html" class="active">Routes</a>
      <a href="hr.html">HR</a>
      <a href="forum.html">Forum</a>
      <a href="support.html">Support</a>
    </nav>

    <a href="#" class="logout-btn" onclick="handleLogout()">Logout</a>

    <div class="acs-clock-header" id="acs-clock">00:00 ‚Äî 01 JAN 2025</div>
  </header>

  <!-- ===== MAIN CONTENT ===== -->
  <main class="acs-main">
    <h2>üåç European Airports</h2>
    <p class="sub">Sort by demand, cost, or runway length. Click ‚ÄúCreate Route‚Äù to plan flights.</p>
    <div class="origin-banner">
      <span class="icon">üõ´</span>
      <span class="label">Origin:</span>
      <span id="originFlag">üè≥Ô∏è</span>
      <strong id="originIcao">---</strong>
      <span id="originCity">‚Äî Loading...</span>
    </div>

    <!-- Country selector -->
    <div class="country-filter">
      <select id="countrySelect" class="country-select" onchange="filterByCountry()">
        <option value="ALL">üåç All Countries</option>
      </select>
    </div>

    <table id="airportTable">
      <thead>
        <tr>
          <th onclick="sortTable(0)">Airport (ICAO)</th>
          <th onclick="sortTable(1)">Country</th>
          <th onclick="sortTable(2)">Distance (NM)</th>
          <th onclick="sortTable(3)">Demand (Y/C/F)</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="airportTableBody"></tbody>
    </table>

    <button class="back-btn" onclick="window.location.href='routes.html'">‚¨Ö Back</button>
  </main>

  <!-- ===== FOOTER ===== -->
  <footer>
    ¬© 2025 Aviation Capital Simulator. All rights reserved.
  </footer>

  <!-- ===== TOOLTIP ===== -->
  <div id="demandTooltip"></div>

  <!-- ============================
       AIRPORT INFO MODAL (Qatar Luxury)
       ============================ -->
  <div id="airportInfoModal" class="acs-modal">
    <div class="acs-modal-box">
      <h3 id="modalTitle">Airport Info</h3>
      <div id="modalContent">Loading...</div>
      <button class="acs-modal-close" onclick="closeAirportInfo()">Close</button>
    </div>
  </div>

  <!-- ===== SCRIPTS ===== -->
  <!-- Crear contenedor global si no existe -->
  <script>
    window.WorldAirportsACS = window.WorldAirportsACS || {};
  </script>

  <!-- === Airport Data for Europe === -->
  <script src="engine/airports/world_airports_eu.js"></script>

  <!-- === ACS TIME ENGINE === -->
  <script src="time_engine.js?v=1.2"></script>

  <!-- ============================================================
       === HISTORICAL ENGINE BLOCK (same as choose_base) ==========
       ============================================================ -->
  <!-- üü¶ Cargamos loader e √≠ndices del mundo -->
  <script src="engine/airports_loader.js"></script>
  <script src="engine/acs_world_engine.js"></script>

  <script>
  /* ===============================================================
     === HISTORICAL INITIALIZER ‚Äî EXACTO A choose_base =============
     ============================================================== */

  document.addEventListener("DOMContentLoaded", () => {

    // 1) Cargar aeropuertos din√°micamente
    loadAirportScripts(() => {

      // 2) Construir √≠ndices globales
      buildAirportIndex();

      // 3) Activar motor mundial hist√≥rico
      ACS_World.initialize();

      // 4) Cargar la tabla hist√≥rica de Europa
      loadAirports("Europe");

      // 5) Cargar banner de origen
      loadOriginBanner();
    });
  });

  /* ===============================================================
     === FUNCIONES HIST√ìRICAS: Filtrar + Demanda + Orden ===========
     ============================================================== */

  function loadAirports(continent) {

    const year = ACS_World.getSimYear();      // üü¶ A√±o actual hist√≥rico
    const tableBody = document.getElementById("airportTableBody");
    tableBody.innerHTML = "";

    const userBase = localStorage.getItem("ACS_baseICAO") || "LEMD";

    const allAirports = WorldAirportsACS[continent] || [];

    // üü¶ Filtrar por hist√≥rico: primarios siempre visibles
    const airports = allAirports
      .filter(a => a.icao !== userBase)
      .filter(a => a.is_primary === true || ACS_World.airportExistsInYear(a, year));

    // üü¶ Demanda hist√≥rica para orden
    airports.sort((a, b) => {
      const A = ACS_World.getHistoricalDemand(a, year);
      const B = ACS_World.getHistoricalDemand(b, year);

      if (year < 1955) {
        return (B.Y - A.Y);
      } 
      else if (year < 1976) {
        return ((B.Y + B.C) - (A.Y + A.C));
      }
      return ((B.Y + B.C + B.F) - (A.Y + A.C + A.F));
    });

    // üü¶ Country Selector
    const selector = document.getElementById("countrySelect");
    if (selector) {
      selector.innerHTML = `<option value="ALL">üåç All Countries</option>`;
      const uniqueCountries = [...new Set(airports.map(a => a.region))].sort();
      uniqueCountries.forEach(country => {
        const opt = document.createElement("option");
        opt.value = country;
        opt.textContent = country;
        selector.appendChild(opt);
      });
    }

    // üü¶ Pintar filas
    airports.forEach(a => {

      // Demanda hist√≥rica
      const D = ACS_World.getHistoricalDemand(a, year);

      let distNM = "-";
      const baseAp = allAirports.find(ap => ap.icao === userBase);
      if (baseAp) {
        distNM = distanceNM(baseAp.latitude, baseAp.longitude, a.latitude, a.longitude);
      }

      const total = D.Y + D.C + D.F;
      const ecoPct = (D.Y / total) * 100;
      const bizPct = ((D.Y + D.C) / total) * 100;

      const row = document.createElement("tr");
      row.innerHTML = `
        <td><strong>${a.city}</strong> (${a.icao})</td>
        <td>${a.region}</td>
        <td>${distNM} NM</td>
        <td>
          ${D.Y}/${D.C}/${D.F}
          <div class="demand-bar" 
               style="--eco:${ecoPct}%; --biz:${bizPct}%"></div>
        </td>
        <td style="display:flex; gap:8px; justify-content:center;">
          <button class="acs-btn-info" onclick="openAirportInfo('${a.icao}')">Info</button>
          <button class="acs-btn" onclick="createRoute('${a.icao}')">Create Route</button>
        </td>
      `;
      tableBody.appendChild(row);
    });
  }
  } // END loadAirports()



  /* ============================================================
       === COUNTRY FILTER (hist√≥rico) ============================
       ============================================================ */
  function filterByCountry() {
    const selected = document.getElementById("countrySelect").value;
    const tableBody = document.getElementById("airportTableBody");
    const rows = Array.from(tableBody.querySelectorAll("tr"));

    if (selected === "ALL") {
      rows.forEach(r => r.style.display = "");
      return;
    }

    rows.forEach(r => {
      const c = r.children[1].textContent.trim();
      r.style.display = (c === selected) ? "" : "none";
    });
  }



  /* ============================================================
       === CREATE ROUTE NAVIGATION ==============================
       ============================================================ */
  function createRoute(icao) {
    window.location.href = `route_schedule.html?to=${icao}`;
  }



  /* ============================================================
       === SORT TABLE (unchanged, Qatar Luxury style) ===========
       ============================================================ */
  function sortTable(n) {
    const table = document.getElementById("airportTable");
    let switching = true, dir = "asc", switchcount = 0;

    while (switching) {
      switching = false;
      const rows = table.rows;

      for (let i = 1; i < (rows.length - 1); i++) {
        let shouldSwitch = false;
        const x = rows[i].getElementsByTagName("TD")[n];
        const y = rows[i + 1].getElementsByTagName("TD")[n];

        const xVal = isNaN(parseFloat(x.textContent)) ? 
                     x.textContent.toLowerCase() : parseFloat(x.textContent);
        const yVal = isNaN(parseFloat(y.textContent)) ? 
                     y.textContent.toLowerCase() : parseFloat(y.textContent);

        if ((dir === "asc" && xVal > yVal) ||
            (dir === "desc" && xVal < yVal)) {
          shouldSwitch = true;
          break;
        }
      }

      if (shouldSwitch) {
        rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
        switching = true;
        switchcount++;
      } 
      else if (switchcount === 0 && dir === "asc") {
        dir = "desc";
        switching = true;
      }
    }
  }



  /* ============================================================
       === AIRPORT INFO MODAL ‚Äî HISTORICAL =======================
       ============================================================ */
  function openAirportInfo(icao) {

    const year = ACS_World.getSimYear();
    const airports = WorldAirportsACS["Europe"] || [];
    const ap = airports.find(a => a.icao === icao);
    if (!ap) return;

    const D = ACS_World.getHistoricalDemand(ap, year);

    const modal = document.getElementById("airportInfoModal");
    const title = document.getElementById("modalTitle");
    const content = document.getElementById("modalContent");

    title.textContent = `${ap.city} (${ap.icao})`;

    content.innerHTML = `
      <div class="info-line"><strong>Country:</strong> ${ap.country}</div>
      <div class="info-line"><strong>Region:</strong> ${ap.region}</div>
      <div class="info-line"><strong>Category:</strong> ${ap.category}</div>
      <hr/>
      <div class="info-line"><strong>Latitude:</strong> ${ap.latitude}</div>
      <div class="info-line"><strong>Longitude:</strong> ${ap.longitude}</div>
      <div class="info-line"><strong>Elevation:</strong> ${ap.elevation_ft} ft</div>
      <div class="info-line"><strong>Runway:</strong> ${ap.runway_m} m</div>
      <div class="info-line"><strong>Open Hrs:</strong> ${ap.open_hrs}</div>
      <div class="info-line"><strong>Aircraft Limit:</strong> ${ap.aircraft_limit}</div>
      <hr/>
      <div class="info-line"><strong>Slot Cost:</strong> $${ap.slot_cost_usd}</div>
      <div class="info-line"><strong>Landing Fee:</strong> $${ap.landing_fee_usd}</div>
      <div class="info-line"><strong>Fuel Price:</strong> $${ap.fuel_usd_gal}/gal</div>
      <div class="info-line"><strong>Ticket %:</strong> ${(ap.ticket_fee_percent * 100).toFixed(1)}%</div>
      <div class="info-line"><strong>Growth:</strong> +${((ap.pax_growth_factor - 1) * 100).toFixed(1)}%</div>
      <hr/>
      <div class="info-line"><strong>Demand (Y/C/F):</strong> 
        ${D.Y} / ${D.C} / ${D.F}
      </div>
      <hr/>
      <div class="info-line"><strong>Notes:</strong> ${ap.notes || "‚Äî"}</div>
    `;

    modal.style.display = "flex";
  }

  function closeAirportInfo() {
    document.getElementById("airportInfoModal").style.display = "none";
  }

  // Cerrar modal al hacer click afuera
  window.addEventListener("click", e => {
    const modal = document.getElementById("airportInfoModal");
    if (e.target === modal) modal.style.display = "none";
  });



  /* ============================================================
       === ORIGIN BANNER (BASE DEL JUGADOR) ======================
       ============================================================ */
  function loadOriginBanner() {

    const baseIcao = localStorage.getItem("ACS_baseICAO") || null;
    if (!baseIcao) return;

    const airports = WorldAirportsACS["Europe"] || [];
    const base = airports.find(a => a.icao === baseIcao);
    if (!base) return;

    const flagEmoji = base.country.replace(/./g, char =>
      String.fromCodePoint(char.charCodeAt(0) + 127397)
    );

    const flagEl = document.getElementById("originFlag");
    const icaoEl = document.getElementById("originIcao");
    const cityEl = document.getElementById("originCity");

    if (flagEl && icaoEl && cityEl) {
      flagEl.textContent = flagEmoji;
      icaoEl.textContent = base.icao;
      cityEl.textContent = `‚Äî ${base.city}, ${base.region}`;
    }
  }



  /* ============================================================
       === DEMAND TOOLTIP (Pie Chart hist√≥rico) =================
       ============================================================ */
  const tooltip = document.getElementById("demandTooltip");

  document.addEventListener("mousemove", (e) => {
    const cell = e.target.closest("td:nth-child(4)");
    if (cell) {

      const txt = cell.textContent.trim().split("/");
      if (txt.length === 3) {

        const Y = parseInt(txt[0]) || 0;
        const C = parseInt(txt[1]) || 0;
        const F = parseInt(txt[2]) || 0;
        const total = Y + C + F;

        const ecoDeg = (Y / total) * 360;
        const bizDeg = ((Y + C) / total) * 360;

        tooltip.innerHTML = `
          <h4>Passenger Demand</h4>
          <div>Economy: ${Y}</div>
          <div>Business: ${C}</div>
          <div>First: ${F}</div>
          <div class="demand-pie" 
               style="--eco:${ecoDeg}deg; --biz:${bizDeg}deg;">
            <div class="slice"></div>
          </div>
        `;
        tooltip.style.display = "block";
        tooltip.style.left = e.pageX + 15 + "px";
        tooltip.style.top = e.pageY - 80 + "px";
      }
    } 
    else {
      tooltip.style.display = "none";
    }
  });



  /* ============================================================
       === LOGOUT ===============================================
       ============================================================ */
  function handleLogout() {
    alert("üëã Session closed. See you soon, Captain!");
    window.location.href = "login.html";
  }

  </script>

</body>
</html>
