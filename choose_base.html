<!-- === CHOOSE BASE MODULE === -->
<!-- Version: Beta v1 | Date: 12 NOV 2025 -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Choose Base - Aviation Capital Simulator</title>
  <link rel="stylesheet" href="styles.css?v=3.1" />
  <style>
    body {
      margin: 0;
      background-color: #081530;
      color: white;
      font-family: "Segoe UI", sans-serif;
      padding-top: 120px;
      text-align: center;
    }

    .form-container {
      background: #0e1b3c;
      border: 1px solid #1A335C;
      border-radius: 12px;
      max-width: 1000px;
      margin: 0 auto;
      padding: 2rem;
      box-shadow: 0 0 15px rgba(0,0,0,0.4);
    }

    h2 {
      color: #FFB300;
      margin-bottom: 0.5rem;
    }

    p {
      color: #ccc;
      font-size: 0.95rem;
      margin-bottom: 1.5rem;
    }

    select {
      background: #1A335C;
      color: white;
      border: none;
      border-radius: 10px;
      padding: 0.6rem 1rem;
      margin: 0.5rem;
      font-size: 1rem;
      outline: none;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1.5rem;
      background: rgba(255,255,255,0.03);
      border-radius: 10px;
      overflow: hidden;
    }

    th, td {
      border-bottom: 1px solid rgba(255,255,255,0.1);
      padding: 0.6rem 0.5rem;
      text-align: center;
      font-size: 0.95rem;
    }

    th {
      background: rgba(255,179,0,0.15);
      color: #FFB300;
    }

    tr:hover {
      background: rgba(255,255,255,0.05);
    }

    .acs-btn {
      background-color: #00a86b;
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 6px 12px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.3s;
    }

    .acs-btn:hover {
      background-color: #007d4e;
    }

    footer {
      color: #bbb;
      font-size: 0.85rem;
      margin-top: 2rem;
    }

    .acs-clock-header {
      font-family: 'Orbitron', 'Consolas', monospace;
      color: #00ff80;
      font-weight: bold;
      background: rgba(0,255,128,0.08);
      padding: 0.3rem 0.8rem;
      border-radius: 6px;
      font-size: 0.9rem;
      margin-left: 1rem;
    }
  </style>
</head>

<body>
  <!-- ===== HEADER ===== -->
  <header class="acs-header">
    <div class="acs-logo">
      <img src="acs_logo.png" alt="ACS Logo" />
      <h1>Aviation Capital Simulator</h1>
    </div>

    <nav class="acs-nav">
      <a href="dashboard.html">Main</a>
      <a href="finance.html">Finance</a>
      <a href="aircraft.html">Aircraft</a>
      <a href="routes.html">Routes</a>
      <a href="hr.html">HR</a>
    </nav>

    <div class="acs-auth">
      <a href="#" class="logout-btn" onclick="handleLogout()">Logout</a>
    </div>

    <div class="acs-clock-header" id="acs-clock">00:00 ‚Äî 01 JAN 2025</div>
  </header>

  <!-- ===== MAIN SECTION ===== -->
  <section class="form-container">
    <h2>Choose Your Base</h2>
    <p>Select a continent and country to establish your main operations base.</p>

    <div>
      <select id="continentSelect" onchange="loadCountries()">
        <option value="">üåç Select Continent</option>
        <option value="Europe">Europe</option>
        <option value="Asia">Asia</option>
        <option value="NorthAmerica">North America</option>
        <option value="SouthAmerica">South America</option>
        <option value="Africa">Africa</option>
        <option value="Oceania">Oceania</option>
      </select>

      <select id="countrySelect" onchange="loadAirports()">
        <option value="">üè≥Ô∏è Select Country</option>
      </select>
    </div>

    <table id="airportTable">
      <thead>
        <tr>
          <th>ICAO</th>
          <th>IATA</th>
          <th>City</th>
          <th>Airport</th>
          <th>Category</th>
          <th>Demand</th>
          <th>Slots</th>
          <th>Cost (USD)</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="airportList">
        <tr><td colspan="9">Select a continent and country to view airports.</td></tr>
      </tbody>
    </table>
  </section>

  <footer>
    <p>¬© 2025 Aviation Capital Simulator. All rights reserved.</p>
  </footer>

  <!-- ===== SCRIPTS ORDENADOS Y SINCRONIZADOS ===== -->
<script src="time_engine.js"></script>
<script src="worldairportsacs.js"></script>

<script>
  let selectedContinent = "";
  let selectedCountry = "";

  function loadCountries() {
    selectedContinent = document.getElementById("continentSelect").value;
    const countrySelect = document.getElementById("countrySelect");
    countrySelect.innerHTML = '<option value="">üè≥Ô∏è Select Country</option>';
    document.getElementById("airportList").innerHTML =
      '<tr><td colspan="9">Select a continent and country to view airports.</td></tr>';

    if (!selectedContinent || !WorldAirportsACS[selectedContinent]) return;

    const countries = [...new Set(WorldAirportsACS[selectedContinent].map(a => a.country))].sort();
    countries.forEach(c => {
      const opt = document.createElement("option");
      opt.value = c;
      opt.textContent = c;
      countrySelect.appendChild(opt);
    });
  }

  function loadAirports() {
    selectedCountry = document.getElementById("countrySelect").value;
    const tbody = document.getElementById("airportList");
    tbody.innerHTML = "";

    if (!selectedContinent || !selectedCountry) {
      tbody.innerHTML = '<tr><td colspan="9">Please select both continent and country.</td></tr>';
      return;
    }

    const airports = WorldAirportsACS[selectedContinent].filter(a => a.country === selectedCountry);

    if (!airports.length) {
      tbody.innerHTML = '<tr><td colspan="9">No airports available for this country.</td></tr>';
      return;
    }

    airports.sort((a, b) => {
      const demandA = (a.demand.Y || 0) + (a.demand.C || 0) + (a.demand.F || 0);
      const demandB = (b.demand.Y || 0) + (b.demand.C || 0) + (b.demand.F || 0);
      return demandB - demandA;
    });

    airports.forEach(a => {
      const totalDemand = (a.demand.Y || 0) + (a.demand.C || 0) + (a.demand.F || 0);
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${a.icao}</td>
        <td>${a.iata}</td>
        <td>${a.city}</td>
        <td>${a.name || a.city}</td>
        <td>${a.category}</td>
        <td>${totalDemand}</td>
        <td>${a.slot_capacity}</td>
        <td>$${a.slot_cost_usd.toLocaleString()}</td>
        <td><button class="acs-btn" onclick="setBase('${a.icao}')">Set as Base</button></td>
      `;
      tbody.appendChild(row);
    });
  }

  function setBase(icao) {
    const airport = Object.values(WorldAirportsACS).flat().find(a => a.icao === icao);
    if (!airport) return alert("‚ö†Ô∏è Airport not found.");

    const user = JSON.parse(localStorage.getItem("ACS_activeUser"));
    if (!user || !user.airline) {
      alert("‚ö†Ô∏è No active session or airline found. Please log in again.");
      window.location.href = "login.html";
      return;
    }

    user.airline.base = {
      icao: airport.icao,
      iata: airport.iata,
      city: airport.city,
      country: airport.country,
      continent: airport.continent,
      demand_total: (airport.demand.Y || 0) + (airport.demand.C || 0) + (airport.demand.F || 0),
      slot_capacity: airport.slot_capacity,
      cost_slot_usd: airport.slot_cost_usd
    };

    localStorage.setItem("ACS_activeUser", JSON.stringify(user));

    const users = JSON.parse(localStorage.getItem("ACS_users") || "[]");
    const index = users.findIndex(u => u.email === user.email);
    if (index !== -1) {
      users[index] = user;
      localStorage.setItem("ACS_users", JSON.stringify(users));
    }

    localStorage.setItem("ACS_Airline", JSON.stringify(user.airline));
    localStorage.setItem("ACS_Base", JSON.stringify({
      airport: airport.icao,
      iata: airport.iata,
      city: airport.city,
      country: airport.country
    }));

    alert(`‚úÖ Base set successfully at ${airport.city} (${airport.icao}).\nWelcome to your operations center, Captain ${user.name}!`);
    window.location.href = "dashboard.html";
  }

  function handleLogout() {
    alert("üëã Session closed. See you soon, Captain!");
    window.location.href = "login.html";
  }

  // üîÑ Sincronizar con el motor de tiempo global
  document.addEventListener("DOMContentLoaded", () => {
    if (typeof registerTimeListener === "function") {
      registerTimeListener(updateClockDisplay);
      updateClockDisplay();
    }
  });

<!-- WORLD AIRPORT LOADER -->
<script src="engine/airport_loader.js"></script>

<script>
document.addEventListener("DOMContentLoaded", () => {

  // 1Ô∏è‚É£ Cargar todos los continentes
  loadAirportScripts(() => {

    // 2Ô∏è‚É£ Construir el √≠ndice global de aeropuertos
    buildAirportIndex();
    console.log("üî• Airports ready:", Object.keys(AirportIndex).length);

    // 3Ô∏è‚É£ Iniciar toda la l√≥gica de Choose Base
    initChooseBase();
  });

});
</script>

<script>
function initChooseBase() {

  // Activar reloj global si existe
  if (typeof registerTimeListener === "function") {
    registerTimeListener(updateClockDisplay);
    updateClockDisplay();
  }

  <script>
document.addEventListener("DOMContentLoaded", () => {

  loadAirportScripts(() => {
    buildAirportIndex();
    console.log("üî• Airports ready:", Object.keys(AirportIndex).length);
    initChooseBase();
  });

});
</script>

</body>
</html>
