<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Loan Request ‚Äî ACS Finance</title>
  <link rel="stylesheet" href="styles.css?v=3.1" />
  <style>
    /* === LOAN REQUEST PAGE (ACS Unified Style) === */
    body {
      margin: 0;
      background-color: #081530;
      color: white;
      font-family: "Segoe UI", sans-serif;
    }

    h2 {
      text-align: center;
      color: #FFB300;
      margin-top: 6rem; /* ‚úÖ espacio por header fijo */
      margin-bottom: 0.4rem;
    }

    .top-info p {
      text-align: center;
      color: #ccc;
      margin-bottom: 2rem;
    }

    .main-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
      max-width: 1200px;
      margin: 0 auto;
      padding: 1.5rem;
    }

    .panel {
      background: #0b1c3f;
      border-radius: 12px;
      padding: 1.5rem;
      border: 1px solid rgba(255,179,0,0.25);
      box-shadow: 0 0 12px rgba(0,0,0,0.3);
      transition: transform 0.2s ease;
    }

    .panel:hover { transform: scale(1.02); }

    .panel h3 {
      color: #FFB300;
      margin-bottom: 0.8rem;
    }

    select, input {
      border-radius: 8px;
      border: none;
      background: #0C1F3C;
      color: white;
      padding: 0.6rem;
      width: 100%;
      font-size: 1rem;
    }

    label {
      display: block;
      margin-top: 0.8rem;
      color: #ccc;
      font-weight: 500;
    }

    .buy-btn {
      background-color: #00a86b;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 0.8rem 1.5rem;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s ease;
      width: 100%;
      margin-top: 1rem;
    }

    .buy-btn:hover { background-color: #007d4e; }

    /* ‚úÖ Reloj cockpit Airbus */
    .acs-clock-header {
      font-family: 'Orbitron', 'Consolas', monospace;
      color: #00ff80;
      font-weight: bold;
      background: rgba(0, 255, 128, 0.08);
      padding: 0.3rem 0.8rem;
      border-radius: 6px;
      font-size: 0.9rem;
      margin-left: 1rem;
    }
  </style>
</head>

<body>
  <!-- ===== GLOBAL HEADER ===== -->
  <header class="acs-header">
    <div class="acs-logo">
      <img src="acs_logo.png" alt="ACS Logo" />
      <h1>Aviation Capital Simulator</h1>
    </div>

    <nav class="acs-nav">
      <a href="dashboard.html">Main</a>
      <a href="finance.html" class="active">Finance</a>
      <a href="aircraft.html">Aircraft</a>
      <a href="routes.html">Routes</a>
      <a href="hr.html">HR</a>
      <a href="forum.html">Forum</a>
      <a href="support.html">Support</a>
    </nav>

    <div class="acs-auth">
      <a href="#" class="logout-btn" onclick="handleLogout()">Logout</a>
    </div>

    <div class="acs-clock-header" id="acs-clock">00:00 ‚Äî 01 JAN 2025</div>
  </header>

  <!-- ===== MAIN ===== -->
  <main class="acs-main">
    <section class="top-info">
      <h2>üí∞ Loan Request Center</h2>
      <p>Secure financing for your airline expansion. Select your aircraft, loan amount and repayment term.</p>
    </section>

    <div class="main-grid">
      <!-- === AIRCRAFT COLLATERAL === -->
      <div class="panel">
        <h3>‚úàÔ∏è Collateral Aircraft</h3>
        <select id="collateralSelect" style="margin-bottom:0.8rem;">
          <option value="">Select Aircraft</option>
        </select>
        <p id="aircraftValue" style="margin-top:10px; color:#bbb;">No aircraft selected</p>
      </div>

      <!-- === LOAN DETAILS === -->
      <div class="panel">
        <h3>üíµ Loan Details</h3>
        <label>Loan Amount (USD)</label>
        <input type="number" id="loanAmount" placeholder="Enter amount" />
        <label>Term (Years)</label>
        <select id="loanTerm">
          <option value="1">1 Year</option>
          <option value="2">2 Years</option>
          <option value="3">3 Years</option>
          <option value="4">4 Years</option>
          <option value="5">5 Years</option>
          <option value="6">6 Years</option>
        </select>
      </div>

      <!-- === LOAN EVALUATION === -->
      <div class="panel">
        <h3>üìä Loan Evaluation</h3>
        <p>Credit Rating: <span id="creditRating" style="color:#00ff88;">A</span></p>
        <p>Risk Level: <span id="riskLevel" style="color:#FFD700;">Low</span></p>
        <p>Estimated Interest Rate: <span id="interestRate" style="color:#FFB300;">3.2%</span></p>
        <p>Max Available Loan: <span id="maxLoan" style="color:#1E90FF;">$2,100,000</span></p>
      </div>

      <!-- === SUBMIT SECTION === -->
      <div class="panel">
        <h3>üìù Submit Request</h3>
        <p>Once approved, funds will be transferred instantly to your airline balance.</p>
        <button id="requestLoanBtn" class="buy-btn">Submit Loan Request</button>
        <p id="loanMessage" style="margin-top:15px; color:#ccc;"></p>
      </div>
    </div>
  </main>

  <!-- ===== FOOTER ===== -->
  <footer class="acs-footer">
    <p>¬© 2025 Aviation Capital Simulator. All rights reserved.</p>
  </footer>

 <!-- ===== LOAN ENGINE SCRIPTS ===== -->
<script src="engine/acs_finance.js"></script>
<script src="engine/acs_bank.js"></script>

<!-- ===== SCRIPT ===== -->
  
<script>
/* ============================================================
   üè¶ ACS LOAN REQUEST ‚Äî REAL AVIATION ENGINE INTEGRATION
   Rule: Max 70% per loan
   ============================================================ */

const collateralSelect = document.getElementById("collateralSelect");
const aircraftValue    = document.getElementById("aircraftValue");
const loanAmountInput  = document.getElementById("loanAmount");
const loanTermSelect   = document.getElementById("loanTerm");

const creditRatingEl   = document.getElementById("creditRating");
const riskLevelEl      = document.getElementById("riskLevel");
const interestRateEl   = document.getElementById("interestRate");
const maxLoanEl        = document.getElementById("maxLoan");

const loanMessageEl    = document.getElementById("loanMessage");

let BANK_SUMMARY = null;
let MAX_PER_LOAN = 0;

function money(x){
  return "$" + Math.round(Number(x || 0)).toLocaleString();
}

function loadBankData(){
  if (typeof ACS_BANK_getSummary !== "function"){
    console.error("‚ùå ACS_BANK_getSummary missing ‚Äî engine/acs_bank.js not loaded");
    loanMessageEl.textContent = "BANK ENGINE NOT LOADED (acs_bank.js)";
    return;
  }

  BANK_SUMMARY = ACS_BANK_getSummary();

  const capacity = Number(BANK_SUMMARY.loanCapacity || 0);
  MAX_PER_LOAN = capacity * 0.7;

  interestRateEl.textContent = Number(BANK_SUMMARY.interestRate || 0).toFixed(2) + "%";
  maxLoanEl.textContent = money(MAX_PER_LOAN);

  updateCreditProfile();
}

function updateCreditProfile(){
  const fleet = Number(BANK_SUMMARY.fleetValue || 0);
  const loans = Array.isArray(BANK_SUMMARY.loans) ? BANK_SUMMARY.loans : [];
  const debt  = loans.reduce((s,l)=> s + Number(l.remaining || 0), 0);

  const ratio = fleet > 0 ? debt / fleet : 0;

  let rating = "AAA";
  let risk   = "Very Low";

  if (ratio > 0.70){ rating="CCC"; risk="Critical"; }
  else if (ratio > 0.60){ rating="B"; risk="High"; }
  else if (ratio > 0.40){ rating="BB"; risk="Elevated"; }
  else if (ratio > 0.25){ rating="BBB"; risk="Moderate"; }
  else if (ratio > 0.15){ rating="A"; risk="Low"; }
  else if (ratio > 0.05){ rating="AA"; risk="Very Low"; }

  creditRatingEl.textContent = rating;
  riskLevelEl.textContent    = risk;
}

function loadAircraft(){
  const fleet = JSON.parse(localStorage.getItem("ACS_MyAircraft") || "[]");

  collateralSelect.innerHTML = '<option value="">Select Aircraft</option>';

  fleet.forEach(ac => {
    const value = Number(ac.marketValue || ac.value || ac.price || 0);
    const label = (ac.type || ac.name || ac.model || "Aircraft");

    const opt = document.createElement("option");
    opt.value = String(value);
    opt.textContent = `${label} ‚Äî ${money(value)}`;
    collateralSelect.appendChild(opt);
  });
}

collateralSelect.addEventListener("change", (e) => {
  const v = Number(e.target.value || 0);
  aircraftValue.textContent = v ? `Value: ${money(v)}` : "No aircraft selected";
});


function submitLoan(){
  const amount = Number(loanAmountInput.value || 0);
  const years  = Number(loanTermSelect.value || 0);
  const months = years * 12;

  if (!amount || amount <= 0){
    loanMessageEl.textContent = "Enter a valid loan amount.";
    return;
  }

  if (amount > MAX_PER_LOAN){
    loanMessageEl.textContent = "Amount exceeds the 70% maximum allowed per loan.";
    return;
  }

  try{
    ACS_BANK_createLoan(amount, months);
    loanMessageEl.textContent = "‚úÖ Loan approved. Funds transferred to your airline balance.";
    setTimeout(()=> location.href="bank.html", 1200);
  }catch(err){
    loanMessageEl.textContent = (err && err.message) ? err.message : "Loan error.";
  }
}

document.getElementById("requestLoanBtn").addEventListener("click", submitLoan);

document.addEventListener("DOMContentLoaded", () => {
  loadBankData();
  loadAircraft();
});

  
</script>
  
</body>
</html>
