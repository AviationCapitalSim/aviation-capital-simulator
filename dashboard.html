<!-- === DASHBOARD MODULE ‚Äî Qatar Luxury Edition === -->
<!-- Version: v5 FINAL | Date: 06 DEC 2025 -->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard - Aviation Capital Simulator</title>

  <!-- ======== ACS Styles ======== -->
  <link rel="stylesheet" href="styles.css?v=3.1" />

  <!-- ======== ACS Favicons (16 / 32 / 64) ======== -->
  <link rel="icon" type="image/png" sizes="16x16" href="acs_logo_16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="acs_logo_32.png">
  <link rel="icon" type="image/png" sizes="64x64" href="acs_logo_64.png">

  <!-- ======== Apple iPhone/iPad Home Screen Icon ======== -->
  <link rel="apple-touch-icon" href="acs_logo_180.png">

  <!-- ======== PWA Manifest ======== -->
  <link rel="manifest" href="manifest.json">

<style>
/* ============================================================
     === ACS Qatar Luxury Dashboard ‚Äî Visual Redesign ===========
   ============================================================ */

body {
  margin: 0;
  background-color: #081530;
  color: white;
  font-family: "Poppins", sans-serif;
}

   /* ============================================================
   HEADER ‚Äî SHARED ACS STANDARD
   ============================================================ */

 .acs-header{

  position:fixed;
  top:0;
  left:0;                 /* ‚úÖ CR√çTICO */
  right:0;                /* ‚úÖ CR√çTICO */

  width:100%;

  box-sizing:border-box;

  display:flex;

  align-items:center;

  justify-content:space-between;

  padding:.8rem 2rem;

  background:rgba(12,23,50,.45);

  backdrop-filter:blur(9px);

  border-bottom:2px solid #ffb300;

  z-index:5000;

}
  
.acs-logo{
  display:flex;
  align-items:center;
  gap:1rem;
}

.acs-logo img{
  height:46px;
}

.acs-logo h1{
  margin:0;
  font-size:1.1rem;
  color:#ffb300;
}

.acs-nav{

  display:flex;

  gap:2rem;

  flex:1;                 /* ‚úÖ CR√çTICO ‚Äî ocupa el espacio central */

  justify-content:center; /* centra navegaci√≥n */

}

.acs-nav a{
  text-decoration:none;
  color:#dbe4ff;
}

.acs-nav a.active{
  color:#ffb300;
}
  
  /* ============================================================
   üü¶ RIGHT HEADER AREA ‚Äî PERFECT SPACING & CLOCK ALIGNMENT
   ============================================================ */

.acs-right{

  display:flex;

  align-items:center;

  gap:14px;

  padding-right:12px;

  flex-shrink:0;

  justify-content:flex-end;   /* ‚úÖ evita empujar layout */

}
  
.support-btn{
  padding:.45rem 1.1rem;
  border-radius:12px;
  font-size:.9rem;
  font-weight:600;
  text-decoration:none;
  color:#8AB4FF;
  border:1px solid rgba(138,180,255,.45);
  background:rgba(138,180,255,.08);
}

.logout-btn{
  padding:.45rem 1.1rem;
  border:1px solid #ffb300;
  border-radius:12px;
  background:rgba(255,179,0,.05);
  color:#ffb300;
  font-weight:600;
  cursor:pointer;
}

/* ============================================================
   üü¶ ACS GLOBAL CLOCK ‚Äî STABLE HEADER FIX (NO LAYOUT SHIFT)
   Use in ALL ACS modules
   ============================================================ */

.acs-clock-header{

  font-family:"Orbitron",monospace;
  font-size:.95rem;
  color:#00ff80;

  background:rgba(0,255,128,.08);
  border-radius:10px;

  padding:.45rem .8rem;

  width:260px;                 /* ancho fijo absoluto */
  flex:0 0 260px;             /* evita expansi√≥n o compresi√≥n */

  display:flex;
  justify-content:center;
  align-items:center;

  white-space:nowrap;

  font-variant-numeric:tabular-nums;

  border:1px solid rgba(0,255,128,.18);

  overflow:hidden;            /* protecci√≥n extra */
}

/* ============================================================
     === MAIN CONTENT ==========================================
   ============================================================ */

.acs-main {
  padding: 110px 2rem 70px;
  text-align: center;
}

.acs-main h2 {
  font-size: 2.1rem;
  font-weight: 600;
  color: #ffca3a;
  margin-top: 18px;
  margin-bottom: 6px;
  text-shadow:
    0 0 6px rgba(255,190,60,0.55),
    0 0 12px rgba(255,190,60,0.35);
}

.sub {
  text-align: center;
  color: #cbd6ff;
  opacity: 0.9;
  font-size: 1.05rem;
  margin-top: 10px;
  margin-bottom: 32px;
}

/* ============================================================
     === PREMIUM PANEL GRID ====================================
   ============================================================ */

.dashboard-grid {
  display: grid;
  gap: 2rem;
  margin-top: 4rem;
}

.row-business {
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
}

.row-operations {
  grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
}

.row-capital {
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
}

/* ============================================================
     === PANEL ==================================================
   ============================================================ */

.panel {
  background: linear-gradient(180deg, rgba(20,35,70,0.75), rgba(10,18,40,0.85));
  padding: 1.6rem 1.5rem;
  border-radius: 22px;
  box-shadow: 0 0 25px rgba(0,0,0,0.4);
  transition: 0.25s;
  border: 1px solid rgba(255,179,0,0.15);
}

.panel:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 32px rgba(255,179,0,0.25);
  border: 1px solid rgba(255,179,0,0.35);
}

.panel h3 {
  font-size: 1.25rem;
  color: #ffb300;
  margin-bottom: 0.9rem;
  text-shadow: 0 0 6px rgba(255,179,0,0.4);
}

.panel p {
  color: #d7e2ff;
  font-size: 0.95rem;
  line-height: 1.4;
}

.alert-list,
.aircraft-list {
  list-style: none;
  padding: 0;
}

.alert-list li {
  color: #ff9b00;
}

.acs-btn {
  margin-top: 1rem;
  background: #00a86b;
  border: none;
  padding: 0.7rem 1.1rem;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 600;
  transition: 0.25s;
  color: white;
}

.acs-btn:hover {
  background: #00794f;
}

.acs-footer {
  text-align: center;
  padding: 20px;
  margin-top: 50px;
  color: #7c8bb8;
  font-size: 0.9rem;
}

/* ============================================================
   === WELCOME CHIPS ‚Äî Qatar Luxury (Tama√±o unificado) ========
   ============================================================ */

.welcome-badges {
  display: flex;
  justify-content: center;
  align-items: center;
  margin-top: 22px;
  margin-bottom: 28px;
  gap: 26px;
}

/* üëâ Todos con el MISMO tama√±o (clonado del Base),
      pero Rank y Pa√≠s conservan su recuadro dorado original */
.welcome-chip {
  padding: 5px 18px;          /* m√°s grande que el original */
  font-size: 0.90rem;         /* texto un poco m√°s grande */
  border-radius: 12px;
  background: rgba(255,179,0,0.12);       /* recuadro dorado original */
  border: 1px solid rgba(255,179,0,0.35); /* recuadro dorado original */
  color: #ffffff;
  display: flex;
  align-items: center;
  gap: 8px;
  backdrop-filter: blur(4px);
  box-shadow: 0 0 6px rgba(0,0,0,0.35);
  height: 28px;
  line-height: 28px;
}

/* CHIP BASE ‚Äî Azul Qatar Royal */
.welcome-chip.base-chip {
  background: rgba(0, 102, 204, 0.20);
  border: 1px solid rgba(0, 135, 255, 0.50);
  color: #3aaaff;
}
  
/* ============================================================
   === HERO TITLE ‚Äî Qatar Luxury Premium v2.3 (Balanceado) ====
   ============================================================ */

#welcomeMessage {
  font-size: 2.2rem;               /* tama√±o reducido */
  font-weight: 700;
  margin-bottom: 0.3rem;
  letter-spacing: 1px;
  text-transform: uppercase;
  text-align: center;
}

#welcomeMessage .w-welcome {
  background: linear-gradient(90deg, #ffe7a0, #ffb300, #ffd75a);
  -webkit-background-clip: text;
  color: transparent;
  text-shadow: 0 0 14px rgba(255,190,60,0.35);
}

#welcomeMessage .w-airline {
  color: #ffffff;
  text-shadow: 0 0 12px rgba(255,255,255,0.25);
}

  
</style>
</head>
<body>

<header class="acs-header">
  <div class="acs-left">
    <img src="acs_logo.png" alt="ACS Logo">
    <h1>Aviation Capital Simulator</h1>
  </div>

  <nav class="acs-nav">
    <a href="dashboard.html" class="active">Main</a>
    <a href="bank.html">Bank</a>
    <a href="aircraft.html">Aircraft</a>
    <a href="routes.html">Routes</a>
    <a href="hr.html">HR</a>
    <a href="forum.html">Forum</a>
  </nav>

  <div class="acs-right">
    <a href="support.html" class="support-btn">Support</a>
    <a class="logout-btn" onclick="handleLogout()">Logout</a>
    <div id="acs-clock" class="acs-clock-header">00:00 ‚Äî 01 JAN 1940</div>
  </div>
</header>

<main class="acs-main">

  <!-- ============================================================
       2Ô∏è‚É£ WELCOME SECTION ‚Äî Qatar Luxury Mini Chips (v1.1)
     ============================================================ -->

  <h2 id="welcomeMessage"></h2>

  <div class="welcome-badges">

    <!-- RANK -->
    
    <div class="welcome-chip">
      üèÖ <span id="chipRank">Silver Carrier Rank</span>
    </div>

    <!-- WORLD / COUNTRY -->
    
    <div class="welcome-chip">
    <span id="chipWorld">Italy</span>
    </div>


    <!-- BASE (AZUL QATAR ROYAL) -->
    
    <div class="welcome-chip base-chip">
    <span id="chipBase">Base: Napoli (LIRN)</span>
    </div>


  </div>

  <p class="sub">Your command center for managing fleets, routes, staff and capital.</p>

  <!-- ============================================================
       BUSINESS SECTION
     ============================================================ -->

  <div class="dashboard-grid row-business">

    <div class="panel">
      <h3>‚úàÔ∏è Top Earning Aircraft</h3>
      <ul class="aircraft-list" id="topAircraftList"></ul>
    </div>

    <div class="panel">
      <h3>üìä Company Finance</h3>
      <p>Access your company‚Äôs monthly and weekly growth overview.</p>
      <button class="acs-btn" onclick="window.location.href='company_finance.html'">Open</button>    
    </div>

    <div class="panel">
  <h3>üíº Company Value</h3>
  <p>Total assets: <strong id="companyValue">‚Äî</strong></p>
  <p>Includes fleet, credits, and investments.</p>
  <button class="acs-btn" onclick="window.location.href='company_value.html'">Open</button>
 </div>

  </div>

  <!-- ============================================================
       OPERATIONS SECTION
     ============================================================ -->

  <div class="dashboard-grid row-operations">

    <div class="panel">
      <h3 id="dashboardAlertTitle">‚ö†Ô∏è Operational Alerts</h3>
      <ul class="alert-list" id="alertsList"></ul>
      <button class="acs-btn" onclick="window.location.href='alerts_center.html'">Open Center</button>
    </div>

    <div class="panel">
      <h3>üì∞ Global News & Events</h3>
      <p><strong>‚ÄúOil prices surge after conflict in the Middle East.‚Äù</strong><br>Passenger demand drops 4% this week.</p>
      <button class="acs-btn" onclick="window.location.href='events.html'">Read More</button>
    </div>

    <div class="panel">
      <h3>‚öôÔ∏è Settings</h3>
      <p>Manage system preferences, theme, and data synchronization.</p>
      <button class="acs-btn" onclick="window.location.href='setting.html'">Open Setting</button>
    </div>

  </div>

  <!-- ============================================================
       CAPITAL SECTION
     ============================================================ -->

  <div class="dashboard-grid row-capital">

    <div class="panel">
      <h3>üí† Credits</h3>
      <p><strong id="creditsAmount">2,450 AC$</strong> available</p>
      <button class="acs-btn" onclick="window.location.href='buy_credits.html'">Buy</button>
    </div>

    <div class="panel">
      <h3>üë• HR Summary</h3>
      <p>Coming soon: morale, payroll, staff overview.</p>
    </div>

    <div class="panel">
      <h3>üõ´ Fleet Snapshot</h3>
      <p>Coming soon: total aircraft, utilization %, active leases.</p>
    </div>

  </div>

</main>

<footer class="acs-footer">
  ¬© 2025 Aviation Capital Simulator. All rights reserved.
</footer>

<script>
  
function openRoutesDB() { window.location.href = "routes_database.html"; }
function openRouteSetup() { window.location.href = "route_setup.html"; }
function openRoutesActive() { window.location.href = "routes_active.html"; }
function openDistanceCalc() { window.location.href = "distance_calc.html"; }

function handleLogout() {
  alert("üëã Session closed. See you soon, Captain!");
  window.location.href = "login.html";
}
</script>
  
<!-- ============================================================
     ‚è≥ ACS TIME ENGINE V12 ‚Äî 24/7 RECOVERY LAYER
     ============================================================ -->
<script src="acs_time_recovery.js"></script>
<script src="time_engine.js"></script>

<script src="engine/acs_finance.js"></script>

<!-- üíº COMPANY VALUE ENGINE (CANONICAL SOURCE) -->
<script src="engine/acs_company_value.js"></script>

<script>
/* ============================================================
   üíº DASHBOARD ‚Äî COMPANY VALUE (REAL ENGINE MIRROR)
   ------------------------------------------------------------
   ‚Ä¢ Fuente √∫nica: ACS_getCompanyValue()
   ‚Ä¢ Sin n√∫meros falsos
   ‚Ä¢ Sin duplicados
   ‚Ä¢ Siempre consistente con Company Value
   ============================================================ */

(function connectDashboardCompanyValue(){

  function tryConnect() {

    if (typeof window.ACS_getCompanyValue !== "function") {
      // esperar a que cargue el engine
      return setTimeout(tryConnect, 200);
    }

    try {

      const value = window.ACS_getCompanyValue();
      const el = document.getElementById("companyValue");

      if (el && Number.isFinite(value)) {
        el.textContent = "$" + Math.round(value).toLocaleString("en-US");
      } else if (el) {
        el.textContent = "‚Äî";
      }

      console.log("üíº Dashboard Company Value connected:", value);

    } catch (e) {
      console.warn("Dashboard Company Value failed", e);
    }

  }

  tryConnect();

})();
</script>
  
<script src="engine/acs_alerts.js?v=1.0"></script>

<script>
/* ============================================================
   1Ô∏è‚É£ UNIVERSAL FLAG ENGINE ‚Äî Qatar Luxury
   ============================================================ */
function getFlagEmojiFromCountryName(countryName) {
  if (!countryName) return "üåç";

  const isoMap = {
    "italy":"IT","spain":"ES","france":"FR","germany":"DE","united states":"US",
    "united kingdom":"GB","russia":"RU","kazakhstan":"KZ","kyrgyzstan":"KG",
    "mexico":"MX","argentina":"AR","china":"CN","japan":"JP","brazil":"BR",
    "canada":"CA","turkey":"TR","qatar":"QA","saudi arabia":"SA",
    "venezuela":"VE","colombia":"CO","peru":"PE","chile":"CL","netherlands":"NL",
    "portugal":"PT","sweden":"SE","norway":"NO","finland":"FI","switzerland":"CH",
    "australia":"AU","new zealand":"NZ","india":"IN","pakistan":"PK","iran":"IR",
    "iraq":"IQ","egypt":"EG","south africa":"ZA","nigeria":"NG","morocco":"MA",
    "uae":"AE","singapore":"SG","south korea":"KR","thailand":"TH"
  };

  const key = countryName.trim().toLowerCase();
  const iso = isoMap[key];
  if (!iso) return "üåç";

  return String.fromCodePoint(
    iso.charCodeAt(0) - 65 + 0x1F1E6,
    iso.charCodeAt(1) - 65 + 0x1F1E6
  );
}
</script>

<script>
/* ============================================================
   2Ô∏è‚É£ BASE RESOLVER ‚Äî Qatar Luxury v2.0
   ============================================================ */

document.addEventListener("DOMContentLoaded", () => {
  
  let activeUser = JSON.parse(localStorage.getItem("ACS_activeUser") || "{}");
  let base = activeUser.base || {};

  // Funci√≥n de limpieza
  const clean = v => (!v || v === "undefined") ? "" : v;

  base.icao    = clean(base.icao);
  base.city    = clean(base.city);
  base.country = clean(base.country);
  base.name    = clean(base.name);

  // Fallback: leer de los 7 HTML tradicionales
  if (!base.icao) {
    base.icao    = clean(localStorage.getItem("ACS_baseICAO"));
    base.city    = clean(localStorage.getItem("ACS_baseCity"));
    base.country = clean(localStorage.getItem("ACS_baseCountry"));
    base.name    = clean(localStorage.getItem("ACS_baseName"));
  }

  // Si sigue sin base ‚Üí salir
  if (!base.icao) return;

  // Guardar limpio
  activeUser.base = {
    icao: base.icao.toUpperCase(),
    city: base.city,
    country: base.country,
    name: base.name
  };

  localStorage.setItem("ACS_activeUser", JSON.stringify(activeUser));

  console.log("‚úÖ Base Resolver listo:", activeUser.base);

});
</script>

<script>
/* ============================================================
   3 DASHBOARD MASTER LOADER ‚Äî Qatar Luxury v5.0 (OFICIAL)
   ------------------------------------------------------------
   ‚Ä¢ Carga airline desde Google Sheet si hace falta
   ‚Ä¢ Muestra Welcome con estilo Qatar
   ‚Ä¢ Carga Pa√≠s + Bandera
   ‚Ä¢ Carga Base
   ‚Ä¢ Carga Rank (si existe)
   ‚Ä¢ Evita sobrescrituras (un solo motor)
   ============================================================ */

document.addEventListener("DOMContentLoaded", async () => {

  let activeUser = JSON.parse(localStorage.getItem("ACS_activeUser") || "{}");

  if (!activeUser || !activeUser.airline_id) {
    window.location.href = "login.html";
    return;
  }

  const airlineId = activeUser.airline_id;
  let airlineObj = activeUser.airline || null;

  // 1Ô∏è‚É£ Si airlineObj no existe ‚Üí traerlo del servidor
  if (!airlineObj) {
    try {
      const url =
        "https://script.google.com/macros/s/AKfycbzzhyG15J2nf-pGyXN0aF1jW4h7ip4xO-eyRxXOYmsNirl6UO4XaZTq8SM7ayzzEib1Zw/exec" +
        `?action=getAirline&airline_id=${airlineId}`;

      const resp = await fetch(url);
      const data = await resp.json();

      if (data.status === "success") {
        airlineObj = data.airline;
        activeUser.airline = airlineObj;
        localStorage.setItem("ACS_activeUser", JSON.stringify(activeUser));
      }
    } catch (err) {
      console.error("‚ùå Error loading airline:", err);
    }
  }

  // 2Ô∏è‚É£ WELCOME TITLE
  const welcome = document.getElementById("welcomeMessage");
  if (welcome) {
    welcome.innerHTML = `
      <span class="w-welcome">WELCOME TO</span>
      &nbsp;
      <span class="w-airline">${airlineObj.name}</span>
    `;
  }

  // 3Ô∏è‚É£ COUNTRY + FLAG
  const chipWorld = document.getElementById("chipWorld");
  if (chipWorld && airlineObj.country) {
    const flag = getFlagEmojiFromCountryName(airlineObj.country);
    chipWorld.textContent = `${flag} ${airlineObj.country}`;
  }

  // 4Ô∏è‚É£ BASE
  const chipBase = document.getElementById("chipBase");
  if (chipBase && activeUser.base && activeUser.base.city && activeUser.base.icao) {
    chipBase.textContent =
      `Base: ${activeUser.base.city} (${activeUser.base.icao})`;
  }

  // 5Ô∏è‚É£ RANK
  const chipRank = document.getElementById("chipRank");
  if (chipRank && airlineObj.rank) {
    chipRank.textContent = airlineObj.rank;
  }

});
</script>
  
<script>
/* ============================================================
   4 ALERT ENGINE ‚Äî Qatar Luxury v3 FINAL
   ============================================================ */

document.addEventListener("DOMContentLoaded", () => {

  function waitAlerts() {
    if (!window.ACS_ALERTS) return setTimeout(waitAlerts, 150);
    renderAlerts();
  }

  waitAlerts();

  function renderAlerts() {

    let alerts = [];
    try {
      alerts = ACS_getAllAlertsMerged();
    } catch(e) {
      alerts = window.ACS_ALERTS || [];
    }

    const list  = document.getElementById("alertsList");
    const title = document.getElementById("dashboardAlertTitle");

    if (!list) return;

    // t√≠tulo con contador
    title.innerHTML = `‚ö†Ô∏è Operational Alerts${alerts.length > 0 ? " (" + alerts.length + ")" : ""}`;

    if (alerts.length === 0) {
      list.innerHTML = `<li style="color:#cbd6ff;">No active alerts.</li>`;
      return;
    }

    list.innerHTML = "";
    alerts.slice(0,3).forEach(a => {
      const li = document.createElement("li");
      li.style = "list-style:none; margin-bottom:6px; color:#dbe4ff;";
      li.innerHTML = `
        ${a.level === "critical" ? "üõë" :
           a.level === "high"     ? "‚ö†Ô∏è" :
           a.level === "medium"   ? "üîî" : "‚ÑπÔ∏è"
        }
        <strong>${a.type.toUpperCase()}</strong> ‚Äî ${a.message}
      `;
      list.appendChild(li);
    });

  }

  /* üîÅ Auto-refresh cada 40s:
     - Vuelve a correr ACS_runAlertScan (si existe)
     - Vuelve a pintar la tarjeta Operational Alerts
  */
  setInterval(async () => {
    try {
      if (typeof ACS_runAlertScan === "function") {
        await ACS_runAlertScan();
      }
      renderAlerts();
    } catch (err) {
      console.warn("‚ö†Ô∏è Dashboard auto-refresh failed:", err);
    }
  }, 40000); // 40,000 ms = 40 segundos

});
</script>

<script>
/* ============================================================
   5 ALERT BADGE ‚Äî Qatar Luxury
   ============================================================ */

document.addEventListener("DOMContentLoaded", () => {

  const title = document.getElementById("dashboardAlertTitle");
  if (!title) return;

  const badge = document.createElement("span");
  badge.id = "opsAlertBadge";
  badge.style = `
    background:#ff5050;
    color:white;
    padding:2px 8px;
    font-size:0.75rem;
    border-radius:10px;
    margin-left:8px;
    font-weight:700;
    box-shadow:0 0 8px rgba(255,80,80,0.65);
  `;
  title.appendChild(badge);

  function refreshBadge() {
    let alerts = [];

    try {
      alerts = ACS_getAllAlertsMerged();
    } catch {
      alerts = window.ACS_ALERTS || [];
    }

    const total = alerts.length;

    badge.style.display = total > 0 ? "inline-block" : "none";
    badge.textContent = total;
  }

  refreshBadge();
  setInterval(refreshBadge, 5000);

});
</script>

<script src="engine/acs_security_core.js?v=1"></script>
  
  </body>
</html>
